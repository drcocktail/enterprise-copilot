[
  {
    "id": "enterprise-copilot_check_db.py_check_db.py:chunk_1_f7867f85",
    "text": "import sqlite3\nimport time\nimport sys\n\n# Wait for potential background write\nprint(\"Checking DB in 15 seconds...\")\ntime.sleep(15)\n\ntry:\n    conn = sqlite3.connect('backend/copilot.db')\n    c = conn.cursor()\n    c.execute(\"SELECT content FROM messages WHERE role='assistant' ORDER BY timestamp DESC LIMIT 1\")\n    row = c.fetchone()\n    if row:\n        print(f\"LATEST_MESSAGE: {row[0][:100]}...\")\n        if len(row[0]) > 10:\n             print(\"SUCCESS: Message saved.\")\n        else:\n             print(\"FAILURE: Message too short.\")\n    else:\n        print(\"NO_MESSAGE_FOUND\")\n    conn.close()\nexcept Exception as e:\n    print(f\"DB Error: {e}\")\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "check_db.py:chunk_1",
      "file_path": "check_db.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 646,
      "ingested_at": "2026-01-16T23:06:30.175383"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_1_10b5b7f7",
    "text": "import React, { useState, useEffect, useRef } from 'react';\nimport { \n  Shield, \n  MessageSquare, \n  Terminal, \n  Users, \n  Briefcase, \n  FileText, \n  Calendar, \n  Search, \n  X, \n  Send, \n  CheckCircle, \n  AlertTriangle, \n  Lock, \n  Clock, \n  ChevronRight, \n  Layout, \n  PieChart, \n  Server,\n  Code,\n  Trello,\n  Maximize2,\n  Minimize2,\n  Activity,\n  Eye\n} from 'lucide-react';\n\n// --- MOCK DATA & CONFIGURATION ---",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_1",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 414,
      "ingested_at": "2026-01-16T23:06:30.184317"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_2_ba2bd964",
    "text": "const PERSONAS = {\n  CSUITE: {\n    id: 'c_suite_01',\n    role: 'CHIEF_STRATEGY_OFFICER',\n    name: 'Eleanor Vance',\n    permissions: ['READ_FINANCIALS', 'READ_HR_AGGREGATE', 'WRITE_STRATEGY', 'CALENDAR_WRITE'],\n    theme: 'bg-indigo-900',\n    context: 'Strategic Overview',\n    suggested: ['Summarize Q3 Revenue', 'Show Project Alpha Timeline', 'Schedule Board Sync']\n  },\n  HR: {\n    id: 'hr_lead_04',\n    role: 'HR_DIRECTOR',\n    name: 'Marcus Thorne',\n    permissions: ['READ_EMPLOYEE_PII', 'WRITE_POLICY', 'CALENDAR_WRITE', 'SLACK_BROADCAST'],\n    theme: 'bg-rose-800',\n    context: 'People & Culture',\n    suggested: ['Draft Onboarding Policy', 'Find Interview Slots', 'Analyze Attrition']\n  },\n  IT: {\n    id: 'dev_ops_99',\n    role: 'SR_DEVOPS_ENGINEER',\n    name: 'Sarah Chen',\n    permissions: ['READ_CODEBASE', 'WRITE_JIRA', 'RESTART_SERVICES', 'READ_LOGS'],\n    theme: 'bg-emerald-900',\n    context: 'Infrastructure & Ops',\n    suggested: ['Grep error in auth-service', 'Create Jira Ticket', 'Check Server Health']\n  }\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_2",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1032,
      "ingested_at": "2026-01-16T23:06:30.184327"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_3_ce2577ff",
    "text": "const MOCK_DOCS = {\n  policy: \"PTO Policy 2024: Employees are entitled to 20 days annually. Carry-over is limited to 5 days.\",\n  financials: \"Q3 Earnings: Revenue up 15% YoY. EBITDA margin at 22%. Primary driver: Enterprise SaaS adoption.\",\n  code: \"function authenticateUser(token) { \\n  // TODO: Fix race condition here \\n  if (!verify(token)) throw new Error('Invalid'); \\n}\"\n};\n\n// --- COMPONENTS ---\n\nconst IAMBadge = ({ role, permissions }) => (\n  <div className=\"flex items-center gap-2 text-xs font-mono bg-slate-100 dark:bg-slate-800 p-2 rounded border border-slate-200 dark:border-slate-700 mt-1\">\n    <Lock className=\"w-3 h-3 text-amber-500\" />\n    <span className=\"font-bold text-slate-600 dark:text-slate-300\">IAM_CTX:</span>\n    <span className=\"text-blue-600 dark:text-blue-400\">{role}</span>\n    <span className=\"text-slate-400\">|</span>\n    <span className=\"text-slate-500 truncate max-w-[150px]\">{permissions.length} active scopes</span>\n  </div>\n);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_3",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 967,
      "ingested_at": "2026-01-16T23:06:30.184332"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_4_c9b59eff",
    "text": "const ChatMessage = ({ msg }) => {\n  const isUser = msg.type === 'user';\n  \n  return (\n    <div className={`flex w-full mb-4 ${isUser ? 'justify-end' : 'justify-start'}`}>\n      <div className={`flex flex-col max-w-[85%] ${isUser ? 'items-end' : 'items-start'}`}>\n        <div className={`p-3 rounded-lg shadow-sm text-sm ${\n          isUser \n            ? 'bg-blue-600 text-white rounded-br-none' \n            : 'bg-white dark:bg-slate-800 text-slate-800 dark:text-slate-200 border border-slate-200 dark:border-slate-700 rounded-bl-none'\n        }`}>\n          {msg.content}\n        </div>\n        \n        {/* Render Rich Attachments/Cards if Agent */}\n        {!isUser && msg.attachment && (\n          <div className=\"mt-2 w-full\">\n            {msg.attachment.type === 'TICKET' && (\n              <div className=\"bg-white dark:bg-slate-800 border-l-4 border-orange-500 rounded shadow p-3 text-xs font-mono\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <span className=\"font-bold flex items-center gap-1\"><Trello size={12}/> JIRA-4201</span>\n                  <span className=\"bg-orange-100 text-orange-800 px-1 rounded\">TO DO</span>\n                </div>\n                <div className=\"text-slate-600 dark:text-slate-400 mb-2\">{msg.attachment.data.title}</div>\n                <div className=\"flex gap-2 text-[10px] text-slate-400\">\n                  <span>Assignee: {msg.attachment.data.assignee}</span>\n                  <span>\u2022</span>\n                  <span>Priority: {msg.attachment.data.priority}</span>\n                </div>\n              </div>\n            )}\n            \n            {msg.attachment.type === 'CODE' && (\n              <div className=\"bg-slate-900 text-slate-300 rounded shadow p-3 text-xs font-mono overflow-x-auto\">\n                <div className=\"flex justify-between items-center mb-2 border-b border-slate-700 pb-1\">\n                  <span className=\"flex items-center gap-1\"><Code size={12}/> {msg.attachment.data.file}</span>\n                  <span className=\"text-[10px] opacity-50\">Lines 45-48</span>\n                </div>\n                <pre>{msg.attachment.data.snippet}</pre>\n              </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_4",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2205,
      "ingested_at": "2026-01-16T23:06:30.184335"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_5_b4d3894f",
    "text": "            {msg.attachment.type === 'GANTT' && (\n              <div className=\"bg-white dark:bg-slate-800 rounded shadow p-3 text-xs border border-slate-200 dark:border-slate-700\">\n                <div className=\"flex items-center gap-2 mb-3 font-bold text-slate-700 dark:text-slate-200\">\n                  <Activity size={12} /> Project Roadmap\n                </div>\n                <div className=\"space-y-2\">\n                  {msg.attachment.data.tasks.map((task, i) => (\n                    <div key={i} className=\"relative h-6 bg-slate-100 dark:bg-slate-700 rounded-full overflow-hidden w-full\">\n                      <div \n                        className=\"absolute h-full bg-blue-500 opacity-80 flex items-center pl-2 text-white text-[10px] whitespace-nowrap\"\n                        style={{ width: `${task.progress}%` }}\n                      >\n                        {task.name}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_5",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1030,
      "ingested_at": "2026-01-16T23:06:30.184339"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_6_145c13e9",
    "text": "            {msg.attachment.type === 'CALENDAR' && (\n               <div className=\"bg-white dark:bg-slate-800 rounded shadow p-3 text-xs border border-slate-200 dark:border-slate-700\">\n                 <div className=\"flex items-center gap-2 mb-2 font-bold text-slate-700 dark:text-slate-200\">\n                   <Calendar size={12} /> Proposed Slots\n                 </div>\n                 <div className=\"flex gap-2\">\n                   {msg.attachment.data.slots.map((slot, i) => (\n                     <button key={i} className=\"flex-1 py-2 px-1 bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400 border border-green-200 dark:border-green-800 rounded text-center hover:bg-green-100 transition-colors\">\n                       {slot}\n                     </button>\n                   ))}\n                 </div>\n               </div>\n            )}\n          </div>\n        )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_6",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 897,
      "ingested_at": "2026-01-16T23:06:30.184343"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_7_3679ae2a",
    "text": "        {/* IAM Trace Footer */}\n        {!isUser && (\n          <div className=\"flex items-center gap-1 mt-1 opacity-50 text-[10px] text-slate-500\">\n            <Shield size={10} />\n            <span>Authorized via {msg.iamRole}</span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_7",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 296,
      "ingested_at": "2026-01-16T23:06:30.184346"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_8_e8fabb37",
    "text": "const DashboardWidget = ({ title, value, trend, icon: Icon, color }) => (\n  <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700 shadow-sm\">\n    <div className=\"flex justify-between items-start\">\n      <div>\n        <p className=\"text-sm font-medium text-slate-500 dark:text-slate-400\">{title}</p>\n        <h3 className=\"text-2xl font-bold text-slate-900 dark:text-white mt-2\">{value}</h3>\n      </div>\n      <div className={`p-2 rounded-lg ${color}`}>\n        <Icon className=\"w-5 h-5 text-white\" />\n      </div>\n    </div>\n    <div className=\"mt-4 flex items-center text-sm\">\n      <span className={trend.startsWith('+') ? 'text-green-500' : 'text-red-500'}>{trend}</span>\n      <span className=\"text-slate-400 ml-2\">vs last month</span>\n    </div>\n  </div>\n);\n\n// --- MAIN APPLICATION ---",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_8",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 842,
      "ingested_at": "2026-01-16T23:06:30.184349"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_9_963f40ce",
    "text": "export default function CorporateCopilot() {\n  const [activePersona, setActivePersona] = useState(PERSONAS.CSUITE);\n  const [isCopilotOpen, setIsCopilotOpen] = useState(false);\n  const [isExpanded, setIsExpanded] = useState(false); // For dashboard/log split\n  const [messages, setMessages] = useState([]);\n  const [input, setInput] = useState('');\n  const [isTyping, setIsTyping] = useState(false);\n  const [auditLogs, setAuditLogs] = useState([]);\n  const [showLogs, setShowLogs] = useState(false);\n  \n  const scrollRef = useRef(null);\n\n  // Reset chat when persona changes\n  useEffect(() => {\n    setMessages([{\n      type: 'agent',\n      content: `Hello ${activePersona.name}. I am active with IAM Role: ${activePersona.role}. How can I assist with ${activePersona.context}?`,\n      iamRole: activePersona.role,\n      id: Date.now()\n    }]);\n    setIsCopilotOpen(false); // Close initially\n    // Clear logs for demo clarity or keep them to show history? Let's keep them.\n  }, [activePersona]);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_9",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 998,
      "ingested_at": "2026-01-16T23:06:30.184353"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_10_8338a82e",
    "text": "  useEffect(() => {\n    if (scrollRef.current) {\n      scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n    }\n  }, [messages, isTyping]);\n\n  const addAuditLog = (action, status, details) => {\n    const newLog = {\n      id: Date.now(),\n      timestamp: new Date().toISOString(),\n      actor: activePersona.name,\n      iamRole: activePersona.role,\n      action: action,\n      status: status,\n      details: details,\n      traceId: `req_${Math.random().toString(36).substr(2, 9)}`\n    };\n    setAuditLogs(prev => [newLog, ...prev]);\n  };\n\n  const handleSend = async () => {\n    if (!input.trim()) return;\n    \n    const userMsg = { type: 'user', content: input, id: Date.now() };\n    setMessages(prev => [...prev, userMsg]);\n    setInput('');\n    setIsTyping(true);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_10",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 775,
      "ingested_at": "2026-01-16T23:06:30.184356"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_11_4e8421bf",
    "text": "    // Simulate Agent Logic\n    setTimeout(() => {\n      let responseContent = \"I can't help with that based on your current permissions.\";\n      let attachment = null;\n      let actionType = \"GENERAL_QUERY\";\n      let status = \"ALLOWED\";\n\n      const lowerInput = userMsg.content.toLowerCase();",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_11",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 295,
      "ingested_at": "2026-01-16T23:06:30.184359"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_12_65ea8b82",
    "text": "      // --- LOGIC: IT PERSONA ---\n      if (activePersona.role === 'SR_DEVOPS_ENGINEER') {\n        if (lowerInput.includes('ticket') || lowerInput.includes('bug') || lowerInput.includes('jira')) {\n          actionType = \"WRITE_JIRA\";\n          responseContent = \"I've drafted a Jira ticket for this issue based on the logs.\";\n          attachment = {\n            type: 'TICKET',\n            data: { title: 'Auth Service Timeout in Prod', assignee: 'Sarah Chen', priority: 'High' }\n          };\n        } else if (lowerInput.includes('code') || lowerInput.includes('grep') || lowerInput.includes('function')) {\n          actionType = \"READ_CODEBASE\";\n          responseContent = \"Found the relevant snippet in `auth-service/src/main.js`.\";\n          attachment = {\n            type: 'CODE',\n            data: { file: 'auth-service.js', snippet: MOCK_DOCS.code }\n          };\n        }\n      }",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_12",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 892,
      "ingested_at": "2026-01-16T23:06:30.184365"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_13_6a8435ad",
    "text": "      // --- LOGIC: HR PERSONA ---\n      if (activePersona.role === 'HR_DIRECTOR') {\n        if (lowerInput.includes('policy') || lowerInput.includes('pto')) {\n          actionType = \"READ_POLICY_DOCS\";\n          responseContent = \"According to the 2024 Employee Handbook:\";\n          attachment = {\n            type: 'TICKET', // Reusing Ticket style for simplicity or generic card\n            data: { title: 'PTO Policy Summary', assignee: 'HR Dept', priority: 'Info' } // Just a placeholder\n          };\n           // Override specifically for text\n           responseContent = MOCK_DOCS.policy;\n        } else if (lowerInput.includes('interview') || lowerInput.includes('schedule')) {\n          actionType = \"CALENDAR_WRITE\";\n          responseContent = \"I found these available slots for the candidate interview.\";\n          attachment = {\n            type: 'CALENDAR',\n            data: { slots: ['Tue 10:00 AM', 'Tue 2:00 PM', 'Wed 11:30 AM'] }\n          };\n        }\n      }",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_13",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 982,
      "ingested_at": "2026-01-16T23:06:30.184370"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_14_9bf0b46d",
    "text": "      // --- LOGIC: C-SUITE PERSONA ---\n      if (activePersona.role === 'CHIEF_STRATEGY_OFFICER') {\n        if (lowerInput.includes('revenue') || lowerInput.includes('financial')) {\n          actionType = \"READ_FINANCIALS\";\n          responseContent = MOCK_DOCS.financials;\n        } else if (lowerInput.includes('project') || lowerInput.includes('timeline')) {\n          actionType = \"READ_STRATEGY\";\n          responseContent = \"Here is the high-level roadmap for Project Alpha.\";\n          attachment = {\n            type: 'GANTT',\n            data: { tasks: [{name: 'Q1 Planning', progress: 100}, {name: 'Q2 Execution', progress: 45}, {name: 'Q3 Launch', progress: 0}] }\n          };\n        }\n      }",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_14",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 706,
      "ingested_at": "2026-01-16T23:06:30.184374"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_15_1342890b",
    "text": "      // --- IAM CHECK SIMULATION ---\n      // If the user asks for something their role doesn't support\n      if (\n        (lowerInput.includes('code') && activePersona.role !== 'SR_DEVOPS_ENGINEER') ||\n        (lowerInput.includes('financial') && activePersona.role !== 'CHIEF_STRATEGY_OFFICER')\n      ) {\n        status = \"DENIED\";\n        responseContent = `Access Denied: Your IAM Role [${activePersona.role}] does not have permission to access this resource. This attempt has been logged.`;\n        attachment = null;\n      }\n\n      const agentMsg = {\n        type: 'agent',\n        content: responseContent,\n        attachment: attachment,\n        iamRole: activePersona.role,\n        id: Date.now() + 1\n      };\n\n      setMessages(prev => [...prev, agentMsg]);\n      setIsTyping(false);\n      addAuditLog(actionType, status, `Generated response for user input: \"${userMsg.content.substring(0, 20)}...\"`);\n\n    }, 1200);\n  };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_15",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 932,
      "ingested_at": "2026-01-16T23:06:30.184377"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_16_e956c6ff",
    "text": "  return (\n    <div className=\"flex h-screen bg-slate-50 dark:bg-slate-900 font-sans text-slate-900 dark:text-slate-100 overflow-hidden\">\n      \n      {/* SIDEBAR (Navigation) */}\n      <aside className=\"w-64 bg-slate-900 text-slate-300 flex flex-col hidden md:flex border-r border-slate-800\">\n        <div className=\"p-6 flex items-center gap-3 text-white\">\n          <div className=\"w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center\">\n            <Layout size={18} />\n          </div>\n          <span className=\"font-bold text-lg tracking-tight\">CorpPortal</span>\n        </div>\n        \n        <nav className=\"flex-1 px-4 space-y-2 mt-4\">\n          <div className=\"px-2 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2\">Main</div>\n          <button className=\"flex items-center gap-3 w-full p-2 rounded hover:bg-slate-800 text-white bg-slate-800/50\">\n            <PieChart size={18} /> Dashboard\n          </button>\n          <button className=\"flex items-center gap-3 w-full p-2 rounded hover:bg-slate-800\">\n            <Briefcase size={18} /> Projects\n          </button>\n          <button className=\"flex items-center gap-3 w-full p-2 rounded hover:bg-slate-800\">\n            <Users size={18} /> Directory\n          </button>\n          \n          <div className=\"px-2 text-xs font-semibold text-slate-500 uppercase tracking-wider mb-2 mt-6\">Resources</div>\n          <button className=\"flex items-center gap-3 w-full p-2 rounded hover:bg-slate-800\">\n            <FileText size={18} /> Documents\n          </button>\n          <button className=\"flex items-center gap-3 w-full p-2 rounded hover:bg-slate-800\">\n            <Server size={18} /> Infrastructure\n          </button>\n        </nav>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_16",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1729,
      "ingested_at": "2026-01-16T23:06:30.184381"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_17_ecb25462",
    "text": "        {/* Persona Switcher in Sidebar Footer */}\n        <div className=\"p-4 bg-slate-950 border-t border-slate-800\">\n          <p className=\"text-xs text-slate-500 mb-2 uppercase font-semibold\">Simulate Persona</p>\n          <div className=\"flex gap-2 justify-between\">\n            {Object.values(PERSONAS).map(p => (\n              <button\n                key={p.id}\n                onClick={() => setActivePersona(p)}\n                className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-all ${\n                  activePersona.id === p.id \n                    ? 'bg-blue-500 text-white ring-2 ring-blue-500 ring-offset-2 ring-offset-slate-900 scale-110' \n                    : 'bg-slate-800 text-slate-400 hover:bg-slate-700'\n                }`}\n                title={p.role}\n              >\n                {p.role.substring(0, 2)}\n              </button>\n            ))}\n          </div>\n          <div className=\"mt-3 text-xs text-slate-400 flex items-center gap-2\">\n            <div className={`w-2 h-2 rounded-full ${activePersona.id === PERSONAS.IT.id ? 'bg-emerald-500' : activePersona.id === PERSONAS.HR.id ? 'bg-rose-500' : 'bg-indigo-500'}`}></div>\n            {activePersona.name}\n          </div>\n        </div>\n      </aside>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_17",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1284,
      "ingested_at": "2026-01-16T23:06:30.184384"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_18_e07eaf55",
    "text": "      {/* MAIN CONTENT AREA */}\n      <main className=\"flex-1 flex flex-col relative overflow-hidden\">\n        \n        {/* Header */}\n        <header className=\"h-16 bg-white dark:bg-slate-900 border-b border-slate-200 dark:border-slate-800 flex items-center justify-between px-6 shadow-sm z-10\">\n          <div className=\"flex items-center gap-4\">\n            <h1 className=\"text-xl font-semibold text-slate-800 dark:text-white\">{activePersona.context} Dashboard</h1>\n            <span className=\"px-2 py-0.5 rounded-full bg-slate-100 dark:bg-slate-800 text-xs text-slate-500 border border-slate-200 dark:border-slate-700\">\n              {new Date().toLocaleDateString()}\n            </span>\n          </div>\n          <div className=\"flex items-center gap-4\">\n            <button \n              onClick={() => setShowLogs(!showLogs)}\n              className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-sm border transition-colors ${\n                showLogs \n                ? 'bg-amber-50 border-amber-200 text-amber-700 dark:bg-amber-900/20 dark:border-amber-800 dark:text-amber-400' \n                : 'bg-white border-slate-200 text-slate-600 hover:bg-slate-50 dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300'\n              }`}\n            >\n              <Eye size={16} />\n              {showLogs ? 'Hide IAM Traces' : 'Show IAM Traces'}\n            </button>\n            <div className=\"w-8 h-8 bg-slate-200 dark:bg-slate-700 rounded-full overflow-hidden\">\n               <img src={`https://api.dicebear.com/7.x/initials/svg?seed=${activePersona.name}`} alt=\"Avatar\" />\n            </div>\n          </div>\n        </header>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_18",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1654,
      "ingested_at": "2026-01-16T23:06:30.184388"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_19_5894ff28",
    "text": "        {/* Dashboard Grid Content (Changes based on Persona) */}\n        <div className=\"flex-1 overflow-y-auto p-6 bg-slate-50 dark:bg-black/20\">\n          <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6\">\n            {activePersona.id === PERSONAS.IT.id && (\n              <>\n                <DashboardWidget title=\"Active Incidents\" value=\"12\" trend=\"+2\" icon={AlertTriangle} color=\"bg-red-500\" />\n                <DashboardWidget title=\"System Uptime\" value=\"99.9%\" trend=\"+0.1%\" icon={Server} color=\"bg-emerald-500\" />\n                <DashboardWidget title=\"Open PRs\" value=\"34\" trend=\"-5\" icon={Code} color=\"bg-blue-500\" />\n              </>\n            )}\n            {activePersona.id === PERSONAS.HR.id && (\n              <>\n                <DashboardWidget title=\"Open Roles\" value=\"8\" trend=\"+1\" icon={Users} color=\"bg-rose-500\" />\n                <DashboardWidget title=\"Onboarding\" value=\"3\" trend=\"0\" icon={UserPlusIcon} color=\"bg-purple-500\" />\n                <DashboardWidget title=\"eNPS Score\" value=\"42\" trend=\"+4\" icon={HeartIcon} color=\"bg-pink-500\" />\n              </>\n            )}\n            {activePersona.id === PERSONAS.CSUITE.id && (\n              <>\n                <DashboardWidget title=\"Q3 Revenue\" value=\"$4.2M\" trend=\"+15%\" icon={DollarIcon} color=\"bg-indigo-500\" />\n                <DashboardWidget title=\"Burn Rate\" value=\"$180k\" trend=\"-2%\" icon={FlameIcon} color=\"bg-orange-500\" />\n                <DashboardWidget title=\"Market Share\" value=\"12%\" trend=\"+1%\" icon={PieChart} color=\"bg-cyan-500\" />\n              </>\n            )}\n          </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_19",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1602,
      "ingested_at": "2026-01-16T23:06:30.184391"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_20_6a3bda3a",
    "text": "          <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6 h-96\">\n            <div className=\"lg:col-span-2 bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm\">\n              <h3 className=\"font-semibold mb-4\">Recent Activity</h3>\n              <div className=\"space-y-4\">\n                {[1,2,3].map(i => (\n                  <div key={i} className=\"flex items-center gap-4 pb-4 border-b border-slate-100 dark:border-slate-700 last:border-0 last:pb-0\">\n                    <div className=\"w-10 h-10 rounded bg-slate-100 dark:bg-slate-700 flex items-center justify-center text-slate-400\">\n                      <FileText size={20} />\n                    </div>\n                    <div>\n                      <p className=\"text-sm font-medium\">Document updated by {activePersona.id === PERSONAS.IT.id ? 'System Admin' : 'Legal Team'}</p>\n                      <p className=\"text-xs text-slate-500\">2 hours ago</p>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n            <div className=\"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700 p-6 shadow-sm\">\n              <h3 className=\"font-semibold mb-4\">Quick Links</h3>\n              <div className=\"space-y-2\">\n                 <button className=\"w-full text-left px-3 py-2 rounded hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex justify-between group\">\n                   <span>Company Policies</span>\n                   <ChevronRight size={16} className=\"text-slate-400 group-hover:text-blue-500\" />\n                 </button>\n                 <button className=\"w-full text-left px-3 py-2 rounded hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex justify-between group\">\n                   <span>Submit Expense</span>\n                   <ChevronRight size={16} className=\"text-slate-400 group-hover:text-blue-500\" />\n                 </button>\n                 <button className=\"w-full text-left px-3 py-2 rounded hover:bg-slate-50 dark:hover:bg-slate-700 text-sm flex justify-between group\">\n                   <span>IT Helpdesk</span>\n                   <ChevronRight size={16} className=\"text-slate-400 group-hover:text-blue-500\" />\n                 </button>\n              </div>\n            </div>\n          </div>\n        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_20",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2353,
      "ingested_at": "2026-01-16T23:06:30.184395"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_21_d9dc1131",
    "text": "        {/* IAM AUDIT LOG OVERLAY (Slide up) */}\n        {showLogs && (\n          <div className=\"absolute bottom-0 left-0 right-0 h-64 bg-slate-900 border-t border-slate-700 shadow-[0_-10px_40px_rgba(0,0,0,0.5)] z-20 transition-transform\">\n            <div className=\"flex items-center justify-between px-4 py-2 bg-slate-950 border-b border-slate-800\">\n              <div className=\"flex items-center gap-2 text-amber-500 font-mono text-xs font-bold uppercase tracking-wider\">\n                <Shield size={14} /> Live IAM Trace Stream\n              </div>\n              <button onClick={() => setShowLogs(false)} className=\"text-slate-500 hover:text-white\">\n                <Minimize2 size={14} />\n              </button>\n            </div>\n            <div className=\"overflow-y-auto h-full p-4 font-mono text-xs space-y-2 pb-12\">\n              {auditLogs.length === 0 && <div className=\"text-slate-600 italic\">No actions recorded yet. Interact with the Copilot.</div>}\n              {auditLogs.map((log) => (\n                <div key={log.id} className=\"flex gap-4 border-b border-slate-800 pb-2 mb-2 last:border-0\">\n                  <div className=\"text-slate-500 min-w-[120px]\">{log.timestamp.split('T')[1].split('.')[0]}</div>\n                  <div className={`font-bold ${log.status === 'DENIED' ? 'text-red-400' : 'text-emerald-400'}`}>\n                    [{log.status}]\n                  </div>\n                  <div className=\"text-blue-400 min-w-[150px]\">{log.action}</div>\n                  <div className=\"text-slate-300 flex-1 truncate\">\n                    <span className=\"text-amber-600 mr-2\">role:{log.iamRole}</span>\n                    {log.details}\n                  </div>\n                  <div className=\"text-slate-600 text-[10px]\">{log.traceId}</div>\n                </div>\n              ))}\n            </div>\n          </div>\n        )}\n      </main>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_21",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1883,
      "ingested_at": "2026-01-16T23:06:30.184398"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_22_035668e4",
    "text": "      {/* COPILOT WIDGET (Persistent Overlay) */}\n      <div className={`fixed bottom-6 right-6 z-50 flex flex-col items-end transition-all duration-300 ${isCopilotOpen ? 'w-[400px]' : 'w-auto'}`}>\n        \n        {isCopilotOpen && (\n          <div className=\"mb-4 w-full h-[600px] bg-white dark:bg-slate-900 rounded-2xl shadow-2xl border border-slate-200 dark:border-slate-700 flex flex-col overflow-hidden animate-in slide-in-from-bottom-10 fade-in duration-200\">\n            {/* Copilot Header */}\n            <div className=\"p-4 border-b border-slate-100 dark:border-slate-800 flex justify-between items-center bg-gradient-to-r from-slate-50 to-white dark:from-slate-900 dark:to-slate-800\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white shadow-lg shadow-blue-500/30\">\n                  <Terminal size={16} />\n                </div>\n                <div>\n                  <h2 className=\"font-bold text-sm\">Enterprise Assistant</h2>\n                  <div className=\"flex items-center gap-1 text-[10px] text-green-500 font-medium\">\n                    <span className=\"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse\"></span>\n                    Online \u2022 {activePersona.role.replace('_', ' ')}\n                  </div>\n                </div>\n              </div>\n              <button onClick={() => setIsCopilotOpen(false)} className=\"text-slate-400 hover:text-slate-600 dark:hover:text-slate-200\">\n                <X size={18} />\n              </button>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_22",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1601,
      "ingested_at": "2026-01-16T23:06:30.184402"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_23_43762fc2",
    "text": "            {/* Chat Area */}\n            <div className=\"flex-1 overflow-y-auto p-4 bg-slate-50/50 dark:bg-black/20\" ref={scrollRef}>\n              {messages.map(msg => (\n                <ChatMessage key={msg.id} msg={msg} />\n              ))}\n              {isTyping && (\n                <div className=\"flex items-center gap-2 text-slate-400 text-xs ml-2\">\n                  <div className=\"w-2 h-2 bg-slate-300 rounded-full animate-bounce\"></div>\n                  <div className=\"w-2 h-2 bg-slate-300 rounded-full animate-bounce delay-75\"></div>\n                  <div className=\"w-2 h-2 bg-slate-300 rounded-full animate-bounce delay-150\"></div>\n                  <span>Processing with IAM context...</span>\n                </div>\n              )}\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_23",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 772,
      "ingested_at": "2026-01-16T23:06:30.184406"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_24_f4b2d8ee",
    "text": "            {/* Suggestions */}\n            <div className=\"px-4 py-2 border-t border-slate-100 dark:border-slate-800 flex gap-2 overflow-x-auto no-scrollbar\">\n              {activePersona.suggested.map((sug, i) => (\n                <button \n                  key={i} \n                  onClick={() => setInput(sug)}\n                  className=\"whitespace-nowrap px-3 py-1 bg-slate-100 dark:bg-slate-800 hover:bg-blue-50 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 text-xs rounded-full border border-slate-200 dark:border-slate-700 transition-colors\"\n                >\n                  {sug}\n                </button>\n              ))}\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_24",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 671,
      "ingested_at": "2026-01-16T23:06:30.184409"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_25_6895756f",
    "text": "            {/* Input Area */}\n            <div className=\"p-4 bg-white dark:bg-slate-900\">\n              <IAMBadge role={activePersona.role} permissions={activePersona.permissions} />\n              <div className=\"mt-2 flex gap-2 items-center bg-slate-50 dark:bg-slate-800 p-2 rounded-xl border border-slate-200 dark:border-slate-700 focus-within:ring-2 focus-within:ring-blue-500/20 transition-all\">\n                <input\n                  type=\"text\"\n                  value={input}\n                  onChange={(e) => setInput(e.target.value)}\n                  onKeyDown={(e) => e.key === 'Enter' && handleSend()}\n                  placeholder=\"Ask about tickets, metrics, or schedule...\"\n                  className=\"flex-1 bg-transparent border-none outline-none text-sm px-2\"\n                />\n                <button \n                  onClick={handleSend}\n                  disabled={!input.trim()}\n                  className=\"p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-transform active:scale-95\"\n                >\n                  <Send size={16} />\n                </button>\n              </div>\n            </div>\n          </div>\n        )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_25",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1229,
      "ingested_at": "2026-01-16T23:06:30.184412"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_26_0e79bf76",
    "text": "        {/* Trigger Button */}\n        {!isCopilotOpen && (\n          <button\n            onClick={() => setIsCopilotOpen(true)}\n            className=\"group flex items-center gap-3 bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-full shadow-lg shadow-blue-600/30 transition-all hover:scale-105 active:scale-95\"\n          >\n            <div className=\"relative\">\n              <MessageSquare size={24} />\n              <span className=\"absolute -top-1 -right-1 flex h-3 w-3\">\n                <span className=\"animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75\"></span>\n                <span className=\"relative inline-flex rounded-full h-3 w-3 bg-red-500 border border-white\"></span>\n              </span>\n            </div>\n            <span className=\"font-semibold max-w-0 overflow-hidden group-hover:max-w-xs transition-all duration-300 whitespace-nowrap\">\n              Open Copilot\n            </span>\n          </button>\n        )}\n      </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_26",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 988,
      "ingested_at": "2026-01-16T23:06:30.184416"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_27_6b29f4e8",
    "text": "    </div>\n  );\n}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_27",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 17,
      "ingested_at": "2026-01-16T23:06:30.184419"
    }
  },
  {
    "id": "enterprise-copilot_main.jsx_main.jsx:chunk_28_5b46dddc",
    "text": "// Icons for the dashboard widgets to prevent referencing undefined variables\nconst UserPlusIcon = ({ className }) => <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z\" /></svg>;\nconst HeartIcon = ({ className }) => <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z\" /></svg>;\nconst DollarIcon = ({ className }) => <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" /></svg>;\nconst FlameIcon = ({ className }) => <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\"><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z\" /><path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M9.879 16.121A3 3 0 1012.015 11L11 14H9c0 .768.293 1.536.879 2.121z\" /></svg>;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "main.jsx:chunk_28",
      "file_path": "main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1542,
      "ingested_at": "2026-01-16T23:06:30.184422"
    }
  },
  {
    "id": "enterprise-copilot_check_db_quick.py_check_db_quick.py:chunk_1_a57eef5d",
    "text": "import sqlite3\nimport sys\n\ntry:\n    conn = sqlite3.connect('backend/db.sqlite')\n    c = conn.cursor()\n    # Check for the specific query response\n    c.execute(\"SELECT content FROM messages WHERE role='assistant' ORDER BY created_at DESC LIMIT 1\")\n    row = c.fetchone()\n    if row:\n        print(f\"LATEST_MESSAGE: {row[0]}\")\n        if \"def fibonacci\" in row[0] or \"fib\" in row[0].lower():\n             print(\"SUCCESS: Fibonacci function found.\")\n        else:\n             print(\"NOTE: Latest message might not be the fibonacci one.\")\n    else:\n        print(\"NO_MESSAGE_FOUND\")\n    conn.close()\nexcept Exception as e:\n    print(f\"DB Error: {e}\")\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "check_db_quick.py:chunk_1",
      "file_path": "check_db_quick.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 649,
      "ingested_at": "2026-01-16T23:06:30.185678"
    }
  },
  {
    "id": "enterprise-copilot_frontend/tailwind.config.js_frontend/tailwind.config.js:chunk_1_e9dc0fc9",
    "text": "/** @type {import('tailwindcss').Config} */\nexport default {\n  content: [\n    \"./index.html\",\n    \"./src/**/*.{js,ts,jsx,tsx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        background: 'rgb(var(--bg-primary) / <alpha-value>)',\n        surface: 'rgb(var(--bg-secondary) / <alpha-value>)',\n        card: 'rgb(var(--bg-card) / <alpha-value>)',\n\n        primary: {\n          DEFAULT: 'rgb(var(--accent-primary) / <alpha-value>)',\n          glow: 'rgb(var(--accent-glow) / <alpha-value>)',\n        },",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/tailwind.config.js:chunk_1",
      "file_path": "frontend/tailwind.config.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 504,
      "ingested_at": "2026-01-16T23:06:30.186687"
    }
  },
  {
    "id": "enterprise-copilot_frontend/tailwind.config.js_frontend/tailwind.config.js:chunk_2_108fc4f6",
    "text": "        muted: 'rgb(var(--text-muted) / <alpha-value>)',\n      },\n      fontFamily: {\n        sans: ['Inter', 'system-ui', 'sans-serif'],\n        mono: ['JetBrains Mono', 'monospace'],\n      },\n      animation: {\n        'spin': 'spin 1s linear infinite',\n        'ping': 'ping 1s cubic-bezier(0, 0, 0.2, 1) infinite',\n        'pulse': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n        'bounce': 'bounce 1s infinite',\n        'glow': 'glow 2s ease-in-out infinite alternate',\n      },\n      keyframes: {\n        glow: {\n          '0%': { boxShadow: '0 0 5px rgb(var(--accent-primary) / 0.2)' },\n          '100%': { boxShadow: '0 0 20px rgb(var(--accent-primary) / 0.6)' },\n        }\n      }\n    },\n  },\n  plugins: [],\n}\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/tailwind.config.js:chunk_2",
      "file_path": "frontend/tailwind.config.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 728,
      "ingested_at": "2026-01-16T23:06:30.186693"
    }
  },
  {
    "id": "enterprise-copilot_frontend/vite.config.js_frontend/vite.config.js:chunk_1_c38b293d",
    "text": "import { defineConfig } from 'vite'\nimport react from '@vitejs/plugin-react'\n\nexport default defineConfig({\n  plugins: [react()],\n  server: {\n    port: 3000,\n    proxy: {\n      '/api': {\n        target: 'http://localhost:8000',\n        changeOrigin: true\n      },\n      '/ws': {\n        target: 'ws://localhost:8000',\n        ws: true\n      }\n    }\n  }\n})\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/vite.config.js:chunk_1",
      "file_path": "frontend/vite.config.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 356,
      "ingested_at": "2026-01-16T23:06:30.187832"
    }
  },
  {
    "id": "enterprise-copilot_frontend/postcss.config.js_frontend/postcss.config.js:chunk_1_6f341088",
    "text": "export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/postcss.config.js:chunk_1",
      "file_path": "frontend/postcss.config.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 80,
      "ingested_at": "2026-01-16T23:06:30.188634"
    }
  },
  {
    "id": "enterprise-copilot_backend/build_treesitter.py_backend/build_treesitter.py:chunk_1_0274213f",
    "text": "\"\"\"\nBuild Tree-sitter Languages\nClones language grammars and builds the shared library.\n\"\"\"\n\nfrom tree_sitter import Language\nimport os\nimport shutil\nimport subprocess\nfrom pathlib import Path\n\nBUILD_DIR = Path(__file__).parent / \"build\"\nVENDORS_DIR = BUILD_DIR / \"vendors\"\n\nLANGUAGES = {\n    \"python\": \"https://github.com/tree-sitter/tree-sitter-python\",\n    \"javascript\": \"https://github.com/tree-sitter/tree-sitter-javascript\",\n    \"typescript\": \"https://github.com/tree-sitter/tree-sitter-typescript\",\n    \"go\": \"https://github.com/tree-sitter/tree-sitter-go\",\n    \"java\": \"https://github.com/tree-sitter/tree-sitter-java\",\n}\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/build_treesitter.py:chunk_1",
      "file_path": "backend/build_treesitter.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 630,
      "ingested_at": "2026-01-16T23:06:30.189948"
    }
  },
  {
    "id": "enterprise-copilot_backend/build_treesitter.py_backend/build_treesitter.py:chunk_2_a56ec58f",
    "text": "build():\n    BUILD_DIR.mkdir(exist_ok=True)\n    VENDORS_DIR.mkdir(exist_ok=True)\n    \n    repo_paths = []\n    \n    print(\"\ud83d\udce6 Cloning tree-sitter grammars...\")\n    for lang, url in LANGUAGES.items():\n        repo_path = VENDORS_DIR / f\"tree-sitter-{lang}\"\n        if not repo_path.exists():\n            print(f\"  - Cloning {lang}...\")\n            subprocess.run([\"git\", \"clone\", \"--depth\", \"1\", url, str(repo_path)], check=True)\n        \n        if lang == \"typescript\":\n            # Typescript repo has two directories: typescript and tsx\n            repo_paths.append(str(repo_path / \"typescript\"))\n            repo_paths.append(str(repo_path / \"tsx\"))\n        else:\n            repo_paths.append(str(repo_path))\n            \n    output_lib = BUILD_DIR / \"my-languages.so\"\n    \n    print(f\"\ud83d\udd28 Building {output_lib}...\")\n    Language.build_library(\n        str(output_lib),\n        repo_paths\n    )\n    print(\"\u2705 Build complete!\")\n\nif __name__ == \"__main__\":\n    build()\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/build_treesitter.py:chunk_2",
      "file_path": "backend/build_treesitter.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 969,
      "ingested_at": "2026-01-16T23:06:30.189953"
    }
  },
  {
    "id": "enterprise-copilot_backend/main.py_backend/main.py:chunk_1_fa827943",
    "text": "\"\"\"\nDevOps Copilot V3 - FastAPI Backend\nDeveloper and IT-focused Agentic Assistant with Code Intelligence.\n\"\"\"\n\nfrom fastapi import FastAPI, HTTPException, Header, UploadFile, File, Request\nfrom fastapi.responses import StreamingResponse\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom pydantic import BaseModel, Field\nfrom typing import Optional, List, Dict, Any, Literal\nfrom datetime import datetime\nimport json\nimport uuid\nimport asyncio\nimport os\nimport shutil\nfrom pathlib import Path\nfrom contextlib import asynccontextmanager\n\nfrom config.iam_config import IAMConfig, resolve_capabilities, PERSONA_DEFINITIONS\nfrom services.llm_service import LLMService\nfrom services.db_service import DatabaseService\nfrom services.code_ingestion import CodeIngestionService\nfrom services.document_ingestion import DocumentIngestionService\nfrom services.hybrid_retriever import HybridRetriever\nfrom services.agent_loop import AgentLoop\n\nimport chromadb\nfrom chromadb.config import Settings\n\n\n# Global state\niam_config = IAMConfig()\nllm_service: Optional[LLMService] = None\ndb_service: Optional[DatabaseService] = None\ncode_ingestion: Optional[CodeIngestionService] = None\ndocument_ingestion: Optional[DocumentIngestionService] = None\nhybrid_retriever: Optional[HybridRetriever] = None\nchroma_client = None\ncode_collection = None\n\n\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    \"\"\"Initialize services on startup\"\"\"\n    print(\"\ud83d\ude80 Initializing DevOps Copilot V3...\")\n    \n    # Initialize ChromaDB\n    chroma_path = Path(__file__).parent / \"chroma_db\"\n    app.state.chroma_client = chromadb.PersistentClient(\n        path=str(chroma_path),\n        settings=Settings(anonymized_telemetry=False)\n    )\n    \n    # Get or create code collection\n    app.state.code_collection = app.state.chroma_client.get_or_create_collection(\n        name=\"code_chunks\",\n        metadata={\"hnsw:space\": \"cosine\"}\n    )\n    \n    # Initialize services\n    app.state.db_service = DatabaseService()\n    app.state.llm_service = LLMService()\n    app.state.code_ingestion = CodeIngestionService()\n    app.state.document_ingestion = DocumentIngestionService()\n    app.state.hybrid_retriever = HybridRetriever(collection=app.state.code_collection)\n    \n    # Update globals\n    global llm_service, db_service, code_ingestion, hybrid_retriever, code_collection, document_ingestion\n    llm_service = app.state.llm_service\n    db_service = app.state.db_service\n    code_ingestion = app.state.code_ingestion\n    document_ingestion = app.state.document_ingestion\n    hybrid_retriever = app.state.hybrid_retriever\n    code_collection = app.state.code_collection\n    app.state.iam_config = IAMConfig()\n    \n    # Load IAM configuration\n    await app.state.iam_config.load()\n    \n    print(\"\u2705 DevOps Copilot V3 ready!\")\n    print(\"   - LLM: qwen2.5-coder:7b\")\n    print(\"   - Hybrid retrieval: Semantic + BM25 + RRF\")\n    print(\"   - Personas: SDE-II, Principal Architect, IT Analyst\")\n    \n    yield\n    \n    # Cleanup\n    print(\"\ud83d\uded1 Shutting down...\")\n\n\n\napp = FastAPI(\n    title=\"DevOps Copilot API\",\n    description=\"Developer and IT-focused Agentic Assistant with Code Intelligence\",\n    version=\"3.0.0\",\n    lifespan=lifespan\n)\n\n# CORS Configuration\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],\n    allow_credentials=True,\n    allow_methods=[\"*\"],\n    allow_headers=[\"*\"],\n)\n\n\n# ==================== MODELS ====================\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/main.py:chunk_1",
      "file_path": "backend/main.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 3424,
      "ingested_at": "2026-01-16T23:06:30.194123"
    }
  },
  {
    "id": "enterprise-copilot_backend/main.py_backend/main.py:chunk_2_71ff2051",
    "text": "QueryRequest(BaseModel):\n    query: str = Field(..., min_length=1, max_length=5000)\n    conversation_id: Optional[str] = None\n\n\nclass GitHubIngestRequest(BaseModel):\n    github_url: str = Field(..., min_length=10)\n\n\nclass AgentResponse(BaseModel):\n    content: str\n    attachment: Optional[Dict[str, Any]] = None\n    iam_role: str\n    trace_id: str\n    timestamp: datetime\n    sources: Optional[List[Dict[str, Any]]] = None\n    trace: Optional[List[Dict[str, Any]]] = None  # Reasoning steps\n    actions: Optional[List[Dict[str, Any]]] = None  # Tool outputs\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/main.py:chunk_2",
      "file_path": "backend/main.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 560,
      "ingested_at": "2026-01-16T23:06:30.194132"
    }
  },
  {
    "id": "enterprise-copilot_backend/main.py_backend/main.py:chunk_3_967e3177",
    "text": "PersonaInfo(BaseModel):\n    id: str\n    role: str\n    name: str\n    permissions: List[str]\n    description: str\n    context: str\n    emoji: str\n    suggested: List[str]\n\n\n# ==================== ENDPOINTS ====================\n\n@app.get(\"/\")\nasync def root():\n    \"\"\"Health check\"\"\"\n    return {\n        \"status\": \"online\",\n        \"service\": \"DevOps Copilot V3\",\n        \"version\": \"3.0.0\"\n    }\n\n\n@app.get(\"/api/health\")\nasync def health_check():\n    \"\"\"Detailed health check\"\"\"\n    return {\n        \"status\": \"healthy\",\n        \"services\": {\n            \"llm\": \"online\" if llm_service else \"offline\",\n            \"database\": \"online\" if db_service else \"offline\",\n            \"code_ingestion\": \"online\" if code_ingestion else \"offline\",\n            \"hybrid_retriever\": \"online\" if hybrid_retriever else \"offline\",\n            \"chromadb\": \"online\" if code_collection else \"offline\"\n        },\n        \"llm_model\": \"qwen2.5-coder:7b\",\n        \"timestamp\": datetime.now().isoformat()\n    }\n\n\n@app.get(\"/api/personas\", response_model=List[PersonaInfo])\nasync def get_personas():\n    \"\"\"Get available personas\"\"\"\n    personas = []\n    for persona in PERSONA_DEFINITIONS.values():\n        personas.append(PersonaInfo(\n            id=persona[\"id\"],\n            role=persona[\"role\"],\n            name=persona[\"name\"],\n            permissions=persona[\"permissions\"],\n            description=persona[\"description\"],\n            context=persona[\"context\"],\n            emoji=persona[\"emoji\"],\n            suggested=persona[\"suggested\"]\n        ))\n    return personas\n\n\n@app.post(\"/api/chat\", response_model=AgentResponse)\nasync def chat(\n    request: QueryRequest,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Main chat endpoint\"\"\"\n    trace_id = str(uuid.uuid4())[:8]\n    \n    # Resolve capabilities\n    capabilities = resolve_capabilities(x_iam_role)\n    \n    # Get conversation history if provided\n    conversation_history = []\n    if request.conversation_id:\n        try:\n            messages = await db_service.get_recent_messages(\n                request.conversation_id,\n                limit=6\n            )\n            conversation_history = [\n                {\"role\": m[\"role\"], \"content\": m[\"content\"]}\n                for m in messages\n            ]\n        except:\n            pass\n    \n    # Classify intent\n    intent = await llm_service.classify_intent(request.query, capabilities)\n    \n    # Get context based on intent\n    context = []\n    sources = []\n    \n    if intent.requires_code_search and code_collection.count() > 0:\n        # Use hybrid retrieval for code\n        filters = None  # Could filter by user's repos\n        results = await hybrid_retriever.hybrid_search(\n            query=request.query,\n            top_k=5,\n            filters=filters\n        )\n        context = results\n        sources = [\n            {\n                \"file\": r.get(\"metadata\", {}).get(\"file_path\", \"unknown\"),\n                \"name\": r.get(\"metadata\", {}).get(\"name\", \"\"),\n                \"lines\": f\"{r.get('metadata', {}).get('start_line', '?')}-{r.get('metadata', {}).get('end_line', '?')}\",\n                \"language\": r.get(\"metadata\", {}).get(\"language\", \"\")\n            }\n            for r in results\n        ]\n    \n    # Generate response\n    llm_response = await llm_service.generate_response(\n        query=request.query,\n        context=context,\n        role=x_iam_role,\n        capabilities=capabilities,\n        intent=intent,\n        conversation_history=conversation_history\n    )\n    \n    # Build attachment if IT action\n    attachment = None\n    if llm_response.get(\"attachment\"):\n        attachment = llm_response[\"attachment\"]\n    \n    # Save messages if conversation exists\n    if request.conversation_id:\n        try:\n            await db_service.add_message(\n                request.conversation_id,\n                role=\"user\",\n                content=request.query\n            )\n            await db_service.add_message(\n                request.conversation_id,\n                role=\"assistant\",\n                content=llm_response[\"content\"],\n                metadata={\"sources\": sources} if sources else None\n            )\n        except:\n            pass\n    \n    return AgentResponse(\n        content=llm_response[\"content\"],\n        attachment=attachment,\n        iam_role=x_iam_role,\n        trace_id=trace_id,\n        timestamp=datetime.now(),\n        sources=sources if llm_response.get(\"show_sources\") else None\n    )\n\n\n@app.post(\"/api/chat/agent\", response_model=AgentResponse)\nasync def chat_agent(\n    request: QueryRequest,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Main chat endpoint with agentic reasoning loop\"\"\"\n    trace_id = str(uuid.uuid4())[:8]\n    \n    # Resolve capabilities\n    capabilities = resolve_capabilities(x_iam_role)\n    \n    # Get conversation history if provided\n    conversation_history = []\n    if request.conversation_id:\n        try:\n            messages = await db_service.get_recent_messages(\n                request.conversation_id,\n                limit=6\n            )\n            conversation_history = [\n                {\"role\": m[\"role\"], \"content\": m[\"content\"]}\n                for m in messages\n            ]\n        except:\n            pass\n    \n    # Create agent and run\n    agent = AgentLoop(\n        llm_service=llm_service,\n        hybrid_retriever=hybrid_retriever,\n        code_ingestion=code_ingestion,\n        document_ingestion=document_ingestion,\n        max_steps=5\n    )\n    \n    result = await agent.run(\n        query=request.query,\n        role=x_iam_role,\n        capabilities=capabilities,\n        conversation_history=conversation_history\n    )\n    \n    # Save messages if conversation exists\n    if request.conversation_id:\n        try:\n            await db_service.add_message(\n                request.conversation_id,\n                role=\"user\",\n                content=request.query\n            )\n            await db_service.add_message(\n                request.conversation_id,\n                role=\"assistant\",\n                content=result.answer,\n                metadata={\"trace\": result.trace, \"actions\": result.actions}\n            )\n        except:\n            pass\n    \n    return AgentResponse(\n        content=result.answer,\n        attachment=result.actions[0] if result.actions else None,\n        iam_role=x_iam_role,\n        trace_id=trace_id,\n        timestamp=datetime.now(),\n        trace=result.trace,\n        actions=result.actions\n    )\n\n\n@app.post(\"/api/chat/stream\")\nasync def chat_stream(\n    body: QueryRequest,\n    request: Request,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Streaming chat endpoint using Server-Sent Events\"\"\"\n    \n    # Resolve capabilities\n    capabilities = resolve_capabilities(x_iam_role)\n    \n    # Get conversation history\n    conversation_history = []\n    if body.conversation_id:\n        try:\n            # Use request.app.state.db_service\n            messages = await request.app.state.db_service.get_recent_messages(body.conversation_id, limit=6)\n            conversation_history = [{\"role\": m[\"role\"], \"content\": m[\"content\"]} for m in messages]\n        except:\n            pass\n    \n    # Create a Queue for the stream\n    event_queue = asyncio.Queue()\n    \n    async def background_worker():\n        \"\"\"Runs the agent, pushes to queue, and saves to DB.\"\"\"\n        full_answer = \"\"\n        thoughts = []\n        actions = []\n        \n        try:\n            # Initialize agent\n            agent = AgentLoop(\n                llm_service=request.app.state.llm_service,\n                hybrid_retriever=request.app.state.hybrid_retriever,\n                code_ingestion=request.app.state.code_ingestion,\n                document_ingestion=request.app.state.document_ingestion\n            )\n            \n            async for event in agent.run_stream(\n                query=body.query,\n                role=x_iam_role,\n                capabilities=capabilities,\n                conversation_history=conversation_history\n            ):\n                # 1. Push to queue for the live client\n                await event_queue.put(event)\n                \n                # 2. Accumulate state for persistence\n                if event[\"type\"] == \"step\":\n                    thoughts.append(event) # {\"type\": \"step\", \"text\": \"...\", \"state\": \"done\"}\n                elif event[\"type\"] == \"answer\":\n                    full_answer = event[\"content\"]\n                elif event[\"type\"] == \"action_result\":\n                    actions.append(event[\"data\"])\n            \n            # 3. Persistence: Save the assistant's response to DB\n            if body.conversation_id:\n                try:\n                    # Construct the complex message content if needed, but DB currently takes 'content'.\n                    # We might want to save the trace in a separate field if DB supports it.\n                    # As a fallback, we append the trace to the content or just save the answer.\n                    # Ideally, db_service.add_message supports `metadata` or `trace`.\n                    # Let's stick to simple content for now to ensure compatibility.\n                    \n                    # For a \"true agent\", the answer is the answer. The trace is metadata.\n                    # We assume db_service.add_message(conversation_id, role, content)\n                    await request.app.state.db_service.add_message(\n                        body.conversation_id,\n                        \"assistant\",\n                        full_answer\n                    )\n                    # TODO: If DB has a `trace` column, save `thoughts` and `actions` there.\n                except Exception as db_e:\n                    print(f\"Failed to save message to DB: {db_e}\")\n                    \n        except Exception as e:\n            print(f\"Background worker error: {e}\")\n            await event_queue.put({\"type\": \"error\", \"error\": str(e)})\n        finally:\n            await event_queue.put(None) # Sentinel\n\n    # Start background task\n    asyncio.create_task(background_worker())\n\n    async def stream_generator():\n        while True:\n            try:\n                # Wait for next event\n                event = await event_queue.get()\n                \n                if event is None: # Done\n                    break\n                \n                if event.get(\"type\") == \"error\":\n                    # Optionally verify if we should signal error to stream\n                    break\n                    \n                # Yield SSE format\n                if event[\"type\"] == \"step\":\n                    yield f\"data: {json.dumps({'type': 'step', 'text': event['text'], 'state': event['state']})}\\n\\n\"\n                elif event[\"type\"] == \"action_result\":\n                    yield f\"data: {json.dumps({'type': 'action', 'data': event['data']})}\\n\\n\"\n                elif event[\"type\"] == \"answer\":\n                    yield f\"data: {json.dumps({'type': 'done', 'content': event['content']})}\\n\\n\"\n                elif event[\"type\"] == \"step_start\":\n                    pass\n\n            except asyncio.CancelledError:\n                # Client disconnected.\n                # We stop yielding, but the background_worker continues running!\n                print(f\"Stream cancelled by client for conversation {body.conversation_id}\")\n                raise\n\n    return StreamingResponse(\n        stream_generator(),\n        media_type=\"text/event-stream\",\n        headers={\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"X-Accel-Buffering\": \"no\"\n        }\n    )\n\n\n# ==================== GITHUB INGESTION ====================\n\n@app.post(\"/api/github/ingest\")\nasync def ingest_github_repo(\n    request: GitHubIngestRequest,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Ingest a GitHub repository\"\"\"\n    capabilities = resolve_capabilities(x_iam_role)\n    \n    if \"READ_CODEBASE\" not in capabilities.permissions:\n        raise HTTPException(status_code=403, detail=\"Code access not permitted\")\n    \n    # Ingest repository\n    result = await code_ingestion.ingest_github_repo(\n        github_url=request.github_url,\n        user_id=x_iam_role\n    )\n    \n    if result.get(\"status\") == \"error\":\n        raise HTTPException(status_code=400, detail=result.get(\"error\"))\n    \n    # Add chunks to ChromaDB\n    chunks = result.get(\"chunks\", [])\n    if chunks:\n        code_collection.add(\n            documents=[c[\"text\"] for c in chunks],\n            metadatas=[c[\"metadata\"] for c in chunks],\n            ids=[c[\"id\"] for c in chunks]\n        )\n        \n        # Build BM25 index\n        hybrid_retriever.build_bm25_index(chunks)\n        \n        # Update graph reference\n        hybrid_retriever.graph = code_ingestion.graph\n    \n    return {\n        \"status\": \"success\",\n        \"repo_name\": result.get(\"repo_name\"),\n        \"file_count\": result.get(\"file_count\"),\n        \"chunk_count\": result.get(\"chunk_count\"),\n        \"graph_nodes\": result.get(\"graph_nodes\"),\n        \"graph_edges\": result.get(\"graph_edges\")\n    }\n\n\n@app.get(\"/api/github/repos\")\nasync def list_repos(\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"List ingested repositories\"\"\"\n    repos = []\n    \n    if code_ingestion and code_ingestion.repos_dir.exists():\n        for repo_dir in code_ingestion.repos_dir.iterdir():\n            if repo_dir.is_dir():\n                repos.append({\n                    \"name\": repo_dir.name,\n                    \"path\": str(repo_dir)\n                })\n    \n    return {\"repos\": repos}\n\n\n@app.get(\"/api/repos/{repo_id}/graph\")\nasync def get_repo_graph(\n    repo_id: str,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Get AST graph for a repository\"\"\"\n    nodes = []\n    edges = []\n    \n    if code_ingestion and code_ingestion.graph:\n        # Get nodes and edges from NetworkX graph\n        for node_id, data in code_ingestion.graph.nodes(data=True):\n            # Filter by repo if needed\n            nodes.append({\n                \"id\": node_id,\n                \"type\": data.get(\"type\", \"unknown\"),\n                \"label\": data.get(\"name\", node_id),\n                \"file\": data.get(\"file\", \"\"),\n                \"line\": data.get(\"line\", 0)\n            })\n        \n        for source, target, data in code_ingestion.graph.edges(data=True):\n            edges.append({\n                \"source\": source,\n                \"target\": target,\n                \"type\": data.get(\"type\", \"RELATED\")\n            })\n    \n    return {\"nodes\": nodes, \"edges\": edges}\n\n\n@app.get(\"/api/repos/{repo_id}/chunks\")\nasync def get_repo_chunks(\n    repo_id: str,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Get vector chunks for a repository\"\"\"\n    chunks = []\n    \n    if code_collection:\n        try:\n            # Query all chunks (limit for performance)\n            result = code_collection.get(\n                limit=50,\n                include=[\"documents\", \"metadatas\"]\n            )\n            \n            if result and result.get(\"documents\"):\n                for i, doc in enumerate(result[\"documents\"]):\n                    meta = result[\"metadatas\"][i] if result.get(\"metadatas\") else {}\n                    chunks.append({\n                        \"id\": result[\"ids\"][i] if result.get(\"ids\") else i,\n                        \"content\": doc[:500] + \"...\" if len(doc) > 500 else doc,\n                        \"file\": meta.get(\"file_path\", \"unknown\"),\n                        \"lines\": f\"{meta.get('start_line', 0)}-{meta.get('end_line', 0)}\"\n                    })\n        except Exception as e:\n            print(f\"Error fetching chunks: {e}\")\n    \n    return {\"chunks\": chunks}\n\n\n# ==================== CONVERSATIONS ====================\n\n@app.get(\"/api/conversations\")\nasync def list_conversations(\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"List user's conversations\"\"\"\n    conversations = await db_service.get_conversations(user_id=x_iam_role)\n    return {\"conversations\": conversations}\n\n\n@app.post(\"/api/conversations\")\nasync def create_conversation(\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Create a new conversation\"\"\"\n    conversation = await db_service.create_conversation(\n        user_id=x_iam_role,\n        role=x_iam_role,\n        title=\"New Chat\"\n    )\n    return conversation\n\n\n@app.get(\"/api/conversations/{conversation_id}/messages\")\nasync def get_messages(\n    conversation_id: str,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Get messages for a conversation\"\"\"\n    messages = await db_service.get_messages(conversation_id)\n    return {\"messages\": messages}\n\n\n@app.delete(\"/api/conversations/{conversation_id}\")\nasync def delete_conversation(\n    conversation_id: str,\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Delete a conversation\"\"\"\n    success = await db_service.delete_conversation(conversation_id)\n    return {\"success\": success}\n\n\n# ==================== DOCUMENT UPLOAD ====================\n\nUPLOAD_DIR = Path(__file__).parent / \"uploads\"\nUPLOAD_DIR.mkdir(exist_ok=True)\n\n\n@app.post(\"/api/documents/upload\")\nasync def upload_document(\n    file: UploadFile = File(...),\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"Upload a document (PDF)\"\"\"\n    if not file.filename.lower().endswith('.pdf'):\n        raise HTTPException(status_code=400, detail=\"Only PDF files are supported\")\n    \n    file_id = str(uuid.uuid4())\n    safe_filename = f\"{file_id}_{file.filename}\"\n    file_path = UPLOAD_DIR / safe_filename\n    \n    with open(file_path, \"wb\") as buffer:\n        shutil.copyfileobj(file.file, buffer)\n    \n    file_size = os.path.getsize(file_path)\n    \n    # Trigger background ingestion\n    # In a real app, this should be a background task, but we'll await it for now to return stats\n    # or use asyncio.create_task if we want fire-and-forget\n    \n    ingest_stats = {}\n    if document_ingestion:\n        try:\n            # We treat this as fire-and-forget for speed, or await for immediate feedback?\n            # User wants \"Ingesting...\" progress. \n            # Let's await it so we can return the node count immediately for the UI to show.\n            ingest_stats = await document_ingestion.ingest_document(\n                file_path=str(file_path),\n                user_id=x_iam_role,\n                original_filename=file.filename\n            )\n        except Exception as e:\n            print(f\"Ingestion failed: {e}\")\n            ingest_stats = {\"error\": str(e)}\n\n    doc_record = await db_service.add_user_document(\n        user_id=x_iam_role,\n        filename=safe_filename,\n        original_filename=file.filename,\n        file_path=str(file_path),\n        file_size=file_size,\n        chunk_count=ingest_stats.get(\"chunk_count\", 0)\n    )\n    \n    return {\n        \"id\": doc_record[\"id\"],\n        \"filename\": file.filename,\n        \"status\": \"uploaded\",\n        \"ingestion\": ingest_stats\n    }\n\n\n@app.get(\"/api/documents\")\nasync def list_documents(\n    x_iam_role: str = Header(..., description=\"IAM Role of the requester\")\n):\n    \"\"\"List user's documents\"\"\"\n    documents = await db_service.get_user_documents(user_id=x_iam_role)\n    return {\"documents\": documents}\n\n\nif __name__ == \"__main__\":\n    import uvicorn\n    uvicorn.run(\n        \"main:app\",\n        host=\"0.0.0.0\",\n        port=8000,\n        reload=True,\n        log_level=\"info\"\n    )\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/main.py:chunk_3",
      "file_path": "backend/main.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 19677,
      "ingested_at": "2026-01-16T23:06:30.194141"
    }
  },
  {
    "id": "enterprise-copilot_backend/config/iam_config.py_backend/config/iam_config.py:chunk_1_2d42d146",
    "text": "\"\"\"\nIAM Configuration for DevOps Copilot V3\nDeveloper and IT-focused personas.\n\"\"\"\n\nfrom dataclasses import dataclass, field\nfrom typing import List, Dict, Any, Optional\n\n\n@dataclass",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/config/iam_config.py:chunk_1",
      "file_path": "backend/config/iam_config.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 182,
      "ingested_at": "2026-01-16T23:06:30.196827"
    }
  },
  {
    "id": "enterprise-copilot_backend/config/iam_config.py_backend/config/iam_config.py:chunk_2_29b6172d",
    "text": "RoleCapabilities:\n    \"\"\"Capabilities for a given IAM role.\"\"\"\n    permissions: List[str] = field(default_factory=list)\n    scopes: List[str] = field(default_factory=list)\n    data_access: str = \"none\"\n    \n    def can(self, action: str) -> bool:\n        \"\"\"Check if role has permission for action.\"\"\"\n        return action in self.permissions\n\n\n# Developer and IT personas\nPERSONA_DEFINITIONS = {\n    \"sde_ii\": {\n        \"id\": \"sde_ii_01\",\n        \"name\": \"Alex Rivera\",\n        \"role\": \"sde_ii\",\n        \"permissions\": [\n            \"READ_CODEBASE\",\n            \"WRITE_JIRA\",\n            \"READ_DOCS\",\n            \"SEARCH_CODE\",\n            \"VIEW_ARCHITECTURE\"\n        ],\n        \"context\": \"Software Development\",\n        \"description\": \"Senior Developer with full codebase access\",\n        \"emoji\": \"\ud83d\udc68\u200d\ud83d\udcbb\",\n        \"color\": \"bg-blue-100 text-blue-700\",\n        \"accent\": \"bg-blue-500\",\n        \"suggested\": [\n            \"How does the authentication flow work?\",\n            \"Find all API endpoints\",\n            \"Explain the database schema\"\n        ]\n    },\n    \"principal_architect\": {\n        \"id\": \"architect_01\",\n        \"name\": \"Jordan Chen\",\n        \"role\": \"principal_architect\",\n        \"permissions\": [\n            \"READ_CODEBASE\",\n            \"READ_ARCHITECTURE\",\n            \"WRITE_DESIGN\",\n            \"SEARCH_CODE\",\n            \"VIEW_ALL_SYSTEMS\",\n            \"REVIEW_PATTERNS\"\n        ],\n        \"context\": \"Architecture & Design\",\n        \"description\": \"Principal Architect with system-wide view\",\n        \"emoji\": \"\ud83c\udfd7\ufe0f\",\n        \"color\": \"bg-purple-100 text-purple-700\",\n        \"accent\": \"bg-purple-500\",\n        \"suggested\": [\n            \"Analyze the system architecture\",\n            \"Find dependency patterns\",\n            \"Review service boundaries\"\n        ]\n    },\n    \"it_analyst\": {\n        \"id\": \"it_analyst_01\",\n        \"name\": \"Morgan Kim\",\n        \"role\": \"it_analyst\",\n        \"permissions\": [\n            \"RUN_HEALTHCHECKS\",\n            \"READ_LOGS\",\n            \"VIEW_METRICS\",\n            \"CHECK_SERVICES\",\n            \"READ_DOCS\",\n            \"SCHEDULE_MEETING\"\n        ],\n        \"context\": \"IT Operations\",\n        \"description\": \"IT Solutions Analyst with operations access\",\n        \"emoji\": \"\ud83d\udd27\",\n        \"color\": \"bg-emerald-100 text-emerald-700\",\n        \"accent\": \"bg-emerald-500\",\n        \"suggested\": [\n            \"Check API health status\",\n            \"Get recent error logs\",\n            \"List running containers\"\n        ]\n    }\n}\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/config/iam_config.py:chunk_2",
      "file_path": "backend/config/iam_config.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2483,
      "ingested_at": "2026-01-16T23:06:30.196833"
    }
  },
  {
    "id": "enterprise-copilot_backend/config/iam_config.py_backend/config/iam_config.py:chunk_3_899a22e5",
    "text": "IAMConfig:\n    \"\"\"IAM configuration manager.\"\"\"\n    \n    def __init__(self):\n        self.personas = {}\n        self.role_capabilities = {}\n    \n    async def load(self):\n        \"\"\"Load IAM configuration.\"\"\"\n        self.personas = PERSONA_DEFINITIONS.copy()\n        \n        for role_id, persona in self.personas.items():\n            self.role_capabilities[role_id] = RoleCapabilities(\n                permissions=persona[\"permissions\"],\n                scopes=[persona[\"context\"]],\n                data_access=\"full\" if \"READ_CODEBASE\" in persona[\"permissions\"] else \"limited\"\n            )\n        \n        print(f\"\ud83d\udccb Loaded IAM configuration for {len(self.personas)} personas\")\n    \n    def get_capabilities(self, role: str) -> RoleCapabilities:\n        \"\"\"Get capabilities for a role.\"\"\"\n        return self.role_capabilities.get(\n            role.lower(), \n            RoleCapabilities(permissions=[\"READ_DOCS\"])\n        )\n    \n    def has_permission(self, role: str, permission: str) -> bool:\n        \"\"\"Check if role has a specific permission.\"\"\"\n        caps = self.get_capabilities(role.lower())\n        return permission in caps.permissions\n    \n    def get_personas(self) -> List[Dict[str, Any]]:\n        \"\"\"Get all personas.\"\"\"\n        return list(self.personas.values())\n\n\ndef resolve_capabilities(role: str) -> RoleCapabilities:\n    \"\"\"Resolve capabilities for a given role.\"\"\"\n    role_lower = role.lower()\n    \n    if role_lower in PERSONA_DEFINITIONS:\n        persona = PERSONA_DEFINITIONS[role_lower]\n        return RoleCapabilities(\n            permissions=persona[\"permissions\"],\n            scopes=[persona[\"context\"]],\n            data_access=\"full\" if \"READ_CODEBASE\" in persona[\"permissions\"] else \"limited\"\n        )\n    \n    # Default minimal permissions\n    return RoleCapabilities(permissions=[\"READ_DOCS\"])\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/config/iam_config.py:chunk_3",
      "file_path": "backend/config/iam_config.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1837,
      "ingested_at": "2026-01-16T23:06:30.196839"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/document_ingestion.py_backend/services/document_ingestion.py:chunk_1_1c709649",
    "text": "\"\"\"\nDocument Ingestion Service\nHandles PDF extraction, chunking, and Knowledge Graph construction (Concepts + Sequential).\n\"\"\"\n\nimport os\nimport uuid\nimport asyncio\nfrom pathlib import Path\nfrom typing import List, Dict, Any, Optional\nfrom datetime import datetime\nimport re\nfrom collections import Counter\nimport math\n\n# PDF Processing\nimport PyPDF2\n\n# Graph\nimport networkx as nx\n\n# Embeddings (using the same model as code for consistency, or text model)\n# We'll assume the same embedding service or key is used.\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/document_ingestion.py:chunk_1",
      "file_path": "backend/services/document_ingestion.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 516,
      "ingested_at": "2026-01-16T23:06:30.199695"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/document_ingestion.py_backend/services/document_ingestion.py:chunk_2_d4eee23b",
    "text": "DocumentIngestionService:\n    \"\"\"\n    Ingests documents into a Knowledge Graph.\n    Nodes: Chunks (text) and Concepts (keywords).\n    Edges: NEXT (chunk->chunk), MENTIONS (chunk->concept).\n    \"\"\"\n\n    def __init__(self, upload_dir: Optional[str] = None):\n        if upload_dir is None:\n            self.upload_dir = Path(__file__).parent.parent / \"uploads\"\n        else:\n            self.upload_dir = Path(upload_dir)\n        \n        self.upload_dir.mkdir(exist_ok=True)\n        self.graph = nx.DiGraph()\n        \n        # Concept extraction settings\n        self.min_concept_freq = 2\n        self.stop_words = set([\n            \"the\", \"and\", \"or\", \"of\", \"to\", \"a\", \"in\", \"is\", \"that\", \"for\", \"it\", \"as\", \"was\", \"with\", \"on\",\n            \"at\", \"by\", \"be\", \"this\", \"which\", \"from\", \"but\", \"not\", \"are\", \"can\", \"an\", \"if\", \"we\", \"you\",\n            \"all\", \"has\", \"have\", \"they\", \"their\", \"one\", \"more\", \"when\", \"document\", \"file\", \"page\", \"section\"\n        ])\n\n    async def ingest_document(self, file_path: str, user_id: str, original_filename: str) -> Dict[str, Any]:\n        \"\"\"\n        Process a document: Extract -> Chunk -> Build Graph.\n        Returns stats about the ingestion.\n        \"\"\"\n        try:\n            print(f\"\ud83d\udcc4 Processing {original_filename}...\")\n            \n            # 1. Extract Text\n            content = await self._extract_text(file_path)\n            if not content:\n                raise ValueError(\"No text extracted/empty file\")\n\n            # 2. Chunking (Paragraph/Recursive)\n            chunks = self._chunk_text(content, original_filename, user_id)\n            print(f\"\ud83e\udde9 Created {len(chunks)} chunks\")\n\n            # 3. Concept Extraction (Heuristic TF-IDF style on this doc)\n            concepts = self._extract_concepts(chunks)\n            print(f\"\ud83e\udde0 Extracted {len(concepts)} key concepts\")\n\n            # 4. Build Graph\n            node_count, edge_count = await self._build_document_graph(chunks, concepts, original_filename)\n\n            return {\n                \"status\": \"success\",\n                \"file_path\": file_path,\n                \"chunk_count\": len(chunks),\n                \"concept_count\": len(concepts),\n                \"graph_nodes\": node_count,\n                \"graph_edges\": edge_count\n            }\n        \n        except Exception as e:\n            print(f\"\u274c Document ingestion error: {e}\")\n            return {\"status\": \"error\", \"error\": str(e)}\n\n    async def _extract_text(self, file_path: str) -> str:\n        \"\"\"Extract text from PDF or Text file.\"\"\"\n        path = Path(file_path)\n        content = \"\"\n        \n        if path.suffix.lower() == '.pdf':\n            def read_pdf():\n                text = \"\"\n                with open(path, 'rb') as f:\n                    reader = PyPDF2.PdfReader(f)\n                    for page in reader.pages:\n                        text += page.extract_text() + \"\\n\\n\"\n                return text\n            \n            loop = asyncio.get_event_loop()\n            content = await loop.run_in_executor(None, read_pdf)\n        else:\n            # Assume text/md\n            with open(path, 'r', encoding='utf-8', errors='ignore') as f:\n                content = f.read()\n        \n        return content\n\n    def _chunk_text(self, text: str, filename: str, user_id: str, chunk_size: int = 1000, overlap: int = 100) -> List[Dict[str, Any]]:\n        \"\"\"\n        Split text into chunks. \n        Uses double newline (paragraphs) as primary split, then length.\n        \"\"\"\n        # Simple recursive-like split on paragraphs\n        paragraphs = text.split('\\n\\n')\n        chunks = []\n        current_chunk = \"\"\n        \n        chunk_id_counter = 0\n        \n        for para in paragraphs:\n            para = para.strip()\n            if not para:\n                continue\n                \n            if len(current_chunk) + len(para) > chunk_size:\n                # Flush current chunk\n                if current_chunk:\n                    chunks.append(self._create_chunk_obj(current_chunk, filename, user_id, chunk_id_counter))\n                    chunk_id_counter += 1\n                    # Start new chunk with overlap (last few words of prev)\n                    overlap_text = \" \".join(current_chunk.split()[-20:]) \n                    current_chunk = overlap_text + \"\\n\\n\" + para\n                else:\n                    # Para is massive, force split it\n                    # (Simplified: just take it as is for now, or could split by chars)\n                    chunks.append(self._create_chunk_obj(para, filename, user_id, chunk_id_counter))\n                    chunk_id_counter += 1\n                    current_chunk = \"\"\n            else:\n                if current_chunk:\n                    current_chunk += \"\\n\\n\"\n                current_chunk += para\n        \n        if current_chunk:\n             chunks.append(self._create_chunk_obj(current_chunk, filename, user_id, chunk_id_counter))\n             \n        return chunks\n\n    def _create_chunk_obj(self, text: str, filename: str, user_id: str, index: int) -> Dict[str, Any]:\n        return {\n            \"id\": f\"{filename}_chunk_{index}_{uuid.uuid4().hex[:6]}\",\n            \"text\": text,\n            \"metadata\": {\n                \"type\": \"document_chunk\",\n                \"filename\": filename,\n                \"user_id\": user_id,\n                \"chunk_index\": index,\n                \"created_at\": datetime.now().isoformat()\n            }\n        }\n\n    def _extract_concepts(self, chunks: List[Dict[str, Any]]) -> List[str]:\n        \"\"\"\n        Extract key concepts based on frequency and capitalization (heuristic).\n        Finds Proper Nouns or frequent technical terms.\n        \"\"\"\n        all_text = \" \".join([c[\"text\"] for c in chunks])\n        words = re.findall(r'\\b[A-Za-z][a-zA-Z0-9_-]+\\b', all_text)\n        \n        # Filter stopwords and short words\n        filtered = [w for w in words if w.lower() not in self.stop_words and len(w) > 2]\n        \n        # Count freq\n        counts = Counter(filtered)\n        \n        # Calculate dynamic threshold (e.g., top 10% or min_freq)\n        concepts = [word for word, count in counts.items() if count >= self.min_concept_freq]\n        \n        # Limit to top 20 concepts per doc to keep graph clean\n        top_concepts = sorted(concepts, key=lambda x: counts[x], reverse=True)[:20]\n        return top_concepts\n\n    async def _build_document_graph(self, chunks: List[Dict[str, Any]], concepts: List[str], filename: str):\n        \"\"\"Build NetworkX graph for the document.\"\"\"\n        \n        # 1. Add Chunk Nodes and NEXT edges\n        prev_chunk_id = None\n        for chunk in chunks:\n            chunk_id = chunk[\"id\"]\n            self.graph.add_node(chunk_id, type=\"chunk\", text=chunk[\"text\"][:100]+\"...\", full_text=chunk[\"text\"], **chunk[\"metadata\"])\n            \n            if prev_chunk_id:\n                self.graph.add_edge(prev_chunk_id, chunk_id, type=\"NEXT\")\n            \n            prev_chunk_id = chunk_id\n\n        # 2. Add Concept Nodes and MENTIONS edges\n        # Normalize concepts for matching\n        concept_set = set(concepts)\n        \n        for concept in concepts:\n            concept_id = f\"concept::{concept.lower()}\"\n            self.graph.add_node(concept_id, type=\"concept\", name=concept, filename=filename)\n        \n        for chunk in chunks:\n            chunk_id = chunk[\"id\"]\n            chunk_text_lower = chunk[\"text\"].lower()\n            \n            for concept in concepts:\n                if concept.lower() in chunk_text_lower:\n                    concept_id = f\"concept::{concept.lower()}\"\n                    # MENTIONS edge\n                    self.graph.add_edge(chunk_id, concept_id, type=\"MENTIONS\")\n        \n        return self.graph.number_of_nodes(), self.graph.number_of_edges()\n\n    async def get_context_for_query(self, query: str) -> str:\n        \"\"\"\n        Retrieve context using graph traversal.\n        1. Find matching Concept nodes.\n        2. Retrieve linked Chunk nodes (MENTIONS).\n        3. Return text of top chunks.\n        \"\"\"\n        if not self.graph.nodes():\n            return \"No documents ingested properly.\"\n            \n        params = query.lower().split()\n        relevant_chunks = []\n        \n        # 1. Find matched concepts\n        matched_concepts = []\n        for node, data in self.graph.nodes(data=True):\n            if data.get(\"type\") == \"concept\":\n                if data[\"name\"].lower() in params or any(p in data[\"name\"].lower() for p in params):\n                    matched_concepts.append(node)\n        \n        # 2. Get adjacent chunks\n        for concept_node in matched_concepts:\n            neighbors = self.graph.neighbors(concept_node)\n            for neighbor in neighbors: # Since edges are directed, check direction? \n                # MENTIONS is Chunk -> Concept. So we need predecessors of concept.\n                pass\n            \n            # Using predecessors for Chunk -> Concept\n            predecessors = self.graph.predecessors(concept_node)\n            for pred in predecessors:\n                node_data = self.graph.nodes[pred]\n                if node_data.get(\"type\") == \"chunk\":\n                    relevant_chunks.append(node_data[\"text\"])\n\n        # Fallback: Simple text match on chunks if no concepts found or just to boost\n        for node, data in self.graph.nodes(data=True):\n            if data.get(\"type\") == \"chunk\":\n                if any(p in data[\"text\"].lower() for p in params):\n                    relevant_chunks.append(data[\"text\"])\n\n        if not relevant_chunks:\n            return \"No relevant information found in documents.\"\n            \n        # Deduplicate and format\n        unique_chunks = list(set(relevant_chunks))\n        return \"\\n---\\n\".join(unique_chunks[:5]) \n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/document_ingestion.py:chunk_2",
      "file_path": "backend/services/document_ingestion.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 9751,
      "ingested_at": "2026-01-16T23:06:30.199702"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/rag_service.py_backend/services/rag_service.py:chunk_1_3229fc5c",
    "text": "\"\"\"\nRAG Service with ChromaDB\nAdvanced document retrieval with metadata filtering and reranking\n\"\"\"\n\nimport asyncio\nfrom typing import List, Dict, Any, Optional\nfrom pathlib import Path\nimport chromadb\nfrom chromadb.config import Settings\nfrom chromadb.utils import embedding_functions\nimport PyPDF2\nfrom datetime import datetime\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/rag_service.py:chunk_1",
      "file_path": "backend/services/rag_service.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 331,
      "ingested_at": "2026-01-16T23:06:30.201665"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/rag_service.py_backend/services/rag_service.py:chunk_2_19799ebc",
    "text": "RAGService:\n    \"\"\"\n    RAG (Retrieval Augmented Generation) Service\n    - Document ingestion with metadata extraction\n    - Semantic search with IAM filtering\n    - Page-level citations\n    \"\"\"\n    \n    def __init__(\n        self,\n        collection_name: str = \"enterprise_documents\",\n        persist_directory: str = \"./chroma_db\"\n    ):\n        # Initialize ChromaDB client (Persistent)\n        self.client = chromadb.PersistentClient(path=persist_directory)\n        \n        # Use sentence transformers embedding (or Ollama nomic-embed-text)\n        self.embedding_function = embedding_functions.SentenceTransformerEmbeddingFunction(\n            model_name=\"all-MiniLM-L6-v2\"  # Fast and efficient\n        )\n        \n        # Get or create collection\n        try:\n            self.collection = self.client.get_collection(\n                name=collection_name,\n                embedding_function=self.embedding_function\n            )\n            print(f\"\ud83d\udcda Loaded existing collection: {collection_name}\")\n        except:\n            self.collection = self.client.create_collection(\n                name=collection_name,\n                embedding_function=self.embedding_function,\n                metadata={\"description\": \"Enterprise documents with IAM metadata\"}\n            )\n            print(f\"\ud83d\udcda Created new collection: {collection_name}\")\n        \n        self.docs_path = Path(__file__).parent.parent.parent / \"docs\"\n    \n    async def ingest_documents(self) -> Dict[str, Any]:\n        \"\"\"\n        Ingest all PDF documents from docs/ folder\n        Extract text, metadata, and create embeddings\n        \"\"\"\n        print(\"\ud83d\udce5 Starting document ingestion...\")\n        \n        pdf_files = list(self.docs_path.glob(\"*.pdf\"))\n        if not pdf_files:\n            return {\"status\": \"no_documents\", \"message\": \"No PDF files found in docs/\"}\n        \n        total_chunks = 0\n        \n        for pdf_path in pdf_files:\n            print(f\"Processing: {pdf_path.name}\")\n            \n            # Extract text from PDF\n            chunks = await self._extract_pdf_chunks(pdf_path)\n            \n            # Add to ChromaDB\n            if chunks:\n                self.collection.add(\n                    documents=[chunk[\"text\"] for chunk in chunks],\n                    metadatas=[chunk[\"metadata\"] for chunk in chunks],\n                    ids=[chunk[\"id\"] for chunk in chunks]\n                )\n                total_chunks += len(chunks)\n                print(f\"  \u2713 Added {len(chunks)} chunks\")\n        \n        print(f\"\u2705 Ingestion complete: {total_chunks} chunks from {len(pdf_files)} documents\")\n        \n        return {\n            \"status\": \"success\",\n            \"documents_processed\": len(pdf_files),\n            \"total_chunks\": total_chunks\n        }\n    \n    async def _extract_pdf_chunks(\n        self,\n        pdf_path: Path,\n        chunk_size: int = 1000,\n        overlap: int = 200\n    ) -> List[Dict[str, Any]]:\n        \"\"\"\n        Extract text chunks from PDF with metadata\n        Chunks are created at semantic boundaries (pages first, then paragraphs)\n        \"\"\"\n        chunks = []\n        \n        try:\n            with open(pdf_path, 'rb') as file:\n                pdf_reader = PyPDF2.PdfReader(file)\n                num_pages = len(pdf_reader.pages)\n                \n                for page_num in range(num_pages):\n                    page = pdf_reader.pages[page_num]\n                    page_text = page.extract_text()\n                    \n                    if not page_text.strip():\n                        continue\n                    \n                    # Determine document category and sensitivity\n                    doc_name = pdf_path.stem.lower()\n                    category, sensitivity = self._classify_document(doc_name)\n                    \n                    # Create chunks from page text\n                    page_chunks = self._create_text_chunks(\n                        text=page_text,\n                        chunk_size=chunk_size,\n                        overlap=overlap\n                    )\n                    \n                    # Add metadata to each chunk\n                    for idx, chunk_text in enumerate(page_chunks):\n                        chunk_id = f\"{pdf_path.stem}_p{page_num+1}_c{idx}\"\n                        \n                        chunks.append({\n                            \"id\": chunk_id,\n                            \"text\": chunk_text,\n                            \"metadata\": {\n                                \"document_name\": pdf_path.name,\n                                \"document_category\": category,\n                                \"sensitivity_level\": sensitivity,\n                                \"page_number\": page_num + 1,\n                                \"total_pages\": num_pages,\n                                \"chunk_index\": idx,\n                                \"ingestion_timestamp\": datetime.now().isoformat()\n                            }\n                        })\n        \n        except Exception as e:\n            print(f\"Error processing {pdf_path.name}: {e}\")\n        \n        return chunks\n    \n    def _classify_document(self, filename: str) -> tuple[str, int]:\n        \"\"\"\n        Classify document type and sensitivity level\n        Returns: (category, sensitivity_level)\n        Sensitivity: 1=Public, 2=Internal, 3=Confidential, 4=Restricted\n        \"\"\"\n        if \"annual\" in filename or \"report\" in filename or \"financial\" in filename:\n            return (\"Financial Report\", 3)  # Confidential\n        elif \"employee\" in filename or \"hr\" in filename or \"policy\" in filename:\n            return (\"HR Policy\", 4)  # Restricted (PII)\n        elif \"strategy\" in filename or \"roadmap\" in filename:\n            return (\"Strategy Document\", 3)  # Confidential\n        elif \"technical\" in filename or \"architecture\" in filename:\n            return (\"Technical Document\", 2)  # Internal\n        else:\n            return (\"General Document\", 2)  # Internal\n    \n    def _create_text_chunks(\n        self,\n        text: str,\n        chunk_size: int = 500, # Approx chars\n        overlap: int = 50\n    ) -> List[str]:\n        \"\"\"\n        Create overlapping text chunks using sentence boundaries\n        Much more robust than word splitting.\n        \"\"\"\n        import re\n        \n        # Split by sentence endings (.?!) followed by space or newline\n        sentences = re.split(r'(?<=[.?!])\\s+', text)\n        \n        chunks = []\n        current_chunk = []\n        current_length = 0\n        \n        for sentence in sentences:\n            sentence_len = len(sentence)\n            \n            if current_length + sentence_len > chunk_size and current_chunk:\n                # Store current chunk\n                chunks.append(\" \".join(current_chunk))\n                \n                # Start new chunk with overlap (keep last few sentences if possible)\n                # Simple overlap: keep last sentence\n                last_sent = current_chunk[-1]\n                current_chunk = [last_sent] if len(last_sent) < chunk_size else []\n                current_length = len(last_sent) if len(last_sent) < chunk_size else 0\n            \n            current_chunk.append(sentence)\n            current_length += sentence_len\n        \n        if current_chunk:\n            chunks.append(\" \".join(current_chunk))\n            \n        return chunks\n    \n    async def retrieve(\n        self,\n        query: str,\n        role: str,\n        top_k: int = 5,\n        filters: Optional[Dict[str, Any]] = None\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Retrieve relevant document chunks with IAM filtering\n        \"\"\"\n        # Query ChromaDB with metadata filters\n        where_clause = filters if filters else {}\n        \n        try:\n            results = self.collection.query(\n                query_texts=[query],\n                n_results=top_k,\n                where=where_clause\n            )\n            \n            # Format results\n            chunks = []\n            sources = []\n            \n            if results[\"documents\"] and results[\"documents\"][0]:\n                for i in range(len(results[\"documents\"][0])):\n                    metadata = results[\"metadatas\"][0][i]\n                    \n                    chunks.append({\n                        \"text\": results[\"documents\"][0][i],\n                        \"metadata\": metadata\n                    })\n                    \n                    sources.append({\n                        \"document\": metadata.get(\"document_name\", \"Unknown\"),\n                        \"page\": metadata.get(\"page_number\", 0),\n                        \"category\": metadata.get(\"document_category\", \"General\"),\n                        \"relevance_score\": 1 - results[\"distances\"][0][i] if \"distances\" in results else 1.0\n                    })\n            \n            return {\n                \"chunks\": chunks,\n                \"sources\": sources,\n                \"total_found\": len(chunks)\n            }\n        \n        except Exception as e:\n            print(f\"Error retrieving documents: {e}\")\n            return {\"chunks\": [], \"sources\": [], \"total_found\": 0}\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/rag_service.py:chunk_2",
      "file_path": "backend/services/rag_service.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 9106,
      "ingested_at": "2026-01-16T23:06:30.201684"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/agent_loop.py_backend/services/agent_loop.py:chunk_1_ca871c08",
    "text": "\"\"\"\nAgent Loop for DevOps Copilot V3\nReAct-style reasoning with tool execution.\n\"\"\"\n\nfrom typing import Dict, Any, List, Optional\nfrom pydantic import BaseModel\nimport json\nimport re\nfrom datetime import datetime\n\n\nclass AgentStep(BaseModel):\n    \"\"\"Single step in agent execution\"\"\"\n    step_num: int\n    thought: str\n    action: Optional[str] = None\n    action_input: Optional[Dict[str, Any]] = None\n    observation: Optional[str] = None\n    \n\nclass AgentResult(BaseModel):\n    \"\"\"Final result from agent execution\"\"\"\n    answer: str\n    trace: List[Dict[str, Any]]\n    actions: List[Dict[str, Any]]\n    \n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/agent_loop.py:chunk_1",
      "file_path": "backend/services/agent_loop.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 607,
      "ingested_at": "2026-01-16T23:06:30.204225"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/agent_loop.py_backend/services/agent_loop.py:chunk_2_7e3d92d5",
    "text": "AgentLoop:\n    \"\"\"\n    ReAct-style reasoning loop.\n    \n    While not done:\n      1. Think (LLM decides next action)\n      2. Act (execute tool)\n      3. Observe (capture output)\n      4. Repeat or respond\n    \"\"\"\n    \n    def __init__(\n        self,\n        llm_service,\n        hybrid_retriever,\n        code_ingestion=None,\n        document_ingestion=None,\n        max_steps: int = 5\n    ):\n        self.llm = llm_service\n        self.retriever = hybrid_retriever\n        self.code_ingestion = code_ingestion\n        self.document_ingestion = document_ingestion\n        self.max_steps = max_steps\n        \n        # Tool registry\n        self.tools = {\n            \"search_code\": self._search_code,\n            \"search_docs\": self._search_docs,\n            \"jira_create\": self._jira_create,\n            \"slack_post\": self._slack_post,\n            \"k8s_exec\": self._k8s_exec,\n            \"calendar_event\": self._calendar_event,\n            \"final_answer\": self._final_answer,\n        }\n        \n        self.tool_descriptions = \"\"\"\nAvailable Tools:\n- search_code: Search the indexed codebase for relevant code snippets. Input: {\"query\": \"search terms\"}\n- search_docs: Search uploaded documents. Input: {\"query\": \"search terms\"}\n- jira_create: Create a JIRA ticket. Input: {\"summary\": \"...\", \"description\": \"...\", \"priority\": \"High/Medium/Low\"}\n- slack_post: Post a message to Slack. Input: {\"channel\": \"#channel-name\", \"message\": \"...\"}\n- k8s_exec: Execute a Kubernetes command. Input: {\"command\": \"kubectl ...\"}\n- calendar_event: Create a calendar event. Input: {\"title\": \"...\", \"participants\": [...], \"time\": \"...\"}\n- final_answer: Provide the final answer to the user. Input: {\"answer\": \"your response\"}\n\"\"\"\n\n    async def run(\n        self,\n        query: str,\n        role: str,\n        capabilities,\n        conversation_history: List[Dict[str, Any]] = None\n    ) -> AgentResult:\n        \"\"\"Execute the agent loop (non-streaming wrapper)\"\"\"\n        trace = []\n        actions = []\n        answer = \"\"\n        \n        async for event in self.run_stream(query, role, capabilities, conversation_history):\n            if event[\"type\"] == \"step\":\n                trace.append({\n                    \"step\": len(trace) + 1,\n                    \"text\": event[\"text\"],\n                    \"state\": event[\"state\"]\n                })\n            elif event[\"type\"] == \"action\":\n                # Actions are collected in run_stream's internal logic, \n                # but we need them in the result. \n                # Simpler: extraction from the stream events if needed\n                pass \n            elif event[\"type\"] == \"answer\":\n                answer += event.get(\"content\", \"\")\n            elif event[\"type\"] == \"action_result\":\n                actions.append(event[\"data\"])\n                \n        return AgentResult(\n            answer=answer,\n            trace=trace,\n            actions=actions\n        )\n\n    async def run_stream(\n        self,\n        query: str,\n        role: str,\n        capabilities,\n        conversation_history: List[Dict[str, Any]] = None\n    ):\n        \"\"\"Execute the agent loop yielding events\"\"\"\n        step_num = 0\n        context = f\"\"\"User Query: {query}\nRole: {role}\nPermissions: {', '.join(capabilities.permissions)}\n\n{self.tool_descriptions}\n\nYou must respond in the following format:\nThought: [your reasoning about what to do next]\nAction: [tool name from the list above]\nAction Input: [JSON input for the tool]\n\nWhen you have enough information to answer, use the 'final_answer' tool.\n\"\"\"\n        \n        while step_num < self.max_steps:\n            step_num += 1\n            \n            # Yield thinking start\n            yield {\"type\": \"step\", \"text\": f\"Step {step_num}: Analyzing...\", \"state\": \"processing\"}\n            \n            # Think: Ask LLM what to do\n            think_response = await self._think(context, conversation_history)\n            \n            # Parse response\n            thought, action, action_input = self._parse_response(think_response)\n            \n            # Yield step update\n            yield {\"type\": \"step\", \"text\": f\"Step {step_num}: {thought[:80]}...\", \"state\": \"done\"}\n            \n            # Check if done\n            if action == \"final_answer\":\n                answer = action_input.get(\"answer\", think_response)\n                yield {\"type\": \"answer\", \"content\": answer}\n                return\n            \n            # Act: Execute tool\n            if action in self.tools:\n                yield {\"type\": \"step\", \"text\": f\"Executing {action}...\", \"state\": \"processing\"}\n                \n                try:\n                    observation = await self.tools[action](action_input, role)\n                except Exception as e:\n                    observation = f\"Error executing tool {action}: {str(e)}\"\n                \n                # Truncate observation\n                max_obs_len = 1000\n                if len(str(observation)) > max_obs_len:\n                    observation_truncated = str(observation)[:max_obs_len] + f\"... (truncated)\"\n                else:\n                    observation_truncated = str(observation)\n                \n                # Yield action result\n                if action in [\"jira_create\", \"slack_post\", \"k8s_exec\", \"calendar_event\"]:\n                    action_data = {\n                        \"system\": action.split(\"_\")[0].upper() if \"_\" in action else action.upper(),\n                        \"status\": \"EXECUTED\",\n                        \"payload\": action_input,\n                        \"result\": observation_truncated\n                    }\n                    yield {\"type\": \"action_result\", \"data\": action_data}\n                \n                yield {\"type\": \"step\", \"text\": f\"Executing {action}...\", \"state\": \"done\"}\n                \n                # Update context\n                context += f\"\\n\\nStep {step_num}:\\nThought: {thought}\\nAction: {action}\\nAction Input: {json.dumps(action_input)}\\nObservation: {observation_truncated}\\n\"\n            else:\n                context += f\"\\n\\nStep {step_num}:\\nThought: {thought}\\nAction: {action}\\nObservation: Unknown tool '{action}'. Available tools: {list(self.tools.keys())}\\n\"\n        \n        # Max steps reached\n        yield {\"type\": \"answer\", \"content\": \"I've reached my reasoning limit. \" + trace[-1].get(\"thought\", \"\") if trace else \"\"}\n    \n    async def _think(self, context: str, history: List[Dict[str, Any]] = None) -> str:\n        \"\"\"Get LLM to think about next step\"\"\"\n        prompt = f\"\"\"{context}\n\nNow, think step by step about what to do next.\"\"\"\n        \n        try:\n            response = await self.llm._call_ollama(\n                prompt,\n                system=\"You are an AI agent that reasons step-by-step to answer user queries. Follow the ReAct format: Thought, Action, Action Input.\"\n            )\n            return response\n        except Exception as e:\n            return f\"Thought: I encountered an error. Let me provide a direct answer.\\nAction: final_answer\\nAction Input: {{\\\"answer\\\": \\\"I apologize, but I encountered an issue processing your request.\\\"}}\"\n    \n    def _parse_response(self, response: str) -> tuple:\n        \"\"\"Parse LLM response into thought, action, action_input\"\"\"\n        thought = \"\"\n        action = \"final_answer\"\n        action_input = {}\n        \n        # Extract thought\n        thought_match = re.search(r'Thought:\\s*(.+?)(?=Action:|$)', response, re.DOTALL)\n        if thought_match:\n            thought = thought_match.group(1).strip()\n        \n        # Extract action\n        action_match = re.search(r'Action:\\s*(\\w+)', response)\n        if action_match:\n            action = action_match.group(1).strip()\n        \n        # Extract action input\n        input_match = re.search(r'Action Input:\\s*({.+?})', response, re.DOTALL)\n        if input_match:\n            try:\n                action_input = json.loads(input_match.group(1))\n            except json.JSONDecodeError:\n                action_input = {\"raw\": input_match.group(1)}\n        \n        return thought, action, action_input\n    \n    # ==================== TOOL IMPLEMENTATIONS ====================\n    \n    async def _search_code(self, input: Dict, role: str) -> str:\n        \"\"\"Search codebase\"\"\"\n        query = input.get(\"query\", \"\")\n        if self.retriever:\n            results = await self.retriever.hybrid_search(query, top_k=3)\n            if results:\n                return \"\\n\".join([\n                    f\"[{r.get('file_path', 'unknown')}] {r.get('text', '')[:200]}...\"\n                    for r in results\n                ])\n        return \"No code results found.\"\n    \n    async def _search_docs(self, input: Dict, role: str) -> str:\n        \"\"\"Search documents using Knowledge Graph\"\"\"\n        query = input.get(\"query\", \"\")\n        if self.document_ingestion:\n            return await self.document_ingestion.get_context_for_query(query)\n        return \"Document ingestion service not available.\"\n    \n    async def _jira_create(self, input: Dict, role: str) -> str:\n        \"\"\"Create JIRA ticket (mock)\"\"\"\n        summary = input.get(\"summary\", \"New Ticket\")\n        priority = input.get(\"priority\", \"Medium\")\n        ticket_id = f\"DEV-{datetime.now().strftime('%H%M%S')}\"\n        return f\"Created JIRA ticket {ticket_id}: '{summary}' with priority {priority}\"\n    \n    async def _slack_post(self, input: Dict, role: str) -> str:\n        \"\"\"Post to Slack (mock)\"\"\"\n        channel = input.get(\"channel\", \"#general\")\n        message = input.get(\"message\", \"\")\n        return f\"Posted to {channel}: {message[:100]}...\"\n    \n    async def _k8s_exec(self, input: Dict, role: str) -> str:\n        \"\"\"Execute K8s command (mock)\"\"\"\n        command = input.get(\"command\", \"kubectl get pods\")\n        \n        # Mock output\n        mock_outputs = {\n            \"get pods\": \"NAME                     READY   STATUS    RESTARTS   AGE\\napi-gateway-7f9d8c6b4-x2k3m   1/1     Running   0          3h\\npayments-v2-5c8d7b4a3-y9n8z   1/1     Running   0          1h\",\n            \"get nodes\": \"NAME           STATUS   ROLES    AGE   VERSION\\nmaster-01      Ready    master   30d   v1.28.0\\nworker-01      Ready    <none>   30d   v1.28.0\",\n            \"get services\": \"NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE\\nkubernetes   ClusterIP   10.96.0.1      <none>        443/TCP   30d\"\n        }\n        \n        for key, output in mock_outputs.items():\n            if key in command.lower():\n                return f\"$ {command}\\n{output}\"\n        \n        return f\"$ {command}\\nCommand executed successfully.\"\n    \n    async def _calendar_event(self, input: Dict, role: str) -> str:\n        \"\"\"Create calendar event (mock)\"\"\"\n        title = input.get(\"title\", \"Meeting\")\n        participants = input.get(\"participants\", [])\n        time = input.get(\"time\", \"Tomorrow 10:00 AM\")\n        \n        return f\"Created calendar event: '{title}' at {time} with {len(participants)} participants\"\n    \n    async def _final_answer(self, input: Dict, role: str) -> str:\n        \"\"\"Provide final answer\"\"\"\n        return input.get(\"answer\", \"\")\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/agent_loop.py:chunk_2",
      "file_path": "backend/services/agent_loop.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 11095,
      "ingested_at": "2026-01-16T23:06:30.204231"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/code_intelligence.py_backend/services/code_intelligence.py:chunk_1_0cae8717",
    "text": "\"\"\"\nCode Intelligence Service\nAST-based code indexing and semantic search for legacy codebases\n\"\"\"\n\nimport asyncio\nfrom typing import List, Dict, Any, Optional\nfrom pathlib import Path\nimport ast\nimport chromadb\nfrom chromadb.config import Settings\nfrom chromadb.utils import embedding_functions\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/code_intelligence.py:chunk_1",
      "file_path": "backend/services/code_intelligence.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 297,
      "ingested_at": "2026-01-16T23:06:30.206558"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/code_intelligence.py_backend/services/code_intelligence.py:chunk_2_5e74b96f",
    "text": "CodeIntelligence:\n    \"\"\"\n    Code Intelligence Service for legacy codebase analysis\n    - AST-based parsing\n    - Function/class extraction\n    - Semantic code search\n    \"\"\"\n    \n    def __init__(\n        self,\n        collection_name: str = \"codebase_index\",\n        persist_directory: str = \"./chroma_db\"\n    ):\n        # Initialize ChromaDB client\n        self.client = chromadb.PersistentClient(path=persist_directory)\n        \n        # Embedding function\n        self.embedding_function = embedding_functions.SentenceTransformerEmbeddingFunction(\n            model_name=\"all-MiniLM-L6-v2\"\n        )\n        \n        # Get or create collection\n        try:\n            self.collection = self.client.get_collection(\n                name=collection_name,\n                embedding_function=self.embedding_function\n            )\n            print(f\"\ud83d\udcbb Loaded existing code collection: {collection_name}\")\n        except:\n            self.collection = self.client.create_collection(\n                name=collection_name,\n                embedding_function=self.embedding_function,\n                metadata={\"description\": \"Code intelligence index\"}\n            )\n            print(f\"\ud83d\udcbb Created new code collection: {collection_name}\")\n    \n    async def index_codebase(self, path: str) -> Dict[str, Any]:\n        \"\"\"\n        Index a Python codebase\n        Extracts functions, classes, and their metadata\n        \"\"\"\n        print(f\"\ud83d\udd0d Indexing codebase at: {path}\")\n        \n        codebase_path = Path(path)\n        if not codebase_path.exists():\n            return {\"status\": \"error\", \"message\": f\"Path not found: {path}\"}\n        \n        # Find all Python files\n        python_files = list(codebase_path.rglob(\"*.py\"))\n        \n        total_functions = 0\n        total_classes = 0\n        \n        for py_file in python_files:\n            try:\n                with open(py_file, 'r', encoding='utf-8') as f:\n                    source_code = f.read()\n                \n                # Parse AST\n                tree = ast.parse(source_code)\n                \n                # Extract code entities\n                entities = self._extract_code_entities(\n                    tree,\n                    str(py_file.relative_to(codebase_path)),\n                    source_code\n                )\n                \n                if entities:\n                    # Add to collection\n                    self.collection.add(\n                        documents=[e[\"description\"] for e in entities],\n                        metadatas=[e[\"metadata\"] for e in entities],\n                        ids=[e[\"id\"] for e in entities]\n                    )\n                    \n                    total_functions += sum(1 for e in entities if e[\"metadata\"][\"type\"] == \"function\")\n                    total_classes += sum(1 for e in entities if e[\"metadata\"][\"type\"] == \"class\")\n            \n            except Exception as e:\n                print(f\"  \u26a0\ufe0f  Error parsing {py_file.name}: {e}\")\n        \n        print(f\"\u2705 Indexed {total_functions} functions and {total_classes} classes from {len(python_files)} files\")\n        \n        return {\n            \"status\": \"success\",\n            \"files_processed\": len(python_files),\n            \"functions_indexed\": total_functions,\n            \"classes_indexed\": total_classes\n        }\n    \n    def _extract_code_entities(\n        self,\n        tree: ast.AST,\n        file_path: str,\n        source_code: str\n    ) -> List[Dict[str, Any]]:\n        \"\"\"\n        Extract functions and classes from AST\n        \"\"\"\n        entities = []\n        source_lines = source_code.split('\\n')\n        \n        for node in ast.walk(tree):\n            # Extract functions\n            if isinstance(node, ast.FunctionDef):\n                # Get function signature\n                args = [arg.arg for arg in node.args.args]\n                signature = f\"{node.name}({', '.join(args)})\"\n                \n                # Get docstring\n                docstring = ast.get_docstring(node) or \"No documentation\"\n                \n                # Get source code snippet\n                if hasattr(node, 'lineno') and hasattr(node, 'end_lineno'):\n                    snippet = '\\n'.join(source_lines[node.lineno-1:node.end_lineno])\n                else:\n                    snippet = \"\"\n                \n                # Create searchable description\n                description = f\"Function: {signature}\\n{docstring}\\nFile: {file_path}\"\n                \n                entity_id = f\"{file_path}::{node.name}::L{node.lineno}\"\n                \n                entities.append({\n                    \"id\": entity_id,\n                    \"description\": description,\n                    \"metadata\": {\n                        \"type\": \"function\",\n                        \"name\": node.name,\n                        \"signature\": signature,\n                        \"file_path\": file_path,\n                        \"line_start\": node.lineno if hasattr(node, 'lineno') else 0,\n                        \"line_end\": node.end_lineno if hasattr(node, 'end_lineno') else 0,\n                        \"docstring\": docstring,\n                        \"snippet\": snippet[:500]  # Limit snippet size\n                    }\n                })\n            \n            # Extract classes\n            elif isinstance(node, ast.ClassDef):\n                # Get class info\n                bases = [base.id if isinstance(base, ast.Name) else str(base) for base in node.bases]\n                docstring = ast.get_docstring(node) or \"No documentation\"\n                \n                # Get methods\n                methods = [n.name for n in node.body if isinstance(n, ast.FunctionDef)]\n                \n                description = f\"Class: {node.name}\\nInherits: {', '.join(bases) if bases else 'None'}\\nMethods: {', '.join(methods)}\\n{docstring}\\nFile: {file_path}\"\n                \n                entity_id = f\"{file_path}::{node.name}::CLASS::L{node.lineno}\"\n                \n                entities.append({\n                    \"id\": entity_id,\n                    \"description\": description,\n                    \"metadata\": {\n                        \"type\": \"class\",\n                        \"name\": node.name,\n                        \"bases\": bases,\n                        \"methods\": methods,\n                        \"file_path\": file_path,\n                        \"line_start\": node.lineno if hasattr(node, 'lineno') else 0,\n                        \"docstring\": docstring\n                    }\n                })\n        \n        return entities\n    \n    async def search(\n        self,\n        query: str,\n        role: str,\n        filters: Optional[Dict[str, Any]] = None,\n        top_k: int = 3\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Search for code entities based on query\n        \"\"\"\n        try:\n            results = self.collection.query(\n                query_texts=[query],\n                n_results=top_k,\n                where=filters if filters else {}\n            )\n            \n            chunks = []\n            sources = []\n            \n            if results[\"documents\"] and results[\"documents\"][0]:\n                for i in range(len(results[\"documents\"][0])):\n                    metadata = results[\"metadatas\"][0][i]\n                    \n                    chunks.append({\n                        \"text\": f\"```python\\n{metadata.get('snippet', 'No code available')}\\n```\\n\\nLocation: {metadata.get('file_path')} (Lines {metadata.get('line_start')}-{metadata.get('line_end')})\\n\\n{results['documents'][0][i]}\",\n                        \"metadata\": metadata\n                    })\n                    \n                    sources.append({\n                        \"type\": \"code\",\n                        \"file\": metadata.get(\"file_path\", \"Unknown\"),\n                        \"entity\": metadata.get(\"name\", \"Unknown\"),\n                        \"entity_type\": metadata.get(\"type\", \"code\"),\n                        \"line_start\": metadata.get(\"line_start\", 0)\n                    })\n            \n            return {\n                \"chunks\": chunks,\n                \"sources\": sources,\n                \"total_found\": len(chunks)\n            }\n        \n        except Exception as e:\n            print(f\"Error searching code: {e}\")\n            return {\"chunks\": [], \"sources\": [], \"total_found\": 0}\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/code_intelligence.py:chunk_2",
      "file_path": "backend/services/code_intelligence.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 8310,
      "ingested_at": "2026-01-16T23:06:30.206639"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/code_ingestion.py_backend/services/code_ingestion.py:chunk_1_5efcb6a6",
    "text": "\"\"\"\nCode Ingestion Service\nHandles GitHub repo cloning, AST parsing using Tree-sitter, and code embedding.\n\"\"\"\n\nimport os\nimport uuid\nimport shutil\nimport asyncio\nfrom pathlib import Path\nfrom typing import List, Dict, Any, Optional\nfrom datetime import datetime\nimport re\n\n# Git operations\nfrom git import Repo\n\n# Graph for code relationships\nimport networkx as nx\n\n# Tree-sitter\ntry:\n    from tree_sitter import Language, Parser\n    TREE_SITTER_AVAILABLE = True\nexcept ImportError:\n    TREE_SITTER_AVAILABLE = False\n    print(\"\u26a0\ufe0f tree-sitter not installed.\")\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/code_ingestion.py:chunk_1",
      "file_path": "backend/services/code_ingestion.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 561,
      "ingested_at": "2026-01-16T23:06:30.209782"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/code_ingestion.py_backend/services/code_ingestion.py:chunk_2_0b6166d1",
    "text": "CodeIngestionService:\n    \"\"\"\n    Service for ingesting GitHub repos using Tree-sitter for robust parsing.\n    \"\"\"\n    \n    SUPPORTED_EXTENSIONS = {\n        '.py': 'python',\n        '.js': 'javascript',\n        '.ts': 'typescript',\n        '.jsx': 'javascript',\n        '.tsx': 'typescript',\n        '.java': 'java',\n        '.go': 'go',\n        '.c': 'c',\n    }\n    \n    SKIP_DIRS = {\n        'node_modules', '.git', '__pycache__', '.venv', 'venv', \n        'dist', 'build', '.next', '.nuxt', 'coverage', '.pytest_cache',\n        'vendor', 'target', '.idea', '.vscode'\n    }\n    \n    def __init__(self, repos_dir: Optional[str] = None):\n        if repos_dir is None:\n            self.repos_dir = Path(__file__).parent.parent / \"repos\"\n        else:\n            self.repos_dir = Path(repos_dir)\n        \n        self.repos_dir.mkdir(exist_ok=True)\n        self.graph = nx.DiGraph()\n        \n        self.parsers = {}\n        if TREE_SITTER_AVAILABLE:\n            self._setup_parsers()\n        \n    def _setup_parsers(self):\n        \"\"\"Load compiled tree-sitter languages.\"\"\"\n        lib_path = Path(__file__).parent.parent / \"build\" / \"my-languages.so\"\n        if not lib_path.exists():\n            print(f\"\u26a0\ufe0f Tree-sitter library not found at: {lib_path}\")\n            return\n\n        try:\n            import ctypes\n            lib = ctypes.cdll.LoadLibrary(str(lib_path))\n            \n            self.LANGUAGES = {}\n            \n            # Map of internal name to symbol name\n            # Usually tree_sitter_{lang}\n            lang_map = {\n                'python': 'tree_sitter_python',\n                'javascript': 'tree_sitter_javascript',\n                'typescript': 'tree_sitter_typescript',\n                'go': 'tree_sitter_go',\n                'java': 'tree_sitter_java'\n            }\n            \n            for lang_name, symbol in lang_map.items():\n                try:\n                    # New API (0.22+): Language(ptr)\n                    # We need to get the function from lib and call it?\n                    # No, usually we pass the function pointer directly or the result of calling it?\n                    # The function returns a TSLanguage*\n                    \n                    # For tree-sitter 0.22+, Language() takes a capsule or void*\n                    # Let's try passing the address.\n                    lang_func = getattr(lib, symbol)\n                    # We need to set res type\n                    lang_func.restype = ctypes.c_void_p\n                    lang_ptr = lang_func()\n                    \n                    self.LANGUAGES[lang_name] = Language(lang_ptr)\n                except Exception as e:\n                    print(f\"Failed to load {lang_name}: {e}\")\n            \n            for lang_name, lang_obj in self.LANGUAGES.items():\n                try:\n                    parser = Parser(lang_obj)\n                    self.parsers[lang_name] = parser\n                except TypeError:\n                    # Fallback for older versions if somehow mixed\n                    parser = Parser()\n                    parser.set_language(lang_obj)\n                    self.parsers[lang_name] = parser\n            \n            print(f\"\u2705 Tree-sitter parsers loaded: {list(self.parsers.keys())}\")\n        except Exception as e:\n            print(f\"\u26a0\ufe0f Error loading parsers: {e}\")\n            # Fallback to old API attempt if ctypes fails (for 0.20 compat just in case)\n            try:\n                 self.LANGUAGES = {\n                    'python': Language(str(lib_path), 'python'),\n                    'javascript': Language(str(lib_path), 'javascript'),\n                    'typescript': Language(str(lib_path), 'typescript'),\n                    'go': Language(str(lib_path), 'go'),\n                    'java': Language(str(lib_path), 'java')\n                }\n                 for lang_name, lang_obj in self.LANGUAGES.items():\n                    parser = Parser()\n                    parser.set_language(lang_obj)\n                    self.parsers[lang_name] = parser\n            except:\n                pass\n\n    async def ingest_github_repo(self, github_url: str, user_id: str) -> Dict[str, Any]:\n        \"\"\"Clone and parse repo using Tree-sitter.\"\"\"\n        try:\n            repo_name = self._extract_repo_name(github_url)\n            repo_id = str(uuid.uuid4())[:8]\n            repo_path = self.repos_dir / f\"{repo_id}_{repo_name}\"\n            \n            print(f\"\ud83d\udce5 Cloning {github_url}...\")\n            await self._clone_repo(github_url, repo_path)\n            \n            print(f\"\ud83d\udd0d Parsing code files...\")\n            code_chunks = await self._parse_repository(repo_path, repo_name, user_id)\n            \n            print(f\"\ud83d\udd17 Building code graph...\")\n            await self._build_code_graph(code_chunks)\n            \n            return {\n                \"repo_id\": repo_id,\n                \"repo_name\": repo_name,\n                \"chunks\": code_chunks,\n                \"file_count\": len(set(c[\"metadata\"][\"file_path\"] for c in code_chunks)),\n                \"chunk_count\": len(code_chunks),\n                \"graph_nodes\": self.graph.number_of_nodes(),\n                \"status\": \"ready\"\n            }\n        except Exception as e:\n            print(f\"\u274c Ingestion error: {e}\")\n            return {\"status\": \"error\", \"error\": str(e)}\n\n    def _extract_repo_name(self, github_url: str) -> str:\n        url = github_url.rstrip('/')\n        if url.endswith('.git'):\n            url = url[:-4]\n        parts = url.split('/')\n        return parts[-1] if parts else \"unknown\"\n    \n    async def _clone_repo(self, github_url: str, repo_path: Path) -> None:\n        if repo_path.exists():\n            shutil.rmtree(repo_path)\n        loop = asyncio.get_event_loop()\n        await loop.run_in_executor(None, lambda: Repo.clone_from(github_url, repo_path, depth=1))\n\n    async def _parse_repository(self, repo_path: Path, repo_name: str, user_id: str) -> List[Dict[str, Any]]:\n        chunks = []\n        for file_path in repo_path.rglob('*'):\n            if file_path.is_dir() or any(skip in file_path.parts for skip in self.SKIP_DIRS):\n                continue\n            \n            ext = file_path.suffix.lower()\n            if ext not in self.SUPPORTED_EXTENSIONS:\n                continue\n                \n            try:\n                with open(file_path, 'r', encoding='utf-8', errors='ignore') as f:\n                    content = f.read()\n                \n                lang = self.SUPPORTED_EXTENSIONS[ext]\n                relative_path = str(file_path.relative_to(repo_path))\n                \n                if lang in self.parsers:\n                    try:\n                        file_chunks = self._parse_with_treesitter(content, relative_path, lang, repo_name, user_id)\n                    except Exception as e:\n                         print(f\"Tree-sitter error {file_path}: {e}\")\n                         file_chunks = self._chunk_by_lines(content, relative_path, lang, repo_name, user_id)\n                else:\n                    file_chunks = self._chunk_by_lines(content, relative_path, lang, repo_name, user_id)\n                \n                chunks.extend(file_chunks)\n            except Exception as e:\n                print(f\"Error parsing {file_path}: {e}\")\n                \n        return chunks\n\n    def _parse_with_treesitter(self, content: str, file_path: str, lang: str, repo_name: str, user_id: str) -> List[Dict[str, Any]]:\n        parser = self.parsers[lang]\n        tree = parser.parse(bytes(content, \"utf8\"))\n        root_node = tree.root_node\n        \n        # Queries for extracting definitions\n        queries = {\n            'python': \"\"\"\n                (function_definition name: (identifier) @name body: (block) @body) @function\n                (class_definition name: (identifier) @name body: (block) @body) @class\n            \"\"\",\n            'javascript': \"\"\"\n                (function_declaration name: (identifier) @name body: (statement_block) @body) @function\n                (class_declaration name: (identifier) @name body: (class_body) @body) @class\n            \"\"\",\n             'typescript': \"\"\"\n                (function_declaration name: (identifier) @name body: (statement_block) @body) @function\n                (class_declaration name: (identifier) @name body: (class_body) @body) @class\n            \"\"\",\n            'go': \"\"\"\n                (function_declaration name: (identifier) @name body: (block) @body) @function\n                (method_declaration name: (field_identifier) @name body: (block) @body) @method\n            \"\"\",\n             'java': \"\"\"\n                (method_declaration name: (identifier) @name body: (block) @body) @method\n                (class_declaration name: (identifier) @name body: (class_body) @body) @class\n            \"\"\"\n        }\n        \n        query_str = queries.get(lang)\n        if not query_str:\n             return self._chunk_by_lines(content, file_path, lang, repo_name, user_id)\n            \n        language_obj = self.LANGUAGES[lang]\n        query = language_obj.query(query_str)\n        captures = query.captures(root_node)\n        \n        chunks = []\n        seen_ranges = set()\n        \n        for node, capture_name in captures:\n            if capture_name in ['function', 'class', 'method']:\n                start_byte = node.start_byte\n                end_byte = node.end_byte\n                \n                if start_byte in seen_ranges:\n                    continue\n                seen_ranges.add(start_byte)\n                \n                text_bytes = content.encode('utf8')[start_byte:end_byte]\n                text = text_bytes.decode('utf8', errors='replace')\n                \n                # Extract name roughly\n                name = \"anonymous\"\n                # For simplified logic, we just grab the first identifier child if possible\n                # Or rely on the capture group @name if we processed it differently, \n                # but 'captures' flattens. \n                # Better approach: query.captures returns (node, name), so we can look for @name nodes\n                pass\n\n        # Re-run query to get names specifically? \n        # Actually captures returns a list of (Node, capture_index) in older bindings \n        # or (Node, capture_name) in newer.\n        # Let's simplify: iterate captures, if name is @function/class, create chunk.\n        # Name extraction is hard without grouping. \n        # Fallback to regex for name extraction on the chunk text? Or just use \"code_block\"\n        \n        # Correct approach for flat captures:\n        # We need to map @name nodes to their parent @function nodes can be tricky.\n        # Alternative: Just dump the whole function as a chunk.\n        \n        for node, capture_name in captures:\n             if capture_name in ['function', 'class', 'method']:\n                  start_byte = node.start_byte\n                  end_byte = node.end_byte\n                  text_bytes = content.encode('utf8')[start_byte:end_byte]\n                  text = text_bytes.decode('utf8', errors='replace')\n                  \n                  # Try to find name in text\n                  name = \"block\"\n                  match = re.search(r'(def|class|func|function)\\s+([a-zA-Z0-9_]+)', text)\n                  if match:\n                      name = match.group(2)\n                  \n                  chunks.append(self._create_chunk(\n                    text=text,\n                    chunk_type=capture_name,\n                    name=name,\n                    file_path=file_path,\n                    language=lang,\n                    repo_name=repo_name,\n                    user_id=user_id,\n                    start_line=node.start_point[0] + 1,\n                    end_line=node.end_point[0] + 1\n                ))\n        \n        if not chunks:\n             return self._chunk_by_lines(content, file_path, lang, repo_name, user_id)\n\n        return chunks\n\n    def _chunk_by_lines(self, content, file_path, language, repo_name, user_id, chunk_size=1000, overlap=100):\n        \"\"\"\n        Robust chunking using recursive character splitting logic.\n        Splits by separators (class/def, newlines, spaces) to respect code structure.\n        \"\"\"\n        separators = [\"\\nclass \", \"\\ndef \", \"\\nfunc \", \"\\n\\n\", \"\\n\", \" \"]\n        \n        final_chunks = []\n        \n        # Initial split\n        if len(content) <= chunk_size:\n            final_chunks = [content]\n        else:\n            final_chunks = self._recursive_split(content, separators, chunk_size, overlap)\n            \n        chunks = []\n        for i, text in enumerate(final_chunks):\n            if len(text.strip()) > 10:\n                chunks.append(self._create_chunk(\n                    text=text,\n                    chunk_type=\"code_block\",\n                    name=f\"{file_path}:chunk_{i+1}\",\n                    file_path=file_path,\n                    language=language,\n                    repo_name=repo_name,\n                    user_id=user_id,\n                    start_line=0, # Hard to track line numbers exactly with recursive split without robust tracking\n                    end_line=0\n                ))\n        return chunks\n\n    def _recursive_split(self, text, separators, chunk_size, overlap):\n        \"\"\"Recursive splitting helper\"\"\"\n        if len(text) <= chunk_size:\n            return [text]\n            \n        # Find best separator\n        separator = separators[-1]\n        for sep in separators:\n            if sep in text:\n                separator = sep\n                break\n        \n        # Split\n        parts = text.split(separator)\n        \n        # Merge parts back into chunks\n        chunks = []\n        current_chunk = []\n        current_len = 0\n        \n        for part in parts:\n            part_len = len(part) + len(separator)\n            if current_len + part_len > chunk_size and current_chunk:\n                # Flush current chunk\n                chunks.append(separator.join(current_chunk))\n                # Handle overlap? (Simplified: no overlap for now to avoid duplications in RAG)\n                current_chunk = [part]\n                current_len = part_len\n            else:\n                current_chunk.append(part)\n                current_len += part_len\n        \n        if current_chunk:\n            chunks.append(separator.join(current_chunk))\n            \n        return chunks\n\n    def _create_chunk(self, text, chunk_type, name, file_path, language, repo_name, user_id, start_line, end_line):\n        return {\n            \"id\": f\"{repo_name}_{file_path}_{name}_{uuid.uuid4().hex[:8]}\",\n            \"text\": text,\n            \"metadata\": {\n                \"type\": \"code\",\n                \"chunk_type\": chunk_type,\n                \"name\": name,\n                \"file_path\": file_path,\n                \"language\": language,\n                \"repo_name\": repo_name,\n                \"user_id\": user_id,\n                \"start_line\": start_line,\n                \"end_line\": end_line,\n                \"char_count\": len(text),\n                \"ingested_at\": datetime.now().isoformat()\n            }\n        }\n\n    async def _build_code_graph(self, chunks):\n        self.graph.clear()\n        for chunk in chunks:\n             meta = chunk[\"metadata\"]\n             node_id = f\"{meta['file_path']}::{meta['name']}\"\n             self.graph.add_node(node_id, **meta)\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/code_ingestion.py:chunk_2",
      "file_path": "backend/services/code_ingestion.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 15364,
      "ingested_at": "2026-01-16T23:06:30.209797"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/llm_service.py_backend/services/llm_service.py:chunk_1_0849b2ad",
    "text": "\"\"\"\nLLM Service for DevOps Copilot V3\nUses Qwen2.5-Coder for code understanding and IT tool actions.\n\"\"\"\n\nimport asyncio\nimport httpx\nfrom typing import Dict, Any, List, Optional\nfrom pydantic import BaseModel\nimport json\nimport re\n\n\nclass QueryIntent(BaseModel):\n    \"\"\"Classified intent of user query\"\"\"\n    intent_type: str = \"GENERAL\"  # CODE_QUERY, DOC_QUERY, IT_ACTION, GENERAL\n    requires_code_search: bool = False\n    requires_doc_search: bool = False\n    requires_action: bool = False\n    action_type: Optional[str] = None\n    confidence: float = 0.0\n    is_greeting: bool = False\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/llm_service.py:chunk_1",
      "file_path": "backend/services/llm_service.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 592,
      "ingested_at": "2026-01-16T23:06:30.212409"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/llm_service.py_backend/services/llm_service.py:chunk_2_5bcfd91c",
    "text": "LLMService:\n    \"\"\"\n    LLM Service using Qwen2.5-Coder for code understanding.\n    Supports:\n    - Code explanation and search\n    - Documentation queries\n    - IT tool actions (health checks, logs, etc.)\n    \"\"\"\n    \n    # IT Tool Actions\n    IT_TOOLS = {\n        \"HEALTH_CHECK\": {\n            \"description\": \"Check health status of a service\",\n            \"keywords\": [\"health\", \"status\", \"alive\", \"running\", \"up\", \"down\"]\n        },\n        \"PING_SERVICE\": {\n            \"description\": \"Ping a service or endpoint\",\n            \"keywords\": [\"ping\", \"reachable\", \"connectivity\", \"connect\"]\n        },\n        \"GET_LOGS\": {\n            \"description\": \"Retrieve service logs\",\n            \"keywords\": [\"logs\", \"log\", \"errors\", \"warnings\", \"trace\"]\n        },\n        \"CHECK_DISK\": {\n            \"description\": \"Check disk usage\",\n            \"keywords\": [\"disk\", \"storage\", \"space\", \"usage\"]\n        },\n        \"LIST_CONTAINERS\": {\n            \"description\": \"List Docker containers\",\n            \"keywords\": [\"docker\", \"containers\", \"pods\", \"k8s\", \"kubernetes\"]\n        },\n        \"CHECK_MEMORY\": {\n            \"description\": \"Check memory usage\",\n            \"keywords\": [\"memory\", \"ram\", \"heap\", \"usage\"]\n        },\n        \"LIST_SERVICES\": {\n            \"description\": \"List running services\",\n            \"keywords\": [\"services\", \"processes\", \"running\", \"active\"]\n        }\n    }\n    \n    def __init__(\n        self,\n        base_url: str = \"http://localhost:11434\",\n        model: str = \"qwen2.5-coder:7b\"\n    ):\n        self.base_url = base_url\n        self.model = model\n        self.client = httpx.AsyncClient(timeout=120.0)\n    \n    async def _call_ollama(self, prompt: str, system: str = None) -> str:\n        \"\"\"Direct call to Ollama API for agent loop compatibility\"\"\"\n        try:\n            full_prompt = prompt\n            if system:\n                full_prompt = f\"System: {system}\\n\\n{prompt}\"\n            \n            response = await self.client.post(\n                f\"{self.base_url}/api/generate\",\n                json={\n                    \"model\": self.model,\n                    \"prompt\": full_prompt,\n                    \"stream\": False,\n                    \"options\": {\n                        \"temperature\": 0.3,\n                        \"top_p\": 0.9,\n                        \"num_predict\": 1000\n                    }\n                }\n            )\n            \n            if response.status_code == 200:\n                result = response.json()\n                return result.get(\"response\", \"\")\n            else:\n                return f\"Error: {response.status_code}\"\n        except Exception as e:\n            return f\"Error calling LLM: {str(e)}\"\n    \n    async def stream_response(\n        self,\n        query: str,\n        context,\n        role: str,\n        capabilities,\n        intent,\n        conversation_history = None\n    ):\n        \"\"\"Stream response tokens from Ollama\"\"\"\n        # Build prompt\n        system_prompt = self._build_system_prompt(role, capabilities, intent)\n        history_str = self._format_conversation_history(conversation_history)\n        context_str = self._format_code_context(context)\n        \n        full_prompt = system_prompt\n        if history_str:\n            full_prompt += f\"\\n\\n{history_str}\"\n        if context_str:\n            full_prompt += f\"\\n\\n{context_str}\"\n        full_prompt += f\"\\n\\nUser: {query}\\n\\nAssistant:\"\n        \n        try:\n            async with self.client.stream(\n                \"POST\",\n                f\"{self.base_url}/api/generate\",\n                json={\n                    \"model\": self.model,\n                    \"prompt\": full_prompt,\n                    \"stream\": True,\n                    \"options\": {\n                        \"temperature\": 0.4,\n                        \"top_p\": 0.9,\n                        \"num_predict\": 2000\n                    }\n                }\n            ) as response:\n                async for line in response.aiter_lines():\n                    if line:\n                        try:\n                            data = json.loads(line)\n                            if \"response\" in data:\n                                yield data[\"response\"]\n                        except json.JSONDecodeError:\n                            continue\n        except Exception as e:\n            yield f\"Error: {str(e)}\"\n    \n    async def classify_intent(\n        self,\n        query: str,\n        capabilities\n    ) -> QueryIntent:\n        \"\"\"\n        Classify query intent for routing.\n        \"\"\"\n        query_lower = query.lower().strip()\n        intent = QueryIntent()\n        \n        # === Greetings ===\n        greetings = [\"hello\", \"hi\", \"hey\", \"good morning\", \"good afternoon\", \"good evening\", \"what's up\"]\n        if any(query_lower.startswith(g) or query_lower == g for g in greetings):\n            intent.intent_type = \"GENERAL\"\n            intent.is_greeting = True\n            intent.confidence = 0.95\n            return intent\n        \n        # === IT Tool Actions ===\n        for action_type, config in self.IT_TOOLS.items():\n            if any(kw in query_lower for kw in config[\"keywords\"]):\n                if \"RUN_HEALTHCHECKS\" in capabilities.permissions or \"READ_LOGS\" in capabilities.permissions:\n                    intent.intent_type = \"IT_ACTION\"\n                    intent.requires_action = True\n                    intent.action_type = action_type\n                    intent.confidence = 0.9\n                    return intent\n        \n        # === Code Queries ===\n        code_patterns = [\n            \"how does .* work\", \"explain .* code\", \"what does .* do\",\n            \"show me the .*\", \"where is .*\", \"find .*function\", \"find .*class\",\n            \"implementation of\", \"architecture\", \"flow\", \"logic\",\n            \"authentication\", \"api\", \"endpoint\", \"handler\", \"service\",\n            \"function\", \"class\", \"method\", \"module\", \"import\"\n        ]\n        \n        for pattern in code_patterns:\n            if re.search(pattern, query_lower):\n                intent.intent_type = \"CODE_QUERY\"\n                intent.requires_code_search = True\n                intent.confidence = 0.85\n                return intent\n        \n        # === Document Queries ===\n        doc_patterns = [\n            \"according to\", \"documentation\", \"readme\", \"guide\",\n            \"how to\", \"setup\", \"install\", \"configure\", \"deploy\"\n        ]\n        \n        if any(p in query_lower for p in doc_patterns):\n            intent.intent_type = \"DOC_QUERY\"\n            intent.requires_doc_search = True\n            intent.confidence = 0.8\n            return intent\n        \n        # === Default: treat as code query if repo is indexed ===\n        intent.intent_type = \"CODE_QUERY\"\n        intent.requires_code_search = True\n        intent.confidence = 0.6\n        return intent\n    \n    async def generate_response(\n        self,\n        query: str,\n        context: List[Dict[str, Any]],\n        role: str,\n        capabilities,\n        intent: QueryIntent,\n        conversation_history: List[Dict[str, Any]] = None\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Generate response using Qwen2.5-Coder.\n        \"\"\"\n        # Handle IT actions\n        if intent.requires_action and intent.action_type:\n            return await self._handle_it_action(query, intent.action_type, role)\n        \n        # Build prompts\n        system_prompt = self._build_system_prompt(role, capabilities, intent)\n        history_str = self._format_conversation_history(conversation_history)\n        context_str = self._format_code_context(context)\n        \n        full_prompt = system_prompt\n        if history_str:\n            full_prompt += f\"\\n\\n{history_str}\"\n        if context_str:\n            full_prompt += f\"\\n\\n{context_str}\"\n        full_prompt += f\"\\n\\nUser: {query}\\n\\nAssistant:\"\n        \n        try:\n            response = await self.client.post(\n                f\"{self.base_url}/api/generate\",\n                json={\n                    \"model\": self.model,\n                    \"prompt\": full_prompt,\n                    \"stream\": False,\n                    \"options\": {\n                        \"temperature\": 0.4,\n                        \"top_p\": 0.9,\n                        \"num_predict\": 2000\n                    }\n                }\n            )\n            \n            if response.status_code == 200:\n                result = response.json()\n                content = result.get(\"response\", \"I couldn't generate a response.\")\n                \n                return {\n                    \"content\": content,\n                    \"action_parameters\": {},\n                    \"show_sources\": intent.requires_code_search or intent.requires_doc_search\n                }\n            else:\n                return {\n                    \"content\": \"I'm having trouble processing that request. Please try again.\",\n                    \"action_parameters\": {},\n                    \"show_sources\": False\n                }\n                \n        except Exception as e:\n            print(f\"LLM Error: {e}\")\n            return {\n                \"content\": f\"Connection error: {str(e)}\",\n                \"action_parameters\": {},\n                \"show_sources\": False\n            }\n    \n    async def _handle_it_action(\n        self,\n        query: str,\n        action_type: str,\n        role: str\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Handle IT tool actions by returning structured JSON.\n        \"\"\"\n        # Extract target from query\n        target = self._extract_target(query, action_type)\n        \n        # Build action JSON\n        action_data = {\n            \"action\": action_type,\n            \"target\": target,\n            \"requested_by\": role,\n            \"status\": \"executed\"\n        }\n        \n        # Generate mock results based on action type\n        mock_results = self._generate_mock_results(action_type, target)\n        \n        # Format as terminal-like output\n        content = f\"Executing {action_type.replace('_', ' ').lower()} for **{target}**...\\n\\n\"\n        content += \"```terminal\\n\"\n        content += mock_results\n        content += \"\\n```\"\n        \n        return {\n            \"content\": content,\n            \"action_parameters\": action_data,\n            \"show_sources\": False,\n            \"attachment\": {\n                \"type\": \"TERMINAL\",\n                \"data\": mock_results\n            }\n        }\n    \n    def _extract_target(self, query: str, action_type: str) -> str:\n        \"\"\"Extract the target service/resource from query.\"\"\"\n        query_lower = query.lower()\n        \n        # Common service names\n        services = [\n            \"api\", \"api-gateway\", \"auth\", \"authentication\", \"database\", \"db\",\n            \"redis\", \"cache\", \"nginx\", \"frontend\", \"backend\", \"worker\",\n            \"queue\", \"scheduler\", \"prometheus\", \"grafana\", \"elasticsearch\"\n        ]\n        \n        for service in services:\n            if service in query_lower:\n                return service\n        \n        # Default targets by action\n        defaults = {\n            \"HEALTH_CHECK\": \"api-gateway\",\n            \"PING_SERVICE\": \"localhost\",\n            \"GET_LOGS\": \"application\",\n            \"CHECK_DISK\": \"/\",\n            \"LIST_CONTAINERS\": \"docker\",\n            \"CHECK_MEMORY\": \"system\",\n            \"LIST_SERVICES\": \"all\"\n        }\n        \n        return defaults.get(action_type, \"system\")\n    \n    def _generate_mock_results(self, action_type: str, target: str) -> str:\n        \"\"\"Generate mock terminal output for IT actions.\"\"\"\n        \n        if action_type == \"HEALTH_CHECK\":\n            return f\"\"\"$ curl -s http://{target}:8000/health\n{{\n  \"status\": \"healthy\",\n  \"uptime\": \"12d 5h 23m\",\n  \"version\": \"2.3.1\",\n  \"checks\": {{\n    \"database\": \"ok\",\n    \"cache\": \"ok\",\n    \"queue\": \"ok\"\n  }}\n}}\"\"\"\n        \n        elif action_type == \"PING_SERVICE\":\n            return f\"\"\"$ ping -c 3 {target}\nPING {target} (127.0.0.1): 56 data bytes\n64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.045 ms\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.058 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.062 ms\n\n--- {target} ping statistics ---\n3 packets transmitted, 3 received, 0.0% packet loss\"\"\"\n        \n        elif action_type == \"GET_LOGS\":\n            return f\"\"\"$ tail -20 /var/log/{target}.log\n[2026-01-15 20:15:23] INFO  - Request handled: GET /api/users (23ms)\n[2026-01-15 20:15:24] INFO  - Request handled: POST /api/auth (45ms)\n[2026-01-15 20:15:25] DEBUG - Cache hit for key: user_session_abc123\n[2026-01-15 20:15:26] INFO  - Request handled: GET /api/health (2ms)\n[2026-01-15 20:15:28] WARN  - Slow query detected: 150ms\n[2026-01-15 20:15:30] INFO  - Request handled: GET /api/metrics (12ms)\"\"\"\n        \n        elif action_type == \"CHECK_DISK\":\n            return f\"\"\"$ df -h {target}\nFilesystem      Size  Used Avail Use% Mounted on\n/dev/sda1       100G   45G   55G  45% /\n/dev/sdb1       500G  230G  270G  46% /data\ntmpfs           16G   1.2G   15G   8% /tmp\"\"\"\n        \n        elif action_type == \"LIST_CONTAINERS\":\n            return \"\"\"$ docker ps\nCONTAINER ID   IMAGE                  STATUS          PORTS                    NAMES\na1b2c3d4e5f6   api-gateway:2.3.1     Up 12 days      0.0.0.0:8000->8000/tcp   api-gateway\nb2c3d4e5f6a1   postgres:15           Up 12 days      5432/tcp                 database\nc3d4e5f6a1b2   redis:7               Up 12 days      6379/tcp                 cache\nd4e5f6a1b2c3   nginx:latest          Up 12 days      80/tcp, 443/tcp          proxy\"\"\"\n        \n        elif action_type == \"CHECK_MEMORY\":\n            return \"\"\"$ free -h\n              total        used        free      shared  buff/cache   available\nMem:           32Gi       12Gi       8.5Gi       1.2Gi       11Gi        18Gi\nSwap:          8Gi        0.5Gi      7.5Gi\"\"\"\n        \n        elif action_type == \"LIST_SERVICES\":\n            return \"\"\"$ systemctl list-units --type=service --state=running\nUNIT                    LOAD   ACTIVE SUB     DESCRIPTION\napi-gateway.service     loaded active running API Gateway Service\npostgresql.service      loaded active running PostgreSQL Database\nredis.service           loaded active running Redis Cache\nnginx.service           loaded active running NGINX Web Server\nprometheus.service      loaded active running Prometheus Monitoring\"\"\"\n        \n        return \"$ Command executed successfully\"\n    \n    def _build_system_prompt(self, role: str, capabilities, intent: QueryIntent) -> str:\n        \"\"\"Build system prompt for code understanding.\"\"\"\n        \n        role_name = role.replace(\"_\", \" \").title()\n        \n        base = f\"\"\"You are DevOps Copilot, an expert AI assistant for developers and IT professionals.\nYou're speaking with a {role_name}.\n\nYour expertise:\n- Deep understanding of code architecture and design patterns\n- Clear, technical explanations with code examples\n- Practical, actionable advice\n- Concise but comprehensive answers\n\nWhen explaining code:\n- Reference specific files and line numbers from the context\n- Use markdown code blocks with language identifiers\n- Explain the \"why\" not just the \"what\"\n- Highlight important patterns and potential issues\"\"\"\n\n        if intent.is_greeting:\n            return f\"\"\"{base}\n\nThe user is greeting you. Respond warmly and briefly, mentioning you can help with:\n- Code understanding and explanation\n- Finding functions, classes, and logic flows\n- IT operations (health checks, logs, etc.)\n- Documentation queries\"\"\"\n\n        if intent.intent_type == \"CODE_QUERY\":\n            return f\"\"\"{base}\n\nYou're answering a code-related question. Use the provided code context to give a detailed, accurate answer.\n- Quote relevant code snippets\n- Explain the logic and data flow\n- Mention file paths and line numbers\n- Suggest improvements if appropriate\"\"\"\n\n        if intent.intent_type == \"IT_ACTION\":\n            return f\"\"\"{base}\n\nYou're helping with IT operations. Be practical and action-oriented.\n- Show command outputs in terminal format\n- Explain what the metrics mean\n- Suggest next steps if there are issues\"\"\"\n\n        return base\n    \n    def _format_code_context(self, context: List[Dict[str, Any]]) -> str:\n        \"\"\"Format code context for the prompt.\"\"\"\n        if not context:\n            return \"\"\n        \n        parts = [\"Relevant code from the repository:\"]\n        \n        for chunk in context[:5]:  # Limit context\n            meta = chunk.get(\"metadata\", {})\n            text = chunk.get(\"text\", \"\")\n            \n            file_path = meta.get(\"file_path\", \"unknown\")\n            start_line = meta.get(\"start_line\", \"?\")\n            end_line = meta.get(\"end_line\", \"?\")\n            language = meta.get(\"language\", \"\")\n            name = meta.get(\"name\", \"\")\n            \n            header = f\"\\n\ud83d\udcc1 {file_path}:{start_line}-{end_line}\"\n            if name:\n                header += f\" ({name})\"\n            \n            parts.append(f\"{header}\\n```{language}\\n{text}\\n```\")\n        \n        return \"\\n\".join(parts)\n    \n    def _format_conversation_history(\n        self,\n        history: List[Dict[str, Any]] = None,\n        max_messages: int = 6\n    ) -> str:\n        \"\"\"Format conversation history.\"\"\"\n        if not history:\n            return \"\"\n        \n        recent = history[-max_messages:] if len(history) > max_messages else history\n        \n        if not recent:\n            return \"\"\n        \n        lines = [\"Previous conversation:\"]\n        for msg in recent:\n            role = msg.get(\"role\", \"user\").capitalize()\n            content = msg.get(\"content\", \"\")\n            if len(content) > 200:\n                content = content[:197] + \"...\"\n            lines.append(f\"{role}: {content}\")\n        \n        return \"\\n\".join(lines)\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/llm_service.py:chunk_2",
      "file_path": "backend/services/llm_service.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 17663,
      "ingested_at": "2026-01-16T23:06:30.212424"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/audit_logger.py_backend/services/audit_logger.py:chunk_1_2685dff2",
    "text": "\"\"\"\nAudit Logging System\nImmutable log format with real-time streaming capability\n\"\"\"\n\nimport asyncio\nfrom datetime import datetime\nfrom typing import List, Dict, Any, Optional, AsyncIterator\nfrom dataclasses import dataclass, asdict\nfrom collections import deque\nimport json\nfrom .db_service import DatabaseService\n\n\n@dataclass\nclass LogEntry:\n    \"\"\"Immutable audit log entry\"\"\"\n    id: str\n    timestamp: datetime\n    actor: str\n    iam_role: str\n    action: str\n    status: str  # ALLOWED, DENIED, ERROR\n    details: str\n    trace_id: str\n    metadata: Optional[Dict[str, Any]] = None\n    \n    def dict(self):\n        \"\"\"Convert to dictionary for JSON serialization\"\"\"\n        return {\n            **asdict(self),\n            \"timestamp\": self.timestamp.isoformat()\n        }\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/audit_logger.py:chunk_1",
      "file_path": "backend/services/audit_logger.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 781,
      "ingested_at": "2026-01-16T23:06:30.214117"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/audit_logger.py_backend/services/audit_logger.py:chunk_2_31ab0a33",
    "text": "AuditLogger:\n    \"\"\"\n    Audit logging system with:\n    - Immutable logs persisted to SQLite\n    - Real-time streaming via in-memory queues\n    \"\"\"\n    \n    def __init__(self, max_logs: int = 1000):\n        self.subscribers: List[asyncio.Queue] = []\n        self._log_counter = 0\n        self.db = DatabaseService()\n        \n    async def log(\n        self,\n        actor: str,\n        iam_role: str,\n        action: str,\n        status: str,\n        details: str,\n        trace_id: str,\n        metadata: Optional[Dict[str, Any]] = None\n    ):\n        \"\"\"Create a log entry, persist it, and stream it\"\"\"\n        self._log_counter += 1\n        \n        entry = LogEntry(\n            id=f\"log_{int(datetime.now().timestamp())}_{self._log_counter:04d}\",\n            timestamp=datetime.now(),\n            actor=actor,\n            iam_role=iam_role,\n            action=action,\n            status=status,\n            details=details,\n            trace_id=trace_id,\n            metadata=metadata\n        )\n        \n        # 1. Persist to DB\n        log_data = entry.dict()\n        log_data[\"action_type\"] = log_data.pop(\"action\") # Remap for DB schema\n        await self.db.log_event(log_data)\n        \n        # 2. Notify subscribers (Real-time stream)\n        for queue in self.subscribers:\n            try:\n                queue.put_nowait(entry)\n            except asyncio.QueueFull:\n                pass\n        \n        # Console output\n        status_emoji = \"\u2705\" if status == \"ALLOWED\" else \"\ud83d\udeab\" if status == \"DENIED\" else \"\u274c\"\n        print(f\"{status_emoji} [{entry.timestamp.strftime('%H:%M:%S')}] {actor} ({iam_role}) -> {action}: {status}\")\n        \n    async def get_recent_logs(self, limit: int = 50) -> List[Dict[str, Any]]:\n        \"\"\"Get recent logs from DB\"\"\"\n        logs = await self.db.get_audit_logs(limit=limit)\n        # Map back DB schema to API schema if needed\n        # DB: action_type, API: action. \n        # But wait, I can just adjust the return or the DB service.\n        # DB Service returns dicts.\n        mapped_logs = []\n        for log in logs:\n            log[\"action\"] = log.pop(\"action_type\", log.get(\"action\"))\n            mapped_logs.append(log)\n        return mapped_logs\n    \n    async def stream(self) -> AsyncIterator[LogEntry]:\n        \"\"\"Stream logs in real-time via async generator\"\"\"\n        queue = asyncio.Queue(maxsize=100)\n        self.subscribers.append(queue)\n        \n        try:\n            while True:\n                log = await queue.get()\n                yield log\n        finally:\n            self.subscribers.remove(queue)\n    \n    # get_by_trace_id and get_denied_logs would also need DB impl, \n    # but for now I'll just remove them or impl them if needed.\n    # The interface only uses get_recent_logs and stream.\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/audit_logger.py:chunk_2",
      "file_path": "backend/services/audit_logger.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2776,
      "ingested_at": "2026-01-16T23:06:30.214123"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/action_executor.py_backend/services/action_executor.py:chunk_1_4262dd29",
    "text": "\"\"\"\nAction Executor Service\nExecutes validated actions with JSON schema enforcement\n\"\"\"\n\nimport asyncio\nfrom typing import Dict, Any, Optional\nfrom pydantic import BaseModel, Field, ValidationError\nfrom datetime import datetime, timedelta\nimport json\n\n\n# ==================== ACTION SCHEMAS ====================\n\nclass JiraTicketSchema(BaseModel):\n    \"\"\"Schema for JIRA ticket creation\"\"\"\n    title: str = Field(..., min_length=5, max_length=200)\n    description: str = Field(..., min_length=10)\n    priority: str = Field(default=\"Medium\", pattern=\"^(Low|Medium|High|Critical)$\")\n    assignee: str\n    labels: list[str] = Field(default_factory=list)\n\n\nclass MeetingSchema(BaseModel):\n    \"\"\"Schema for meeting scheduling\"\"\"\n    title: str = Field(..., min_length=3, max_length=100)\n    participants: list[str] = Field(..., min_items=1)\n    duration: int = Field(default=60, ge=15, le=480)  # minutes\n    suggested_times: list[str] = Field(..., min_items=1)\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/action_executor.py:chunk_1",
      "file_path": "backend/services/action_executor.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 959,
      "ingested_at": "2026-01-16T23:06:30.215706"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/action_executor.py_backend/services/action_executor.py:chunk_2_5e99bc4a",
    "text": "DocumentDraftSchema(BaseModel):\n    \"\"\"Schema for document drafting\"\"\"\n    title: str\n    content: str\n    document_type: str = Field(default=\"memo\", pattern=\"^(memo|policy|report|email)$\")\n\n\n# ==================== ACTION EXECUTOR ====================\n\n# ==================== ACTION EXECUTOR ====================\n\nfrom .db_service import DatabaseService\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/action_executor.py:chunk_2",
      "file_path": "backend/services/action_executor.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 354,
      "ingested_at": "2026-01-16T23:06:30.215711"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/action_executor.py_backend/services/action_executor.py:chunk_3_b6bf640a",
    "text": "ActionExecutor:\n    \"\"\"\n    Executes validated actions with JSON schema enforcement\n    - Validates action parameters\n    - Persists actions to local SQLite database\n    - Returns structured results for frontend rendering\n    \"\"\"\n    \n    def __init__(self):\n        self.action_schemas = {\n            \"CREATE_JIRA_TICKET\": JiraTicketSchema,\n            \"SCHEDULE_MEETING\": MeetingSchema,\n            \"DRAFT_DOCUMENT\": DocumentDraftSchema\n        }\n        self.db = DatabaseService()\n    \n    async def execute(\n        self,\n        action_type: str,\n        parameters: Dict[str, Any],\n        role: str\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Execute action with validation\n        \"\"\"\n        \n        # Validate action type\n        if action_type not in self.action_schemas:\n            return {\n                \"type\": \"ERROR\",\n                \"data\": {\"message\": f\"Unknown action type: {action_type}\"}\n            }\n        \n        # Validate parameters against schema\n        try:\n            schema_class = self.action_schemas[action_type]\n            validated_params = schema_class(**parameters)\n            \n            # Route to specific executor\n            if action_type == \"CREATE_JIRA_TICKET\":\n                return await self._create_jira_ticket(validated_params)\n            elif action_type == \"SCHEDULE_MEETING\":\n                return await self._schedule_meeting(validated_params)\n            elif action_type == \"DRAFT_DOCUMENT\":\n                return await self._draft_document(validated_params)\n        \n        except ValidationError as e:\n            # Return validation errors\n            return {\n                \"type\": \"VALIDATION_ERROR\",\n                \"data\": {\n                    \"message\": \"Invalid action parameters\",\n                    \"errors\": json.loads(e.json())\n                }\n            }\n        except Exception as e:\n            return {\n                \"type\": \"ERROR\",\n                \"data\": {\"message\": str(e)}\n            }\n    \n    async def _create_jira_ticket(self, params: JiraTicketSchema) -> Dict[str, Any]:\n        \"\"\"\n        Create JIRA ticket and persist to DB\n        \"\"\"\n        \n        # Generate ticket ID\n        ticket_id = f\"JIRA-{hash(params.title) % 10000}\"\n        if ticket_id.startswith(\"JIRA--\"): # Handle negative hash\n             ticket_id = ticket_id.replace(\"JIRA--\", \"JIRA-\")\n        \n        ticket_data = {\n            \"ticket_id\": ticket_id,\n            \"title\": params.title,\n            \"description\": params.description,\n            \"priority\": params.priority,\n            \"assignee\": params.assignee,\n            \"status\": \"TO DO\",\n            \"url\": f\"https://jira.company.com/browse/{ticket_id}\",\n            \"created_at\": datetime.now().isoformat()\n        }\n        \n        # Persist to DB\n        await self.db.create_ticket(ticket_data)\n        \n        return {\n            \"type\": \"TICKET\",\n            \"data\": ticket_data\n        }\n    \n    async def _schedule_meeting(self, params: MeetingSchema) -> Dict[str, Any]:\n        \"\"\"\n        Schedule meeting and persist to DB\n        \"\"\"\n        \n        meeting_data = {\n            \"title\": params.title,\n            \"participants\": params.participants,\n            \"duration\": params.duration,\n            \"scheduled_time\": params.suggested_times[0],  # Pick first slot for now\n            \"status\": \"SCHEDULED\"\n        }\n        \n        # Persist to DB\n        saved_meeting = await self.db.create_meeting(meeting_data)\n        \n        return {\n            \"type\": \"CALENDAR\",\n            \"data\": {\n                \"id\": saved_meeting[\"id\"],\n                \"title\": params.title,\n                \"participants\": params.participants,\n                \"duration_minutes\": params.duration,\n                \"confirmed_time\": params.suggested_times[0],\n                \"calendar_link\": \"https://calendar.company.com/event/new\",\n                \"status\": \"CONFIRMED\"\n            }\n        }\n    \n    async def _draft_document(self, params: DocumentDraftSchema) -> Dict[str, Any]:\n        \"\"\"\n        Draft document (Mock only, no persistence needed yet)\n        \"\"\"\n        \n        await asyncio.sleep(0.3)\n        \n        return {\n            \"type\": \"DOCUMENT\",\n            \"data\": {\n                \"title\": params.title,\n                \"content_preview\": params.content[:200] + \"...\",\n                \"document_type\": params.document_type,\n                \"word_count\": len(params.content.split()),\n                \"status\": \"DRAFT\",\n                \"edit_url\": \"https://docs.company.com/document/new\"\n            }\n        }\n    \n    async def validate_schema(self, action_type: str, parameters: Dict[str, Any]) -> Dict[str, Any]:\n        \"\"\"\n        Validate parameters without executing\n        Useful for pre-flight checks\n        \"\"\"\n        \n        if action_type not in self.action_schemas:\n            return {\n                \"valid\": False,\n                \"errors\": [f\"Unknown action type: {action_type}\"]\n            }\n        \n        try:\n            schema_class = self.action_schemas[action_type]\n            schema_class(**parameters)\n            return {\"valid\": True, \"errors\": []}\n        \n        except ValidationError as e:\n            return {\n                \"valid\": False,\n                \"errors\": [err[\"msg\"] for err in e.errors()]\n            }\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/action_executor.py:chunk_3",
      "file_path": "backend/services/action_executor.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 5348,
      "ingested_at": "2026-01-16T23:06:30.215715"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/agentic_rag.py_backend/services/agentic_rag.py:chunk_1_b91104e8",
    "text": "\"\"\"\nAgentic RAG Service\nMulti-hop retrieval with LLM-driven self-reflection and cross-encoder reranking.\n\"\"\"\n\nimport asyncio\nfrom typing import List, Dict, Any, Optional, Tuple\nimport httpx\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/agentic_rag.py:chunk_1",
      "file_path": "backend/services/agentic_rag.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 191,
      "ingested_at": "2026-01-16T23:06:30.217500"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/agentic_rag.py_backend/services/agentic_rag.py:chunk_2_3100e927",
    "text": "AgenticRAG:\n    \"\"\"\n    Agentic RAG with:\n    1. Initial retrieval\n    2. LLM reflection on information sufficiency\n    3. Follow-up queries if needed (multi-hop)\n    4. Cross-encoder reranking of final results\n    \"\"\"\n    \n    def __init__(\n        self,\n        rag_service,\n        llm_base_url: str = \"http://localhost:11434\",\n        llm_model: str = \"qwen2.5-coder:7b\",\n        max_hops: int = 3\n    ):\n        self.rag_service = rag_service\n        self.llm_base_url = llm_base_url\n        self.llm_model = llm_model\n        self.max_hops = max_hops\n        self.client = httpx.AsyncClient(timeout=60.0)\n        \n        # Initialize reranker (lazy load to avoid import errors if not installed)\n        self.reranker = None\n        self._init_reranker()\n    \n    def _init_reranker(self):\n        \"\"\"Initialize cross-encoder reranker\"\"\"\n        try:\n            from sentence_transformers import CrossEncoder\n            self.reranker = CrossEncoder('cross-encoder/ms-marco-MiniLM-L-6-v2')\n            print(\"\u2705 Cross-encoder reranker initialized\")\n        except ImportError:\n            print(\"\u26a0\ufe0f sentence-transformers not installed. Reranking disabled.\")\n            self.reranker = None\n        except Exception as e:\n            print(f\"\u26a0\ufe0f Failed to load reranker: {e}\")\n            self.reranker = None\n    \n    async def retrieve_with_reflection(\n        self,\n        query: str,\n        role: str,\n        conversation_history: List[Dict[str, Any]] = None,\n        filters: Optional[Dict[str, Any]] = None,\n        top_k: int = 5\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Multi-hop retrieval with LLM-driven reflection.\n        \n        Flow:\n        1. Retrieve initial documents\n        2. Ask LLM if information is sufficient\n        3. If not, generate follow-up query and repeat\n        4. Rerank all collected chunks\n        \"\"\"\n        all_chunks = []\n        all_sources = []\n        queries_made = [query]\n        current_query = query\n        \n        for hop in range(self.max_hops):\n            # Step 1: Retrieve documents\n            results = await self.rag_service.retrieve(\n                query=current_query,\n                role=role,\n                top_k=top_k,\n                filters=filters\n            )\n            \n            # Add new chunks (avoid duplicates)\n            new_chunks = results.get(\"chunks\", [])\n            for chunk in new_chunks:\n                chunk_text = chunk.get(\"text\", \"\")\n                if not any(c.get(\"text\") == chunk_text for c in all_chunks):\n                    all_chunks.append(chunk)\n            \n            all_sources.extend(results.get(\"sources\", []))\n            \n            # Step 2: Check if we have enough information\n            if hop < self.max_hops - 1:  # Don't reflect on last hop\n                is_sufficient, follow_up = await self._reflect_on_results(\n                    original_query=query,\n                    retrieved_chunks=all_chunks,\n                    conversation_history=conversation_history\n                )\n                \n                if is_sufficient:\n                    break\n                \n                # Step 3: Use follow-up query for next hop\n                # Deduplication check\n                if follow_up in queries_made:\n                    print(f\"Skipping duplicate query: {follow_up}\")\n                    break\n                    \n                current_query = follow_up\n                queries_made.append(follow_up)\n        \n        # Step 4: Rerank all collected chunks\n        reranked_chunks = await self._rerank_chunks(query, all_chunks, top_k)\n        \n        # Deduplicate sources\n        unique_sources = self._deduplicate_sources(all_sources)\n        \n        return {\n            \"chunks\": reranked_chunks,\n            \"sources\": unique_sources[:top_k],\n            \"hops_taken\": len(queries_made),\n            \"queries_made\": queries_made,\n            \"total_found\": len(reranked_chunks)\n        }\n    \n    async def _reflect_on_results(\n        self,\n        original_query: str,\n        retrieved_chunks: List[Dict[str, Any]],\n        conversation_history: List[Dict[str, Any]] = None\n    ) -> Tuple[bool, str]:\n        \"\"\"\n        Ask LLM if the retrieved information is sufficient.\n        Returns: (is_sufficient, follow_up_query_if_needed)\n        \"\"\"\n        # Format chunks for the prompt\n        chunks_text = \"\\n\\n\".join([\n            f\"[Chunk {i+1}]: {chunk.get('text', '')[:500]}...\"\n            for i, chunk in enumerate(retrieved_chunks[:5])\n        ])\n        \n        # Format conversation history if available\n        history_context = \"\"\n        if conversation_history:\n            recent = conversation_history[-3:]  # Last 3 exchanges\n            history_context = \"\\n\".join([\n                f\"{msg.get('role', 'user').capitalize()}: {msg.get('content', '')[:200]}\"\n                for msg in recent\n            ])\n            history_context = f\"\\nRecent conversation:\\n{history_context}\\n\"\n        \n        reflection_prompt = f\"\"\"You are evaluating whether retrieved information is sufficient to answer a user's question.\n\nUser Question: {original_query}\n{history_context}\nRetrieved Information:\n{chunks_text}\n\nTask: Determine if this information is sufficient to fully and accurately answer the user's question.\n\nIf the information IS SUFFICIENT, respond with exactly:\nSUFFICIENT\n\nIf the information is NOT SUFFICIENT, respond with:\nNEED_MORE: <specific follow-up search query to find the missing information>\n\nFor example:\n- If asked about Q3 revenue but only Q2 is found: \"NEED_MORE: Q3 2024 revenue financial results\"\n- If asked about a policy but only general info is found: \"NEED_MORE: specific hiring policy guidelines\"\n\nBe concise. Only say NEED_MORE if critical information is truly missing.\"\"\"\n\n        try:\n            response = await self.client.post(\n                f\"{self.llm_base_url}/api/generate\",\n                json={\n                    \"model\": self.llm_model,\n                    \"prompt\": reflection_prompt,\n                    \"stream\": False,\n                    \"options\": {\n                        \"temperature\": 0.1,  # Low temperature for deterministic response\n                        \"num_predict\": 100   # Short response\n                    }\n                }\n            )\n            \n            if response.status_code == 200:\n                result = response.json().get(\"response\", \"\").strip()\n                \n                if result.upper().startswith(\"SUFFICIENT\"):\n                    return True, \"\"\n                elif result.upper().startswith(\"NEED_MORE:\"):\n                    follow_up = result[10:].strip()\n                    return False, follow_up\n                else:\n                    # Default to sufficient if unclear\n                    return True, \"\"\n            \n            return True, \"\"\n            \n        except Exception as e:\n            print(f\"Reflection error: {e}\")\n            return True, \"\"  # Default to sufficient on error\n    \n    async def _rerank_chunks(\n        self,\n        query: str,\n        chunks: List[Dict[str, Any]],\n        top_k: int = 5\n    ) -> List[Dict[str, Any]]:\n        \"\"\"\n        Rerank chunks using cross-encoder for better relevance.\n        Falls back to original order if reranker not available.\n        \"\"\"\n        if not chunks:\n            return []\n        \n        if not self.reranker:\n            # No reranker available, return as-is (limited to top_k)\n            return chunks[:top_k]\n        \n        try:\n            # Create query-document pairs for scoring\n            pairs = [[query, chunk.get(\"text\", \"\")] for chunk in chunks]\n            \n            # Get relevance scores\n            scores = self.reranker.predict(pairs)\n            \n            # Sort by score (descending)\n            scored_chunks = list(zip(chunks, scores))\n            scored_chunks.sort(key=lambda x: x[1], reverse=True)\n            \n            # Return top_k with scores added to metadata\n            reranked = []\n            for chunk, score in scored_chunks[:top_k]:\n                chunk_copy = chunk.copy()\n                if \"metadata\" not in chunk_copy:\n                    chunk_copy[\"metadata\"] = {}\n                chunk_copy[\"metadata\"][\"rerank_score\"] = float(score)\n                reranked.append(chunk_copy)\n            \n            return reranked\n            \n        except Exception as e:\n            print(f\"Reranking error: {e}\")\n            return chunks[:top_k]\n    \n    def _deduplicate_sources(\n        self,\n        sources: List[Dict[str, Any]]\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Remove duplicate sources based on document + page\"\"\"\n        seen = set()\n        unique = []\n        \n        for source in sources:\n            key = f\"{source.get('document', '')}_p{source.get('page', 0)}\"\n            if key not in seen:\n                seen.add(key)\n                unique.append(source)\n        \n        # Sort by relevance score\n        unique.sort(key=lambda x: x.get(\"relevance_score\", 0), reverse=True)\n        \n        return unique\n    \n    async def close(self):\n        \"\"\"Close HTTP client\"\"\"\n        await self.client.aclose()\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/agentic_rag.py:chunk_2",
      "file_path": "backend/services/agentic_rag.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 9175,
      "ingested_at": "2026-01-16T23:06:30.217514"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/background_agent.py_backend/services/background_agent.py:chunk_1_ce08d26d",
    "text": "\nimport asyncio\nimport json\nimport logging\nfrom typing import Dict, Any, List\n\nlogger = logging.getLogger(__name__)",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/background_agent.py:chunk_1",
      "file_path": "backend/services/background_agent.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 115,
      "ingested_at": "2026-01-16T23:06:30.218578"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/background_agent.py_backend/services/background_agent.py:chunk_2_4405a81e",
    "text": "async def run_agent_background(\n    agent,\n    query: str,\n    role: str,\n    capabilities,\n    conversation_history: List[Dict[str, Any]],\n    event_queue: asyncio.Queue,\n    db_service,\n    conversation_id: str\n):\n    \"\"\"\n    Background task to run the agent and persist results.\n    \"\"\"\n    try:\n        # Stream events\n        async for event in agent.run_stream(\n            query=query,\n            role=role,\n            capabilities=capabilities,\n            conversation_history=conversation_history\n        ):\n            # Put event in queue for live stream\n            await event_queue.put(event)\n            \n            # Persist relevant events to DB?\n            # Ideally we'd append to the message as we go, or update it.\n            # But the current DB schema might only support simple content.\n            # For now, we will collect the full answer and save it at the end.\n            # OR we can save the steps as a JSON blob if the schema allows.\n            \n    except Exception as e:\n        logger.error(f\"Error in background agent: {e}\")\n        await event_queue.put({\"type\": \"error\", \"error\": str(e)})\n    finally:\n        # Signal completion\n        await event_queue.put(None) # Sentinel\n        \n        # Save the FINAL assistant message to DB\n        # We need to extract the answer from the events... \n        # But this function is streaming.\n        # We should probably run `agent.run` (non-streaming) to get the result object?\n        # NO, we used `run_stream`. To get the final answer, we must track it.\n        pass",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/background_agent.py:chunk_2",
      "file_path": "backend/services/background_agent.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1559,
      "ingested_at": "2026-01-16T23:06:30.218582"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/background_agent.py_backend/services/background_agent.py:chunk_3_5516330f",
    "text": "# This is a bit tricky. We need to duplicate the logic of collecting the answer if we want to save it.\n# Let's improve this helper.\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/background_agent.py:chunk_3",
      "file_path": "backend/services/background_agent.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 132,
      "ingested_at": "2026-01-16T23:06:30.218586"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/hybrid_retriever.py_backend/services/hybrid_retriever.py:chunk_1_ef01abc6",
    "text": "\"\"\"\nHybrid Retriever Service\nImplements Semantic + BM25 + RRF (Reciprocal Rank Fusion) for code retrieval.\n\"\"\"\n\nimport asyncio\nfrom typing import List, Dict, Any, Optional, Tuple\nfrom collections import defaultdict\nimport numpy as np\n\n# BM25 for keyword search\nfrom rank_bm25 import BM25Okapi\n\n# Cross-encoder reranking\ntry:\n    from sentence_transformers import CrossEncoder\n    RERANKER_AVAILABLE = True\nexcept ImportError:\n    RERANKER_AVAILABLE = False\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/hybrid_retriever.py:chunk_1",
      "file_path": "backend/services/hybrid_retriever.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 458,
      "ingested_at": "2026-01-16T23:06:30.220828"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/hybrid_retriever.py_backend/services/hybrid_retriever.py:chunk_2_2ec1327e",
    "text": "HybridRetriever:\n    \"\"\"\n    Hybrid retrieval combining:\n    1. Semantic search (vector similarity)\n    2. BM25 keyword search\n    3. Graph-based expansion\n    4. RRF fusion\n    5. Cross-encoder reranking\n    \"\"\"\n    \n    def __init__(\n        self,\n        collection,  # ChromaDB collection\n        graph=None,  # NetworkX graph (optional)\n        reranker_model: str = \"cross-encoder/ms-marco-MiniLM-L-6-v2\"\n    ):\n        self.collection = collection\n        self.graph = graph\n        \n        # BM25 index (built lazily)\n        self.bm25 = None\n        self.bm25_corpus = []\n        self.bm25_ids = []\n        \n        # Cross-encoder reranker\n        self.reranker = None\n        if RERANKER_AVAILABLE:\n            try:\n                self.reranker = CrossEncoder(reranker_model)\n                print(\"\u2705 Cross-encoder reranker initialized\")\n            except Exception as e:\n                print(f\"\u26a0\ufe0f Could not load reranker: {e}\")\n    \n    def build_bm25_index(self, documents: List[Dict[str, Any]]) -> None:\n        \"\"\"Build BM25 index from documents.\"\"\"\n        self.bm25_corpus = []\n        self.bm25_ids = []\n        \n        for doc in documents:\n            text = doc.get(\"text\", \"\")\n            doc_id = doc.get(\"id\", \"\")\n            \n            # Tokenize for BM25\n            tokens = self._tokenize(text)\n            self.bm25_corpus.append(tokens)\n            self.bm25_ids.append(doc_id)\n        \n        if self.bm25_corpus:\n            self.bm25 = BM25Okapi(self.bm25_corpus)\n            print(f\"\ud83d\udcda BM25 index built with {len(self.bm25_corpus)} documents\")\n    \n    def _tokenize(self, text: str) -> List[str]:\n        \"\"\"Simple tokenization for BM25.\"\"\"\n        import re\n        # Convert camelCase and snake_case\n        text = re.sub(r'([a-z])([A-Z])', r'\\1 \\2', text)\n        text = text.replace('_', ' ')\n        # Lowercase and split\n        tokens = text.lower().split()\n        # Remove very short tokens\n        tokens = [t for t in tokens if len(t) > 2]\n        return tokens\n    \n    async def hybrid_search(\n        self,\n        query: str,\n        top_k: int = 10,\n        semantic_weight: float = 0.5,\n        bm25_weight: float = 0.3,\n        graph_weight: float = 0.2,\n        rerank: bool = True,\n        filters: Optional[Dict[str, Any]] = None\n    ) -> List[Dict[str, Any]]:\n        \"\"\"\n        Perform hybrid search with RRF fusion.\n        \"\"\"\n        all_results = {}\n        \n        # 1. Semantic search (ChromaDB)\n        semantic_results = await self._semantic_search(query, top_k * 3, filters)\n        self._add_to_results(all_results, semantic_results, \"semantic\", semantic_weight)\n        \n        # 2. BM25 keyword search\n        if self.bm25 is not None:\n            bm25_results = await self._bm25_search(query, top_k * 3)\n            self._add_to_results(all_results, bm25_results, \"bm25\", bm25_weight)\n        \n        # 3. Graph expansion (if available)\n        if self.graph is not None and semantic_results:\n            graph_results = await self._graph_expansion(semantic_results[:3])\n            self._add_to_results(all_results, graph_results, \"graph\", graph_weight)\n        \n        # 4. RRF fusion\n        fused_results = self._rrf_fusion(all_results)\n        \n        # 5. Get top candidates\n        top_candidates = sorted(fused_results.items(), key=lambda x: x[1], reverse=True)[:top_k * 2]\n        \n        # 6. Enrich with full documents\n        enriched = await self._enrich_results([doc_id for doc_id, _ in top_candidates])\n        \n        # 7. Rerank with cross-encoder\n        if rerank and self.reranker and len(enriched) > 0:\n            enriched = await self._rerank(query, enriched, top_k)\n        else:\n            enriched = enriched[:top_k]\n        \n        return enriched\n    \n    async def _semantic_search(\n        self,\n        query: str,\n        top_k: int,\n        filters: Optional[Dict[str, Any]] = None\n    ) -> List[Tuple[str, float]]:\n        \"\"\"Semantic search using ChromaDB.\"\"\"\n        try:\n            where = filters if filters else None\n            \n            results = self.collection.query(\n                query_texts=[query],\n                n_results=top_k,\n                where=where\n            )\n            \n            # Return (id, score) tuples\n            ids = results.get(\"ids\", [[]])[0]\n            distances = results.get(\"distances\", [[]])[0]\n            \n            # Convert distances to similarity scores\n            scores = [1 / (1 + d) for d in distances]\n            \n            return list(zip(ids, scores))\n            \n        except Exception as e:\n            print(f\"Semantic search error: {e}\")\n            return []\n    \n    async def _bm25_search(\n        self,\n        query: str,\n        top_k: int\n    ) -> List[Tuple[str, float]]:\n        \"\"\"BM25 keyword search.\"\"\"\n        if self.bm25 is None:\n            return []\n        \n        tokens = self._tokenize(query)\n        scores = self.bm25.get_scores(tokens)\n        \n        # Get top k indices\n        top_indices = np.argsort(scores)[::-1][:top_k]\n        \n        results = []\n        for idx in top_indices:\n            if scores[idx] > 0:\n                results.append((self.bm25_ids[idx], float(scores[idx])))\n        \n        # Normalize scores\n        if results:\n            max_score = max(r[1] for r in results)\n            if max_score > 0:\n                results = [(doc_id, score / max_score) for doc_id, score in results]\n        \n        return results\n    \n    async def _graph_expansion(\n        self,\n        seed_results: List[Tuple[str, float]]\n    ) -> List[Tuple[str, float]]:\n        \"\"\"Expand results using code graph.\"\"\"\n        if self.graph is None:\n            return []\n        \n        expanded = []\n        \n        for doc_id, score in seed_results:\n            # Try to find node by matching file path\n            for node in self.graph.nodes():\n                if doc_id in node or node in doc_id:\n                    # Get neighbors\n                    neighbors = list(self.graph.neighbors(node))\n                    for neighbor in neighbors[:5]:\n                        # Give neighbors a reduced score\n                        expanded.append((neighbor, score * 0.5))\n                    break\n        \n        return expanded\n    \n    def _add_to_results(\n        self,\n        all_results: Dict[str, List[Tuple[int, str]]],\n        new_results: List[Tuple[str, float]],\n        source: str,\n        weight: float\n    ) -> None:\n        \"\"\"Add results with their ranks for RRF.\"\"\"\n        for rank, (doc_id, score) in enumerate(new_results):\n            if doc_id not in all_results:\n                all_results[doc_id] = []\n            all_results[doc_id].append((rank + 1, source, weight))\n    \n    def _rrf_fusion(\n        self,\n        all_results: Dict[str, List[Tuple[int, str, float]]],\n        k: int = 60\n    ) -> Dict[str, float]:\n        \"\"\"\n        Reciprocal Rank Fusion.\n        RRF(d) = \u03a3 1 / (k + rank(d))\n        \"\"\"\n        fused = {}\n        \n        for doc_id, ranks in all_results.items():\n            score = 0\n            for rank, source, weight in ranks:\n                score += weight * (1 / (k + rank))\n            fused[doc_id] = score\n        \n        return fused\n    \n    async def _enrich_results(\n        self,\n        doc_ids: List[str]\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Fetch full documents from ChromaDB.\"\"\"\n        if not doc_ids:\n            return []\n        \n        try:\n            results = self.collection.get(\n                ids=doc_ids,\n                include=[\"documents\", \"metadatas\"]\n            )\n            \n            enriched = []\n            for i, doc_id in enumerate(results.get(\"ids\", [])):\n                enriched.append({\n                    \"id\": doc_id,\n                    \"text\": results[\"documents\"][i] if results.get(\"documents\") else \"\",\n                    \"metadata\": results[\"metadatas\"][i] if results.get(\"metadatas\") else {}\n                })\n            \n            return enriched\n            \n        except Exception as e:\n            print(f\"Enrichment error: {e}\")\n            return []\n    \n    async def _rerank(\n        self,\n        query: str,\n        documents: List[Dict[str, Any]],\n        top_k: int\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Rerank documents using cross-encoder.\"\"\"\n        if not self.reranker or not documents:\n            return documents[:top_k]\n        \n        try:\n            # Create query-document pairs\n            pairs = [[query, doc.get(\"text\", \"\")[:1000]] for doc in documents]\n            \n            # Get scores\n            scores = self.reranker.predict(pairs)\n            \n            # Sort by score\n            scored_docs = list(zip(documents, scores))\n            scored_docs.sort(key=lambda x: x[1], reverse=True)\n            \n            # Add rerank score to metadata\n            reranked = []\n            for doc, score in scored_docs[:top_k]:\n                doc_copy = doc.copy()\n                doc_copy[\"rerank_score\"] = float(score)\n                reranked.append(doc_copy)\n            \n            return reranked\n            \n        except Exception as e:\n            print(f\"Reranking error: {e}\")\n            return documents[:top_k]\n    \n    def format_for_context(\n        self,\n        results: List[Dict[str, Any]],\n        max_chars: int = 8000\n    ) -> str:\n        \"\"\"Format results for LLM context.\"\"\"\n        context_parts = []\n        total_chars = 0\n        \n        for doc in results:\n            meta = doc.get(\"metadata\", {})\n            text = doc.get(\"text\", \"\")\n            \n            file_path = meta.get(\"file_path\", \"unknown\")\n            start_line = meta.get(\"start_line\", \"?\")\n            end_line = meta.get(\"end_line\", \"?\")\n            language = meta.get(\"language\", \"\")\n            name = meta.get(\"name\", \"\")\n            \n            header = f\"\ud83d\udcc1 {file_path}:{start_line}-{end_line}\"\n            if name:\n                header += f\" ({name})\"\n            \n            code_block = f\"\\n{header}\\n```{language}\\n{text}\\n```\\n\"\n            \n            if total_chars + len(code_block) > max_chars:\n                break\n            \n            context_parts.append(code_block)\n            total_chars += len(code_block)\n        \n        return \"\\n\".join(context_parts)\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/hybrid_retriever.py:chunk_2",
      "file_path": "backend/services/hybrid_retriever.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 10307,
      "ingested_at": "2026-01-16T23:06:30.220876"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/db_service.py_backend/services/db_service.py:chunk_1_103a83ce",
    "text": "\"\"\"\nDatabase Service V2\nSQLite implementation for:\n- Tickets, Meetings, Audit Logs (existing)\n- Conversations & Messages (NEW)\n- User Documents (NEW)\n\"\"\"\n\nimport sqlite3\nimport json\nfrom pathlib import Path\nfrom typing import List, Dict, Any, Optional\nfrom datetime import datetime\nimport uuid\n\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/db_service.py:chunk_1",
      "file_path": "backend/services/db_service.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 295,
      "ingested_at": "2026-01-16T23:06:30.223322"
    }
  },
  {
    "id": "enterprise-copilot_backend/services/db_service.py_backend/services/db_service.py:chunk_2_4b564114",
    "text": "DatabaseService:\n    def __init__(self, db_path: Optional[str] = None):\n        if db_path is None:\n            self.db_path = str(Path(__file__).parent.parent / \"db.sqlite\")\n        else:\n            self.db_path = db_path\n        \n        self._init_db()\n\n    def _get_connection(self):\n        conn = sqlite3.connect(self.db_path)\n        conn.row_factory = sqlite3.Row\n        return conn\n\n    def _init_db(self):\n        \"\"\"Initialize all database tables\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        # ==================== EXISTING TABLES ====================\n        \n        # Tickets Table\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS tickets (\n                id TEXT PRIMARY KEY,\n                title TEXT NOT NULL,\n                description TEXT,\n                priority TEXT,\n                assignee TEXT,\n                status TEXT,\n                created_at TEXT\n            )\n        \"\"\")\n\n        # Meetings Table\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS meetings (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                title TEXT NOT NULL,\n                participants TEXT,\n                duration INTEGER,\n                scheduled_time TEXT,\n                status TEXT\n            )\n        \"\"\")\n\n        # Audit Logs Table\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS audit_logs (\n                id TEXT PRIMARY KEY,\n                timestamp TEXT NOT NULL,\n                actor TEXT NOT NULL,\n                action_type TEXT NOT NULL,\n                status TEXT NOT NULL,\n                details TEXT,\n                trace_id TEXT\n            )\n        \"\"\")\n        \n        # ==================== NEW V2 TABLES ====================\n        \n        # Conversations Table (chat sessions)\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS conversations (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL,\n                role TEXT NOT NULL,\n                title TEXT,\n                created_at TEXT NOT NULL,\n                updated_at TEXT NOT NULL\n            )\n        \"\"\")\n        \n        # Messages Table (messages within conversations)\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS messages (\n                id INTEGER PRIMARY KEY AUTOINCREMENT,\n                conversation_id TEXT NOT NULL,\n                role TEXT NOT NULL,\n                content TEXT NOT NULL,\n                metadata TEXT,\n                created_at TEXT NOT NULL,\n                FOREIGN KEY (conversation_id) REFERENCES conversations(id) ON DELETE CASCADE\n            )\n        \"\"\")\n        \n        # User Documents Table (per-user document library)\n        cursor.execute(\"\"\"\n            CREATE TABLE IF NOT EXISTS user_documents (\n                id TEXT PRIMARY KEY,\n                user_id TEXT NOT NULL,\n                filename TEXT NOT NULL,\n                original_filename TEXT,\n                file_path TEXT,\n                file_size INTEGER,\n                category TEXT,\n                sensitivity_level INTEGER DEFAULT 2,\n                chunk_count INTEGER DEFAULT 0,\n                uploaded_at TEXT NOT NULL,\n                status TEXT DEFAULT 'processing',\n                error_message TEXT\n            )\n        \"\"\")\n        \n        # Create indexes for common queries\n        cursor.execute(\"\"\"\n            CREATE INDEX IF NOT EXISTS idx_conversations_user \n            ON conversations(user_id, updated_at DESC)\n        \"\"\")\n        \n        cursor.execute(\"\"\"\n            CREATE INDEX IF NOT EXISTS idx_messages_conversation \n            ON messages(conversation_id, created_at ASC)\n        \"\"\")\n        \n        cursor.execute(\"\"\"\n            CREATE INDEX IF NOT EXISTS idx_user_documents_user \n            ON user_documents(user_id, uploaded_at DESC)\n        \"\"\")\n        \n        conn.commit()\n        conn.close()\n\n    # ==================== TICKETS ====================\n    \n    async def create_ticket(self, ticket_data: Dict[str, Any]) -> Dict[str, Any]:\n        \"\"\"Create a new Jira ticket\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        ticket_id = ticket_data[\"ticket_id\"]\n        \n        cursor.execute(\n            \"INSERT INTO tickets (id, title, description, priority, assignee, status, created_at) VALUES (?, ?, ?, ?, ?, ?, ?)\",\n            (\n                ticket_id,\n                ticket_data[\"title\"],\n                ticket_data.get(\"description\", \"\"),\n                ticket_data.get(\"priority\", \"Medium\"),\n                ticket_data.get(\"assignee\", \"Unassigned\"),\n                ticket_data.get(\"status\", \"TO DO\"),\n                ticket_data.get(\"created_at\", datetime.now().isoformat())\n            )\n        )\n        conn.commit()\n        conn.close()\n        return ticket_data\n\n    async def get_tickets(self, limit: int = 10) -> List[Dict[str, Any]]:\n        \"\"\"Get recent tickets\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM tickets ORDER BY created_at DESC LIMIT ?\", (limit,))\n        rows = cursor.fetchall()\n        conn.close()\n        \n        return [dict(row) for row in rows]\n\n    # ==================== MEETINGS ====================\n    \n    async def create_meeting(self, meeting_data: Dict[str, Any]) -> Dict[str, Any]:\n        \"\"\"Create a new meeting\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        participants_json = json.dumps(meeting_data.get(\"participants\", []))\n        \n        cursor.execute(\n            \"INSERT INTO meetings (title, participants, duration, scheduled_time, status) VALUES (?, ?, ?, ?, ?)\",\n            (\n                meeting_data[\"title\"],\n                participants_json,\n                meeting_data.get(\"duration\", 30),\n                meeting_data.get(\"scheduled_time\", \"\"),\n                meeting_data.get(\"status\", \"SCHEDULED\")\n            )\n        )\n        meeting_id = cursor.lastrowid\n        conn.commit()\n        conn.close()\n        \n        meeting_data[\"id\"] = meeting_id\n        return meeting_data\n\n    # ==================== AUDIT LOGS ====================\n    \n    async def log_event(self, log_entry: Dict[str, Any]):\n        \"\"\"Log an audit event\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        details_json = json.dumps(log_entry.get(\"details\", {})) if isinstance(log_entry.get(\"details\"), dict) else log_entry.get(\"details\", \"\")\n        \n        cursor.execute(\n            \"INSERT INTO audit_logs (id, timestamp, actor, action_type, status, details, trace_id) VALUES (?, ?, ?, ?, ?, ?, ?)\",\n            (\n                log_entry[\"id\"],\n                log_entry[\"timestamp\"],\n                log_entry[\"actor\"],\n                log_entry[\"action_type\"],\n                log_entry[\"status\"],\n                details_json,\n                log_entry.get(\"trace_id\", \"\")\n            )\n        )\n        conn.commit()\n        conn.close()\n\n    async def get_audit_logs(self, limit: int = 50) -> List[Dict[str, Any]]:\n        \"\"\"Get recent audit logs\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM audit_logs ORDER BY timestamp DESC LIMIT ?\", (limit,))\n        rows = cursor.fetchall()\n        conn.close()\n        \n        logs = []\n        for row in rows:\n            log_dict = dict(row)\n            if log_dict[\"details\"]:\n                try:\n                    log_dict[\"details\"] = json.loads(log_dict[\"details\"])\n                except:\n                    pass\n            logs.append(log_dict)\n        return logs\n\n    # ==================== CONVERSATIONS (NEW) ====================\n    \n    async def create_conversation(\n        self,\n        user_id: str,\n        role: str,\n        title: Optional[str] = None\n    ) -> Dict[str, Any]:\n        \"\"\"Create a new conversation session\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        conversation_id = str(uuid.uuid4())\n        now = datetime.now().isoformat()\n        \n        cursor.execute(\n            \"INSERT INTO conversations (id, user_id, role, title, created_at, updated_at) VALUES (?, ?, ?, ?, ?, ?)\",\n            (conversation_id, user_id, role, title or \"New Chat\", now, now)\n        )\n        conn.commit()\n        conn.close()\n        \n        return {\n            \"id\": conversation_id,\n            \"user_id\": user_id,\n            \"role\": role,\n            \"title\": title or \"New Chat\",\n            \"created_at\": now,\n            \"updated_at\": now\n        }\n    \n    async def get_conversations(\n        self,\n        user_id: str,\n        limit: int = 20\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Get user's conversations, most recent first\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\n            \"SELECT * FROM conversations WHERE user_id = ? ORDER BY updated_at DESC LIMIT ?\",\n            (user_id, limit)\n        )\n        rows = cursor.fetchall()\n        conn.close()\n        \n        return [dict(row) for row in rows]\n    \n    async def get_conversation(self, conversation_id: str) -> Optional[Dict[str, Any]]:\n        \"\"\"Get a single conversation by ID\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM conversations WHERE id = ?\", (conversation_id,))\n        row = cursor.fetchone()\n        conn.close()\n        \n        return dict(row) if row else None\n    \n    async def update_conversation(\n        self,\n        conversation_id: str,\n        title: Optional[str] = None\n    ) -> bool:\n        \"\"\"Update conversation (e.g., auto-generate title from first message)\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        now = datetime.now().isoformat()\n        \n        if title:\n            cursor.execute(\n                \"UPDATE conversations SET title = ?, updated_at = ? WHERE id = ?\",\n                (title, now, conversation_id)\n            )\n        else:\n            cursor.execute(\n                \"UPDATE conversations SET updated_at = ? WHERE id = ?\",\n                (now, conversation_id)\n            )\n        \n        conn.commit()\n        success = cursor.rowcount > 0\n        conn.close()\n        \n        return success\n    \n    async def delete_conversation(self, conversation_id: str) -> bool:\n        \"\"\"Delete a conversation and all its messages\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        # Delete messages first (or rely on CASCADE)\n        cursor.execute(\"DELETE FROM messages WHERE conversation_id = ?\", (conversation_id,))\n        cursor.execute(\"DELETE FROM conversations WHERE id = ?\", (conversation_id,))\n        \n        conn.commit()\n        success = cursor.rowcount > 0\n        conn.close()\n        \n        return success\n\n    # ==================== MESSAGES (NEW) ====================\n    \n    async def add_message(\n        self,\n        conversation_id: str,\n        role: str,  # 'user' or 'assistant'\n        content: str,\n        metadata: Optional[Dict[str, Any]] = None\n    ) -> Dict[str, Any]:\n        \"\"\"Add a message to a conversation\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        now = datetime.now().isoformat()\n        metadata_json = json.dumps(metadata) if metadata else None\n        \n        cursor.execute(\n            \"INSERT INTO messages (conversation_id, role, content, metadata, created_at) VALUES (?, ?, ?, ?, ?)\",\n            (conversation_id, role, content, metadata_json, now)\n        )\n        message_id = cursor.lastrowid\n        \n        # Update conversation's updated_at\n        cursor.execute(\n            \"UPDATE conversations SET updated_at = ? WHERE id = ?\",\n            (now, conversation_id)\n        )\n        \n        conn.commit()\n        conn.close()\n        \n        return {\n            \"id\": message_id,\n            \"conversation_id\": conversation_id,\n            \"role\": role,\n            \"content\": content,\n            \"metadata\": metadata,\n            \"created_at\": now\n        }\n    \n    async def get_messages(\n        self,\n        conversation_id: str,\n        limit: int = 100\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Get messages for a conversation, oldest first\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\n            \"SELECT * FROM messages WHERE conversation_id = ? ORDER BY created_at ASC LIMIT ?\",\n            (conversation_id, limit)\n        )\n        rows = cursor.fetchall()\n        conn.close()\n        \n        messages = []\n        for row in rows:\n            msg = dict(row)\n            if msg[\"metadata\"]:\n                try:\n                    msg[\"metadata\"] = json.loads(msg[\"metadata\"])\n                except:\n                    pass\n            messages.append(msg)\n        \n        return messages\n    \n    async def get_recent_messages(\n        self,\n        conversation_id: str,\n        limit: int = 10\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Get the most recent N messages (for context window)\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        # Get last N messages, but return in chronological order\n        cursor.execute(\n            \"\"\"\n            SELECT * FROM (\n                SELECT * FROM messages \n                WHERE conversation_id = ? \n                ORDER BY created_at DESC \n                LIMIT ?\n            ) ORDER BY created_at ASC\n            \"\"\",\n            (conversation_id, limit)\n        )\n        rows = cursor.fetchall()\n        conn.close()\n        \n        messages = []\n        for row in rows:\n            msg = dict(row)\n            if msg[\"metadata\"]:\n                try:\n                    msg[\"metadata\"] = json.loads(msg[\"metadata\"])\n                except:\n                    pass\n            messages.append(msg)\n        \n        return messages\n\n    # ==================== USER DOCUMENTS (NEW) ====================\n    \n    async def add_user_document(\n        self,\n        user_id: str,\n        filename: str,\n        original_filename: str,\n        file_path: str,\n        file_size: int,\n        category: str = \"General Document\",\n        sensitivity_level: int = 2\n    ) -> Dict[str, Any]:\n        \"\"\"Add a document to user's library\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        doc_id = str(uuid.uuid4())\n        now = datetime.now().isoformat()\n        \n        cursor.execute(\n            \"\"\"\n            INSERT INTO user_documents \n            (id, user_id, filename, original_filename, file_path, file_size, \n             category, sensitivity_level, uploaded_at, status) \n            VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 'processing')\n            \"\"\",\n            (doc_id, user_id, filename, original_filename, file_path, \n             file_size, category, sensitivity_level, now)\n        )\n        conn.commit()\n        conn.close()\n        \n        return {\n            \"id\": doc_id,\n            \"user_id\": user_id,\n            \"filename\": filename,\n            \"original_filename\": original_filename,\n            \"file_path\": file_path,\n            \"file_size\": file_size,\n            \"category\": category,\n            \"sensitivity_level\": sensitivity_level,\n            \"chunk_count\": 0,\n            \"uploaded_at\": now,\n            \"status\": \"processing\"\n        }\n    \n    async def update_document_status(\n        self,\n        doc_id: str,\n        status: str,\n        chunk_count: int = 0,\n        error_message: Optional[str] = None\n    ) -> bool:\n        \"\"\"Update document processing status\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\n            \"UPDATE user_documents SET status = ?, chunk_count = ?, error_message = ? WHERE id = ?\",\n            (status, chunk_count, error_message, doc_id)\n        )\n        conn.commit()\n        success = cursor.rowcount > 0\n        conn.close()\n        \n        return success\n    \n    async def get_user_documents(\n        self,\n        user_id: str,\n        status: Optional[str] = None\n    ) -> List[Dict[str, Any]]:\n        \"\"\"Get documents for a user\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        if status:\n            cursor.execute(\n                \"SELECT * FROM user_documents WHERE user_id = ? AND status = ? ORDER BY uploaded_at DESC\",\n                (user_id, status)\n            )\n        else:\n            cursor.execute(\n                \"SELECT * FROM user_documents WHERE user_id = ? ORDER BY uploaded_at DESC\",\n                (user_id,)\n            )\n        \n        rows = cursor.fetchall()\n        conn.close()\n        \n        return [dict(row) for row in rows]\n    \n    async def get_document(self, doc_id: str) -> Optional[Dict[str, Any]]:\n        \"\"\"Get a single document by ID\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"SELECT * FROM user_documents WHERE id = ?\", (doc_id,))\n        row = cursor.fetchone()\n        conn.close()\n        \n        return dict(row) if row else None\n    \n    async def delete_user_document(self, doc_id: str) -> bool:\n        \"\"\"Delete a document (also need to clean up ChromaDB)\"\"\"\n        conn = self._get_connection()\n        cursor = conn.cursor()\n        \n        cursor.execute(\"DELETE FROM user_documents WHERE id = ?\", (doc_id,))\n        conn.commit()\n        success = cursor.rowcount > 0\n        conn.close()\n        \n        return success\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "backend/services/db_service.py:chunk_2",
      "file_path": "backend/services/db_service.py",
      "language": "python",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 17739,
      "ingested_at": "2026-01-16T23:06:30.223330"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/main.jsx_frontend/src/main.jsx:chunk_1_ddf5c20b",
    "text": "import React from 'react'\nimport ReactDOM from 'react-dom/client'\nimport App from './App'\nimport './index.css'\n\nReactDOM.createRoot(document.getElementById('root')).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n)\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/main.jsx:chunk_1",
      "file_path": "frontend/src/main.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 231,
      "ingested_at": "2026-01-16T23:06:30.224428"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/App.jsx_frontend/src/App.jsx:chunk_1_668de22f",
    "text": "import React from 'react';\nimport { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';\nimport Layout from './components/Layout';\nimport ChatView from './views/ChatView';\n\nimport DocumentsView from './views/DocumentsView';\nimport RepositoriesView from './views/RepositoriesView';\nimport IntegrationsView from './views/IntegrationsView';\nimport IAMConfigView from './views/IAMConfigView';\nimport LiveOpsView from './views/LiveOpsView';\n\n// We will implement these views in the next steps",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/App.jsx:chunk_1",
      "file_path": "frontend/src/App.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 510,
      "ingested_at": "2026-01-16T23:06:30.225140"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/App.jsx_frontend/src/App.jsx:chunk_2_5896ef45",
    "text": "const App = () => {\n  return (\n    <Router>\n      <Routes>\n        <Route path=\"/\" element={<Layout />}>\n          <Route index element={<Navigate to=\"/chat\" replace />} />\n          <Route path=\"chat\" element={<ChatView />} />\n          <Route path=\"documents\" element={<DocumentsView />} />\n          <Route path=\"repos\" element={<RepositoriesView />} />\n          <Route path=\"integrations\" element={<IntegrationsView />} />\n          <Route path=\"iam\" element={<IAMConfigView />} />\n          <Route path=\"live-console\" element={<LiveOpsView />} />\n        </Route>\n      </Routes>\n    </Router>\n  );\n};\n\nexport default App;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/App.jsx:chunk_2",
      "file_path": "frontend/src/App.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 629,
      "ingested_at": "2026-01-16T23:06:30.225144"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Layout.jsx_frontend/src/components/Layout.jsx:chunk_1_e2a41684",
    "text": "import React, { useState } from 'react';\nimport { Outlet } from 'react-router-dom';\nimport Sidebar from './Sidebar';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Terminal, X, Activity, Server, Database, Globe } from 'lucide-react';\n\nconst Layout = () => {\n    const [isLiveOpsOpen, setIsLiveOpsOpen] = useState(false);\n\n    return (\n        <div className=\"min-h-screen bg-[#0B1120] text-slate-200 font-sans selection:bg-blue-500/30\">\n            <Sidebar isLiveOpsOpen={isLiveOpsOpen} setIsLiveOpsOpen={setIsLiveOpsOpen} />\n\n            {/* Main Content */}\n            <main className={`\n        transition-all duration-300 ease-in-out min-h-screen relative\n        lg:pl-64\n        ${isLiveOpsOpen ? 'pb-80' : ''} \n      `}>\n                <div className=\"p-4 lg:p-8 max-w-7xl mx-auto\">\n                    <Outlet />\n                </div>\n            </main>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Layout.jsx:chunk_1",
      "file_path": "frontend/src/components/Layout.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 885,
      "ingested_at": "2026-01-16T23:06:30.226210"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Layout.jsx_frontend/src/components/Layout.jsx:chunk_2_cd7c5829",
    "text": "            {/* Live Ops Console Overlay */}\n            <AnimatePresence>\n                {isLiveOpsOpen && (\n                    <motion.div\n                        initial={{ y: '100%' }}\n                        animate={{ y: 0 }}\n                        exit={{ y: '100%' }}\n                        transition={{ type: 'spring', damping: 25, stiffness: 200 }}\n                        className=\"fixed bottom-0 left-0 lg:left-64 right-0 h-80 bg-[#0f172a] border-t border-slate-700/50 shadow-[0_-10px_40px_-10px_rgba(0,0,0,0.5)] z-30 flex flex-col\"\n                    >\n                        {/* Console Header */}\n                        <div className=\"h-10 bg-slate-900 border-b border-slate-700/50 flex items-center justify-between px-4\">\n                            <div className=\"flex items-center gap-4\">\n                                <div className=\"flex items-center gap-2 text-blue-400\">\n                                    <Terminal size={14} />\n                                    <span className=\"text-xs font-bold uppercase tracking-wider\">Live Ops Console</span>\n                                </div>\n                                <div className=\"h-4 w-px bg-slate-700\"></div>\n                                <div className=\"flex items-center gap-3 text-xs text-slate-400\">\n                                    <div className=\"flex items-center gap-1.5\">\n                                        <span className=\"w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-[0_0_5px_rgba(34,197,94,0.5)]\"></span>\n                                        US-EAST-1\n                                    </div>\n                                    <div className=\"flex items-center gap-1.5\">\n                                        <Activity size={12} />\n                                        Latency: 24ms\n                                    </div>\n                                </div>\n                            </div>\n                            <div className=\"flex items-center gap-2\">\n                                <button onClick={() => setIsLiveOpsOpen(false)} className=\"text-slate-500 hover:text-white transition-colors\">\n                                    <X size={16} />\n                                </button>\n                            </div>\n                        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Layout.jsx:chunk_2",
      "file_path": "frontend/src/components/Layout.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2302,
      "ingested_at": "2026-01-16T23:06:30.226215"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Layout.jsx_frontend/src/components/Layout.jsx:chunk_3_64af87ad",
    "text": "                        {/* Console Body */}\n                        <div className=\"flex-1 p-0 overflow-hidden flex\">\n                            {/* Metrics Sidebar */}\n                            <div className=\"w-48 bg-slate-900/50 border-r border-slate-800 p-3 space-y-2 overflow-y-auto\">\n                                <MetricItem icon={Server} label=\"API Gateway\" value=\"99.9%\" status=\"good\" />\n                                <MetricItem icon={Database} label=\"Primary DB\" value=\"45% CPU\" status=\"warning\" />\n                                <MetricItem icon={Globe} label=\"CDN Hits\" value=\"1.2k/s\" status=\"good\" />\n                                <MetricItem icon={Activity} label=\"Error Rate\" value=\"0.01%\" status=\"good\" />\n                            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Layout.jsx:chunk_3",
      "file_path": "frontend/src/components/Layout.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 768,
      "ingested_at": "2026-01-16T23:06:30.226218"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Layout.jsx_frontend/src/components/Layout.jsx:chunk_4_5c632144",
    "text": "                            {/* Terminal Output */}\n                            <div className=\"flex-1 bg-[#0B1120] p-4 font-mono text-sm overflow-y-auto custom-scrollbar\">\n                                <div className=\"text-slate-500 mb-2\">System initialized. Listening for events...</div>\n                                <LogEntry time=\"22:04:15\" level=\"INFO\" source=\"Autoscaler\" message=\"Scaling up worker pool to 5 instances\" />\n                                <LogEntry time=\"22:04:18\" level=\"SUCCESS\" source=\"HealthCheck\" message=\"Service 'payments-v2' responded in 45ms\" />\n                                <LogEntry time=\"22:05:02\" level=\"WARN\" source=\"Database\" message=\"Long running query detected on 'users' table (150ms)\" />\n                                <div className=\"text-blue-400 mt-2 flex items-center gap-2\">\n                                    <span className=\"animate-pulse\">_</span>\n                                </div>\n                            </div>\n                        </div>\n                    </motion.div>\n                )}\n            </AnimatePresence>\n        </div>\n    );\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Layout.jsx:chunk_4",
      "file_path": "frontend/src/components/Layout.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1120,
      "ingested_at": "2026-01-16T23:06:30.226222"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Layout.jsx_frontend/src/components/Layout.jsx:chunk_5_427aea28",
    "text": "const MetricItem = ({ icon: Icon, label, value, status }) => {\n    const statusColors = {\n        good: 'text-emerald-400',\n        warning: 'text-amber-400',\n        error: 'text-red-400'\n    };\n\n    return (\n        <div className=\"flex items-center justify-between p-2 rounded-lg bg-slate-800/40 border border-slate-700/50\">\n            <div className=\"flex items-center gap-2\">\n                <Icon size={14} className=\"text-slate-400\" />\n                <span className=\"text-xs text-slate-300 font-medium\">{label}</span>\n            </div>\n            <span className={`text-xs font-mono ${statusColors[status]}`}>{value}</span>\n        </div>\n    );\n}\n\nconst LogEntry = ({ time, level, source, message }) => {\n    const levelColors = {\n        INFO: 'text-blue-400',\n        SUCCESS: 'text-emerald-400',\n        WARN: 'text-amber-400',\n        ERROR: 'text-red-400'\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Layout.jsx:chunk_5",
      "file_path": "frontend/src/components/Layout.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 880,
      "ingested_at": "2026-01-16T23:06:30.226225"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Layout.jsx_frontend/src/components/Layout.jsx:chunk_6_2f1c6745",
    "text": "    return (\n        <div className=\"flex gap-3 mb-1 font-mono text-xs opacity-90 hover:opacity-100 transition-opacity\">\n            <span className=\"text-slate-600\">[{time}]</span>\n            <span className={`w-16 font-bold ${levelColors[level]}`}>{level}</span>\n            <span className=\"text-purple-400 w-24 truncate\">{source}</span>\n            <span className=\"text-slate-300\">{message}</span>\n        </div>\n    );\n}\n\nexport default Layout;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Layout.jsx:chunk_6",
      "file_path": "frontend/src/components/Layout.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 452,
      "ingested_at": "2026-01-16T23:06:30.226228"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_1_83fbaf9a",
    "text": "import React, { useState, useEffect } from 'react';\nimport { X, GitBranch, Package, ArrowRight, Loader2, Code2, Database } from 'lucide-react';\nimport api from '../services/api';\nimport { motion, AnimatePresence } from 'framer-motion';\n\nconst RepoInspectorModal = ({ isOpen, onClose, repoId, repoName }) => {\n    const [loading, setLoading] = useState(true);\n    const [graphData, setGraphData] = useState({ nodes: [], edges: [] });\n    const [chunks, setChunks] = useState([]);\n    const [activeTab, setActiveTab] = useState('graph');\n\n    useEffect(() => {\n        if (isOpen && repoId) {\n            loadInspectorData();\n        }\n    }, [isOpen, repoId]);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_1",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 659,
      "ingested_at": "2026-01-16T23:06:30.227658"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_2_7c6662fc",
    "text": "    const loadInspectorData = async () => {\n        setLoading(true);\n        try {\n            const [graphRes, chunksRes] = await Promise.all([\n                api.get(`/api/repos/${repoId}/graph`),\n                api.get(`/api/repos/${repoId}/chunks`)\n            ]);\n            setGraphData(graphRes.data);\n            setChunks(chunksRes.data.chunks || []);\n        } catch (e) {\n            console.error(\"Failed to load inspector data:\", e);\n            // Mock data for demo\n            setGraphData({\n                nodes: [\n                    { id: 'file_main', type: 'file', label: 'main.py' },\n                    { id: 'func_authenticate', type: 'function', label: 'authenticate()' },\n                    { id: 'func_validate', type: 'function', label: 'validate_token()' },\n                    { id: 'class_User', type: 'class', label: 'User' },\n                ],\n                edges: [\n                    { source: 'file_main', target: 'func_authenticate', type: 'CONTAINS' },\n                    { source: 'file_main', target: 'class_User', type: 'CONTAINS' },\n                    { source: 'func_authenticate', target: 'func_validate', type: 'CALLS' },\n                ]\n            });\n            setChunks([\n                { id: 1, content: 'def authenticate(user, password):\\n    token = generate_jwt(user)\\n    return token', file: 'auth/service.py', lines: '12-24' },\n                { id: 2, content: 'class User(BaseModel):\\n    id: int\\n    email: str\\n    role: str', file: 'models/user.py', lines: '1-15' },\n                { id: 3, content: 'def validate_token(token: str) -> bool:\\n    try:\\n        decode_jwt(token)\\n        return True\\n    except:\\n        return False', file: 'auth/service.py', lines: '26-35' },\n            ]);\n        } finally {\n            setLoading(false);\n        }\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_2",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1841,
      "ingested_at": "2026-01-16T23:06:30.227662"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_3_6e627ab5",
    "text": "    if (!isOpen) return null;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_3",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 29,
      "ingested_at": "2026-01-16T23:06:30.227665"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_4_ead43020",
    "text": "    return (\n        <AnimatePresence>\n            <motion.div\n                initial={{ opacity: 0 }}\n                animate={{ opacity: 1 }}\n                exit={{ opacity: 0 }}\n                className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4\"\n                onClick={onClose}\n            >\n                <motion.div\n                    initial={{ scale: 0.9, opacity: 0 }}\n                    animate={{ scale: 1, opacity: 1 }}\n                    exit={{ scale: 0.9, opacity: 0 }}\n                    className=\"bg-[#0B1120] border border-slate-700 rounded-2xl w-full max-w-6xl h-[80vh] overflow-hidden flex flex-col shadow-2xl\"\n                    onClick={(e) => e.stopPropagation()}\n                >\n                    {/* Header */}\n                    <div className=\"h-16 border-b border-slate-800 flex items-center justify-between px-6 bg-slate-900/50\">\n                        <div className=\"flex items-center gap-4\">\n                            <div className=\"p-2 bg-purple-900/30 rounded-lg border border-purple-500/30\">\n                                <GitBranch className=\"w-5 h-5 text-purple-400\" />\n                            </div>\n                            <div>\n                                <h2 className=\"text-lg font-bold text-white\">{repoName || 'Repository Inspector'}</h2>\n                                <p className=\"text-xs text-slate-500\">AST Graph & Vector Chunks</p>\n                            </div>\n                        </div>\n                        <div className=\"flex items-center gap-4\">\n                            {/* Tabs */}\n                            <div className=\"flex bg-slate-800 rounded-lg p-1\">\n                                <button\n                                    onClick={() => setActiveTab('graph')}\n                                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-colors ${activeTab === 'graph' ? 'bg-purple-600 text-white' : 'text-slate-400 hover:text-white'}`}\n                                >\n                                    <Code2 className=\"w-4 h-4 inline mr-2\" />\n                                    AST Graph\n                                </button>\n                                <button\n                                    onClick={() => setActiveTab('chunks')}\n                                    className={`px-4 py-1.5 rounded-md text-sm font-medium transition-colors ${activeTab === 'chunks' ? 'bg-purple-600 text-white' : 'text-slate-400 hover:text-white'}`}\n                                >\n                                    <Database className=\"w-4 h-4 inline mr-2\" />\n                                    Vector Chunks\n                                </button>\n                            </div>\n                            <button onClick={onClose} className=\"p-2 text-slate-400 hover:text-white hover:bg-slate-800 rounded-lg transition-colors\">\n                                <X className=\"w-5 h-5\" />\n                            </button>\n                        </div>\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_4",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 3092,
      "ingested_at": "2026-01-16T23:06:30.227669"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_5_61ffad63",
    "text": "                    {/* Content */}\n                    <div className=\"flex-1 overflow-hidden\">\n                        {loading ? (\n                            <div className=\"h-full flex items-center justify-center\">\n                                <Loader2 className=\"w-8 h-8 text-purple-500 animate-spin\" />\n                            </div>\n                        ) : activeTab === 'graph' ? (\n                            /* AST Graph View */\n                            <div className=\"h-full p-6 overflow-auto custom-scrollbar\">\n                                <div className=\"grid grid-cols-2 gap-6 h-full\">\n                                    {/* Nodes */}\n                                    <div className=\"bg-slate-900/50 border border-slate-800 rounded-xl p-4\">\n                                        <h3 className=\"text-sm font-bold text-slate-300 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                            <Package className=\"w-4 h-4 text-blue-400\" />\n                                            Nodes ({graphData.nodes.length})\n                                        </h3>\n                                        <div className=\"space-y-2 max-h-[60vh] overflow-y-auto custom-scrollbar\">\n                                            {graphData.nodes.map((node, idx) => (\n                                                <div key={idx} className=\"flex items-center gap-3 p-3 bg-slate-800/50 rounded-lg border border-slate-700/50 hover:border-slate-600 transition-colors\">\n                                                    <div className={`w-2 h-2 rounded-full ${node.type === 'file' ? 'bg-yellow-500' :\n                                                            node.type === 'function' ? 'bg-blue-500' :\n                                                                node.type === 'class' ? 'bg-purple-500' : 'bg-slate-500'\n                                                        }`} />\n                                                    <span className=\"text-xs font-mono text-slate-300 flex-1\">{node.label}</span>\n                                                    <span className=\"text-[10px] bg-slate-700 text-slate-400 px-2 py-0.5 rounded uppercase\">{node.type}</span>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_5",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2431,
      "ingested_at": "2026-01-16T23:06:30.227672"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_6_60bb381f",
    "text": "                                    {/* Edges */}\n                                    <div className=\"bg-slate-900/50 border border-slate-800 rounded-xl p-4\">\n                                        <h3 className=\"text-sm font-bold text-slate-300 uppercase tracking-wider mb-4 flex items-center gap-2\">\n                                            <ArrowRight className=\"w-4 h-4 text-green-400\" />\n                                            Edges ({graphData.edges.length})\n                                        </h3>\n                                        <div className=\"space-y-2 max-h-[60vh] overflow-y-auto custom-scrollbar\">\n                                            {graphData.edges.map((edge, idx) => (\n                                                <div key={idx} className=\"flex items-center gap-2 p-3 bg-slate-800/50 rounded-lg border border-slate-700/50\">\n                                                    <span className=\"text-xs font-mono text-slate-400 truncate flex-1\">{edge.source}</span>\n                                                    <span className=\"text-[10px] bg-green-900/30 text-green-400 px-2 py-0.5 rounded border border-green-900/50\">{edge.type}</span>\n                                                    <ArrowRight className=\"w-3 h-3 text-slate-600\" />\n                                                    <span className=\"text-xs font-mono text-slate-400 truncate flex-1\">{edge.target}</span>\n                                                </div>\n                                            ))}\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        ) : (\n                            /* Vector Chunks View */\n                            <div className=\"h-full p-6 overflow-auto custom-scrollbar\">\n                                <div className=\"space-y-4\">\n                                    {chunks.map((chunk, idx) => (\n                                        <div key={idx} className=\"bg-slate-900/50 border border-slate-800 rounded-xl overflow-hidden\">\n                                            <div className=\"px-4 py-2 bg-slate-800/50 border-b border-slate-700 flex items-center justify-between\">\n                                                <div className=\"flex items-center gap-2\">\n                                                    <Code2 className=\"w-4 h-4 text-blue-400\" />\n                                                    <span className=\"text-sm font-medium text-slate-200\">{chunk.file}</span>\n                                                    <span className=\"text-xs text-slate-500\">L{chunk.lines}</span>\n                                                </div>\n                                                <span className=\"text-[10px] bg-blue-900/30 text-blue-400 px-2 py-0.5 rounded border border-blue-900/50\">\n                                                    Chunk #{chunk.id}\n                                                </span>\n                                            </div>\n                                            <pre className=\"p-4 text-xs font-mono text-slate-300 overflow-x-auto\">\n                                                <code>{chunk.content}</code>\n                                            </pre>\n                                        </div>\n                                    ))}\n                                </div>\n                            </div>\n                        )}\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_6",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 3551,
      "ingested_at": "2026-01-16T23:06:30.227675"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/RepoInspectorModal.jsx_frontend/src/components/RepoInspectorModal.jsx:chunk_7_918d5944",
    "text": "                    {/* Footer Stats */}\n                    <div className=\"h-12 border-t border-slate-800 flex items-center justify-between px-6 bg-slate-900/30 text-xs text-slate-500\">\n                        <div className=\"flex items-center gap-6\">\n                            <span><strong className=\"text-slate-300\">{graphData.nodes.length}</strong> Nodes</span>\n                            <span><strong className=\"text-slate-300\">{graphData.edges.length}</strong> Edges</span>\n                            <span><strong className=\"text-slate-300\">{chunks.length}</strong> Chunks</span>\n                        </div>\n                        <span>Repo ID: <code className=\"text-slate-400\">{repoId}</code></span>\n                    </div>\n                </motion.div>\n            </motion.div>\n        </AnimatePresence>\n    );\n};\n\nexport default RepoInspectorModal;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/RepoInspectorModal.jsx:chunk_7",
      "file_path": "frontend/src/components/RepoInspectorModal.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 876,
      "ingested_at": "2026-01-16T23:06:30.227679"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ThinkingStep.jsx_frontend/src/components/ThinkingStep.jsx:chunk_1_eff475c6",
    "text": "import React from 'react';\nimport { CheckCircle, XOctagon } from 'lucide-react';\n\nconst ThinkingStep = ({ text, state }) => (\n    <div className=\"flex items-center space-x-3 text-xs py-1\">\n        <div className=\"w-4 flex justify-center\">\n            {state === 'done' && <CheckCircle className=\"w-3.5 h-3.5 text-green-500\" />}\n            {state === 'error' && <XOctagon className=\"w-3.5 h-3.5 text-red-500\" />}\n            {state === 'processing' && <div className=\"w-2.5 h-2.5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\"></div>}\n            {state === 'waiting' && <div className=\"w-1.5 h-1.5 bg-slate-700 rounded-full\"></div>}\n        </div>\n        <span className={`${state === 'done' ? 'text-slate-400' :\n                state === 'error' ? 'text-red-400' :\n                    state === 'processing' ? 'text-blue-400 font-medium' :\n                        'text-slate-600'\n            }`}>\n            {text}\n        </span>\n    </div>\n);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ThinkingStep.jsx:chunk_1",
      "file_path": "frontend/src/components/ThinkingStep.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 975,
      "ingested_at": "2026-01-16T23:06:30.228652"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ThinkingStep.jsx_frontend/src/components/ThinkingStep.jsx:chunk_2_36cd9b65",
    "text": "export default ThinkingStep;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ThinkingStep.jsx:chunk_2",
      "file_path": "frontend/src/components/ThinkingStep.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 29,
      "ingested_at": "2026-01-16T23:06:30.228656"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/IAMBadge.jsx_frontend/src/components/IAMBadge.jsx:chunk_1_65233970",
    "text": "import React from 'react';\nimport { Shield } from 'lucide-react';\n\nexport const IAMBadge = ({ role, permissions }) => (\n  <div className=\"flex items-center gap-2 text-xs font-medium bg-stone-100 p-2.5 rounded-xl text-stone-500\">\n    <Shield size={14} className=\"text-violet-500\" />\n    <span className=\"text-stone-400\">Role:</span>\n    <span className=\"text-violet-600\">{role?.replace(/_/g, ' ')}</span>\n    <span className=\"text-stone-300\">\u2022</span>\n    <span className=\"text-stone-400\">{permissions?.length || 0} permissions</span>\n  </div>\n);\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/IAMBadge.jsx:chunk_1",
      "file_path": "frontend/src/components/IAMBadge.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 545,
      "ingested_at": "2026-01-16T23:06:30.229445"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DashboardWidget.jsx_frontend/src/components/DashboardWidget.jsx:chunk_1_698322ba",
    "text": "import React from 'react';\nimport { TrendingUp, TrendingDown } from 'lucide-react';\n\nexport const DashboardWidget = ({ title, value, trend, icon: Icon, color }) => {\n  const isPositive = trend.startsWith('+') || trend === '0';",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DashboardWidget.jsx:chunk_1",
      "file_path": "frontend/src/components/DashboardWidget.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 226,
      "ingested_at": "2026-01-16T23:06:30.230123"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DashboardWidget.jsx_frontend/src/components/DashboardWidget.jsx:chunk_2_490dfd9c",
    "text": "  return (\n    <div className=\"bg-white p-6 rounded-2xl shadow-soft hover:shadow-soft-lg transition-all\">\n      <div className=\"flex justify-between items-start\">\n        <div>\n          <p className=\"text-sm font-medium text-stone-400\">{title}</p>\n          <h3 className=\"text-3xl font-bold text-stone-800 mt-1\">{value}</h3>\n        </div>\n        <div className={`p-3 rounded-xl ${color} shadow-lg`}>\n          <Icon size={20} className=\"text-white\" />\n        </div>\n      </div>\n      <div className=\"mt-4 flex items-center gap-2 text-sm\">\n        <div className={`flex items-center gap-1 px-2.5 py-1 rounded-lg ${isPositive ? 'bg-emerald-50 text-emerald-600' : 'bg-red-50 text-red-600'\n          }`}>\n          {isPositive ? <TrendingUp size={14} /> : <TrendingDown size={14} />}\n          <span className=\"font-medium\">{trend}</span>\n        </div>\n        <span className=\"text-stone-400\">vs last month</span>\n      </div>\n    </div>\n  );\n};\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DashboardWidget.jsx:chunk_2",
      "file_path": "frontend/src/components/DashboardWidget.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 950,
      "ingested_at": "2026-01-16T23:06:30.230126"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ActionCard.jsx_frontend/src/components/ActionCard.jsx:chunk_1_7921035b",
    "text": "import React from 'react';\nimport { Shield, Unlock, Lock } from 'lucide-react';",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ActionCard.jsx:chunk_1",
      "file_path": "frontend/src/components/ActionCard.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 79,
      "ingested_at": "2026-01-16T23:06:30.230953"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ActionCard.jsx_frontend/src/components/ActionCard.jsx:chunk_2_cb364644",
    "text": "const ActionCard = ({ system, payload, status, iamReason, result }) => (\n    <div className=\"mt-4 mb-2 bg-slate-900 border border-slate-700 rounded-lg overflow-hidden shadow-lg shadow-black/20\">\n        <div className=\"bg-slate-800/50 px-4 py-2 flex items-center justify-between border-b border-slate-700\">\n            <div className=\"flex items-center space-x-2\">\n                {system === 'JIRA' && <div className=\"w-2 h-2 rounded-full bg-blue-500\"></div>}\n                {system === 'GITHUB' && <div className=\"w-2 h-2 rounded-full bg-purple-500\"></div>}\n                {system === 'CALENDAR' && <div className=\"w-2 h-2 rounded-full bg-orange-500\"></div>}\n                {system === 'KUBERNETES' && <div className=\"w-2 h-2 rounded-full bg-blue-400\"></div>}\n                <span className=\"text-xs font-bold text-slate-300 tracking-wide uppercase\">{system} Integration</span>\n            </div>\n            <div className={`flex items-center px-2 py-0.5 rounded text-[10px] font-bold uppercase tracking-wider ${status === 'AUTHORIZED' || status === 'EXECUTED' ? 'bg-green-900/30 text-green-400 border border-green-800' : 'bg-red-900/30 text-red-400 border border-red-800'\n                }`}>\n                {(status === 'AUTHORIZED' || status === 'EXECUTED') ? <Unlock className=\"w-3 h-3 mr-1\" /> : <Lock className=\"w-3 h-3 mr-1\" />}\n                {status}\n            </div>\n        </div>\n        <div className=\"p-4 bg-slate-950/50 font-mono text-xs\">\n            <div className=\"flex justify-between items-start mb-2\">\n                <span className=\"text-slate-500\">// Proposed Action Payload</span>\n            </div>\n            <pre className=\"text-slate-300 overflow-x-auto p-2 rounded bg-black/20 border border-white/5\">\n                {JSON.stringify(payload, null, 2)}\n            </pre>\n            {/* Show Result if available */}\n            {status === 'EXECUTED' && (\n                <div className=\"mt-4 pt-4 border-t border-slate-800/50\">\n                    <div className=\"flex justify-between items-start mb-2\">\n                        <span className=\"text-slate-500\">// Execution Result</span>\n                    </div>\n                    <div className=\"text-emerald-400 p-2 rounded bg-emerald-950/20 border border-emerald-900/30 whitespace-pre-wrap font-mono text-[10px]\">\n                        {typeof result === 'string' ? result : JSON.stringify(result, null, 2)}\n                    </div>\n                </div>\n            )}\n        </div>\n        <div className=\"px-4 py-3 bg-slate-800/30 border-t border-slate-700 flex items-center justify-between\">\n            <div className=\"flex items-center space-x-2\">\n                <Shield className={`w-4 h-4 ${(status === 'AUTHORIZED' || status === 'EXECUTED') ? 'text-green-500' : 'text-red-500'}`} />\n                <span className=\"text-xs text-slate-400\">\n                    IAM Check: <span className={(status === 'AUTHORIZED' || status === 'EXECUTED') ? 'text-green-400' : 'text-red-400'}>{iamReason || 'Authorized'}</span>\n                </span>\n            </div>\n            {status === 'AUTHORIZED' ? (\n                <button className=\"px-3 py-1 bg-blue-600 hover:bg-blue-500 text-white text-xs font-medium rounded transition-colors shadow-lg shadow-blue-900/20\">\n                    Execute Action\n                </button>\n            ) : (\n                <button disabled className=\"px-3 py-1 bg-slate-700 text-slate-500 text-xs font-medium rounded cursor-not-allowed opacity-50\">\n                    Elevation Required\n                </button>\n            )}\n        </div>\n    </div>\n);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ActionCard.jsx:chunk_2",
      "file_path": "frontend/src/components/ActionCard.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 3605,
      "ingested_at": "2026-01-16T23:06:30.230957"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ActionCard.jsx_frontend/src/components/ActionCard.jsx:chunk_3_042fa722",
    "text": "export default ActionCard;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ActionCard.jsx:chunk_3",
      "file_path": "frontend/src/components/ActionCard.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 27,
      "ingested_at": "2026-01-16T23:06:30.230961"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_1_a2e0f015",
    "text": "import React, { useState, useEffect } from 'react';\nimport { MessageSquare, Plus, Trash2, Clock, ChevronRight } from 'lucide-react';\nimport api from '../services/api';\nimport { motion, AnimatePresence } from 'framer-motion';\n\nconst ConversationSidebar = ({\n    currentConversationId,\n    onSelectConversation,\n    onNewChat,\n    iamRole = 'senior_engineer'\n}) => {\n    const [conversations, setConversations] = useState([]);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        loadConversations();\n    }, []);\n\n    const loadConversations = async () => {\n        try {\n            const convos = await api.conversationAPI.list(iamRole);\n            setConversations(convos || []);\n        } catch (e) {\n            console.error(\"Failed to load conversations:\", e);\n        } finally {\n            setLoading(false);\n        }\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_1",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 862,
      "ingested_at": "2026-01-16T23:06:30.232063"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_2_56f1f69c",
    "text": "    const handleNewChat = async () => {\n        try {\n            const newConvo = await api.conversationAPI.create(iamRole);\n            setConversations(prev => [newConvo, ...prev]);\n            onNewChat(newConvo.id);\n        } catch (e) {\n            console.error(\"Failed to create conversation:\", e);\n        }\n    };\n\n    const handleDelete = async (e, convoId) => {\n        e.stopPropagation();\n        try {\n            await api.conversationAPI.delete(convoId, iamRole);\n            setConversations(prev => prev.filter(c => c.id !== convoId));\n            if (currentConversationId === convoId) {\n                onNewChat(null);\n            }\n        } catch (e) {\n            console.error(\"Failed to delete conversation:\", e);\n        }\n    };\n\n    const formatDate = (dateStr) => {\n        if (!dateStr) return '';\n        const date = new Date(dateStr);\n        const now = new Date();\n        const diff = now - date;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_2",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 934,
      "ingested_at": "2026-01-16T23:06:30.232067"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_3_bf8b668a",
    "text": "        if (diff < 60000) return 'Just now';\n        if (diff < 3600000) return `${Math.floor(diff / 60000)}m ago`;\n        if (diff < 86400000) return `${Math.floor(diff / 3600000)}h ago`;\n        return date.toLocaleDateString();\n    };\n\n    return (\n        <div className=\"h-full flex flex-col bg-[#0B1120] border-r border-slate-800/50\">\n            {/* Header */}\n            <div className=\"p-4 border-b border-slate-800/50\">\n                <button\n                    onClick={handleNewChat}\n                    className=\"w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-500 text-white rounded-xl font-medium transition-all shadow-lg shadow-blue-900/30 hover:shadow-blue-900/50\"\n                >\n                    <Plus size={18} />\n                    <span>New Chat</span>\n                </button>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_3",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 864,
      "ingested_at": "2026-01-16T23:06:30.232070"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_4_a407b17f",
    "text": "            {/* Conversation List */}\n            <div className=\"flex-1 overflow-y-auto custom-scrollbar p-2 space-y-1\">\n                {loading && (\n                    <div className=\"p-4 text-center text-slate-500 text-sm\">\n                        Loading conversations...\n                    </div>\n                )}\n\n                {!loading && conversations.length === 0 && (\n                    <div className=\"p-4 text-center text-slate-500 text-sm\">\n                        <MessageSquare className=\"w-8 h-8 mx-auto mb-2 opacity-30\" />\n                        No conversations yet\n                    </div>\n                )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_4",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 639,
      "ingested_at": "2026-01-16T23:06:30.232074"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_5_06c6a979",
    "text": "                <AnimatePresence>\n                    {conversations.map((convo) => (\n                        <motion.button\n                            key={convo.id}\n                            initial={{ opacity: 0, x: -20 }}\n                            animate={{ opacity: 1, x: 0 }}\n                            exit={{ opacity: 0, x: -20 }}\n                            onClick={() => onSelectConversation(convo.id)}\n                            className={`\n                                w-full flex items-start gap-3 p-3 rounded-lg text-left transition-all group\n                                ${currentConversationId === convo.id\n                                    ? 'bg-blue-600/10 border border-blue-500/20 text-white'\n                                    : 'hover:bg-slate-800/50 text-slate-400 hover:text-white border border-transparent'}\n                            `}\n                        >\n                            <MessageSquare size={16} className=\"mt-0.5 flex-shrink-0\" />\n                            <div className=\"flex-1 min-w-0\">\n                                <p className=\"text-sm font-medium truncate\">\n                                    {convo.title || 'New conversation'}\n                                </p>\n                                <div className=\"flex items-center gap-2 mt-1\">\n                                    <Clock size={10} className=\"text-slate-600\" />\n                                    <span className=\"text-[10px] text-slate-600\">\n                                        {formatDate(convo.updated_at || convo.created_at)}\n                                    </span>\n                                </div>\n                            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_5",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1697,
      "ingested_at": "2026-01-16T23:06:30.232077"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_6_7fce4c4e",
    "text": "                            {currentConversationId === convo.id ? (\n                                <ChevronRight size={14} className=\"text-blue-400 mt-0.5\" />\n                            ) : (\n                                <button\n                                    onClick={(e) => handleDelete(e, convo.id)}\n                                    className=\"p-1 text-slate-600 hover:text-red-400 hover:bg-red-900/20 rounded opacity-0 group-hover:opacity-100 transition-all\"\n                                >\n                                    <Trash2 size={12} />\n                                </button>\n                            )}\n                        </motion.button>\n                    ))}\n                </AnimatePresence>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_6",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 758,
      "ingested_at": "2026-01-16T23:06:30.232081"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ConversationSidebar.jsx_frontend/src/components/ConversationSidebar.jsx:chunk_7_24de14fd",
    "text": "            {/* Footer */}\n            <div className=\"p-3 border-t border-slate-800/50 text-center\">\n                <span className=\"text-[10px] text-slate-600\">\n                    {conversations.length} conversation{conversations.length !== 1 ? 's' : ''}\n                </span>\n            </div>\n        </div>\n    );\n};\n\nexport default ConversationSidebar;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ConversationSidebar.jsx:chunk_7",
      "file_path": "frontend/src/components/ConversationSidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 364,
      "ingested_at": "2026-01-16T23:06:30.232084"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_1_b90b164b",
    "text": "import React from 'react';\nimport { Shield, Trello, Code, Activity, Calendar, Bot, User } from 'lucide-react';\n\nexport const ChatMessage = ({ msg }) => {\n  const isUser = msg.type === 'user';\n\n  return (\n    <div className={`flex gap-3 ${isUser ? 'flex-row-reverse' : ''} animate-slide-up`}>\n      {/* Avatar */}\n      <div className={`w-9 h-9 rounded-xl shrink-0 flex items-center justify-center shadow-soft ${isUser\n          ? 'bg-gradient-to-br from-violet-500 to-indigo-600'\n          : msg.isError\n            ? 'bg-red-100 text-red-500'\n            : 'bg-white border border-stone-200'\n        }`}>\n        {isUser ? (\n          <User size={16} className=\"text-white\" />\n        ) : msg.isError ? (\n          <span>\u26a0\ufe0f</span>\n        ) : (\n          <Bot size={16} className=\"text-violet-500\" />\n        )}\n      </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_1",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 825,
      "ingested_at": "2026-01-16T23:06:30.233097"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_2_7a19d7ec",
    "text": "      {/* Message */}\n      <div className={`flex flex-col max-w-[85%] ${isUser ? 'items-end' : 'items-start'}`}>\n        <div className={`px-4 py-3 rounded-2xl text-sm leading-relaxed ${isUser\n            ? 'bg-gradient-to-r from-violet-500 to-indigo-600 text-white rounded-tr-md'\n            : msg.isError\n              ? 'bg-red-50 text-red-700 border border-red-200 rounded-tl-md'\n              : 'bg-white text-stone-700 shadow-soft rounded-tl-md'\n          }`}>\n          {msg.content}\n        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_2",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 506,
      "ingested_at": "2026-01-16T23:06:30.233101"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_3_9c08150e",
    "text": "        {/* Rich Attachments */}\n        {!isUser && msg.attachment && (\n          <div className=\"mt-3 w-full\">\n            {msg.attachment.type === 'TICKET' && (\n              <div className=\"bg-white border-l-4 border-orange-400 rounded-xl p-4 shadow-soft\">\n                <div className=\"flex justify-between items-center mb-2\">\n                  <span className=\"font-semibold flex items-center gap-2 text-stone-700 text-sm\">\n                    <Trello size={16} className=\"text-orange-500\" />\n                    {msg.attachment.data.ticket_id || 'TICKET'}\n                  </span>\n                  <span className=\"bg-orange-100 text-orange-600 px-2 py-1 rounded-lg text-xs font-medium\">\n                    {msg.attachment.data.status || 'TO DO'}\n                  </span>\n                </div>\n                <p className=\"text-stone-600 text-sm mb-2\">{msg.attachment.data.title}</p>\n                <div className=\"flex gap-4 text-xs text-stone-400\">\n                  <span>Assignee: {msg.attachment.data.assignee}</span>\n                  <span>Priority: {msg.attachment.data.priority}</span>\n                </div>\n              </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_3",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1169,
      "ingested_at": "2026-01-16T23:06:30.233104"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_4_11003985",
    "text": "            {msg.attachment.type === 'CODE' && (\n              <div className=\"bg-stone-800 text-stone-200 rounded-xl p-4 text-sm font-mono overflow-x-auto\">\n                <div className=\"flex justify-between items-center mb-3 border-b border-stone-700 pb-2\">\n                  <span className=\"flex items-center gap-2 text-violet-400\">\n                    <Code size={14} />\n                    {msg.attachment.data.file}\n                  </span>\n                  <span className=\"text-xs text-stone-500\">Lines {msg.attachment.data.lines || '??'}</span>\n                </div>\n                <pre className=\"whitespace-pre-wrap text-xs\">{msg.attachment.data.snippet}</pre>\n              </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_4",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 714,
      "ingested_at": "2026-01-16T23:06:30.233107"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_5_65e37018",
    "text": "            {msg.attachment.type === 'GANTT' && (\n              <div className=\"bg-white rounded-xl p-4 shadow-soft\">\n                <div className=\"flex items-center gap-2 mb-4 font-semibold text-stone-700 text-sm\">\n                  <Activity size={16} className=\"text-blue-500\" />\n                  Project Roadmap\n                </div>\n                <div className=\"space-y-2\">\n                  {msg.attachment.data.tasks?.map((task, i) => (\n                    <div key={i} className=\"relative h-8 bg-stone-100 rounded-lg overflow-hidden\">\n                      <div\n                        className=\"absolute h-full bg-gradient-to-r from-violet-400 to-indigo-500 flex items-center pl-3 text-white text-xs font-medium rounded-lg\"\n                        style={{ width: `${task.progress}%` }}\n                      >\n                        {task.name}\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_5",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1000,
      "ingested_at": "2026-01-16T23:06:30.233110"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_6_d633dd0f",
    "text": "            {msg.attachment.type === 'CALENDAR' && (\n              <div className=\"bg-white rounded-xl p-4 shadow-soft\">\n                <div className=\"flex items-center gap-2 mb-3 font-semibold text-stone-700 text-sm\">\n                  <Calendar size={16} className=\"text-emerald-500\" />\n                  Available Times\n                </div>\n                <div className=\"flex gap-2\">\n                  {msg.attachment.data.slots?.map((slot, i) => (\n                    <button key={i} className=\"flex-1 py-3 px-4 bg-emerald-50 text-emerald-700 border border-emerald-200 rounded-xl text-center hover:bg-emerald-100 transition-colors text-sm font-medium\">\n                      {slot}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            )}\n          </div>\n        )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_6",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 830,
      "ingested_at": "2026-01-16T23:06:30.233114"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/ChatMessage.jsx_frontend/src/components/ChatMessage.jsx:chunk_7_692d0f5c",
    "text": "        {/* Sources */}\n        {!isUser && msg.sources && msg.sources.length > 0 && (\n          <div className=\"mt-3 flex flex-wrap gap-2\">\n            {msg.sources.slice(0, 3).map((source, i) => (\n              <span key={i} className=\"px-3 py-1.5 bg-violet-50 text-violet-600 rounded-lg text-xs font-medium\">\n                \ud83d\udcc4 {source.document} (p.{source.page})\n              </span>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/ChatMessage.jsx:chunk_7",
      "file_path": "frontend/src/components/ChatMessage.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 464,
      "ingested_at": "2026-01-16T23:06:30.233123"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_1_a131fc06",
    "text": "import React, { useState } from 'react';\nimport { NavLink } from 'react-router-dom';\nimport {\n    MessageSquare,\n    FileText,\n    GitBranch,\n    Blocks,\n    Shield,\n    Activity,\n    Settings,\n    LogOut,\n    ChevronRight,\n    Menu,\n    X\n} from 'lucide-react';\nimport { motion, AnimatePresence } from 'framer-motion';\n\nconst Sidebar = ({ isLiveOpsOpen, setIsLiveOpsOpen }) => {\n    const [isMobileOpen, setIsMobileOpen] = useState(false);\n\n    const navItems = [\n        { icon: MessageSquare, label: 'Copilot Chat', path: '/chat' },\n        { icon: FileText, label: 'Documents', path: '/documents' },\n        { icon: GitBranch, label: 'Repositories', path: '/repos' },\n        { icon: Blocks, label: 'Integrations', path: '/integrations' },\n        { icon: Shield, label: 'IAM Config', path: '/iam' },\n    ];",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_1",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 811,
      "ingested_at": "2026-01-16T23:06:30.234129"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_2_7ed82f04",
    "text": "    return (\n        <>\n            {/* Mobile Toggle */}\n            <div className=\"lg:hidden fixed top-4 left-4 z-50\">\n                <button\n                    onClick={() => setIsMobileOpen(!isMobileOpen)}\n                    className=\"p-2 bg-slate-800 rounded-lg text-white border border-slate-700\"\n                >\n                    {isMobileOpen ? <X size={20} /> : <Menu size={20} />}\n                </button>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_2",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 444,
      "ingested_at": "2026-01-16T23:06:30.234132"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_3_97a31459",
    "text": "            {/* Sidebar */}\n            <aside className={`\n        fixed inset-y-0 left-0 z-40 w-64 bg-[#0B1120] border-r border-slate-800/50 \n        transition-transform duration-300 transform \n        ${isMobileOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n      `}>\n                <div className=\"flex flex-col h-full\">\n                    {/* Logo */}\n                    <div className=\"p-6 border-b border-slate-800/50\">\n                        <div className=\"flex items-center gap-3\">\n                            <div className=\"w-8 h-8 rounded-lg bg-gradient-to-tr from-blue-600 to-sky-400 flex items-center justify-center shadow-lg shadow-blue-500/20\">\n                                <Shield className=\"text-white\" size={18} fill=\"currentColor\" />\n                            </div>\n                            <div>\n                                <h1 className=\"text-lg font-bold text-white tracking-tight leading-none\">Nexus</h1>\n                                <span className=\"text-[10px] font-bold text-blue-400 tracking-widest uppercase\">Enterprise</span>\n                            </div>\n                        </div>\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_3",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1186,
      "ingested_at": "2026-01-16T23:06:30.234136"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_4_12e26212",
    "text": "                    {/* Navigation */}\n                    <nav className=\"flex-1 p-4 space-y-1 overflow-y-auto custom-scrollbar\">\n                        {navItems.map((item) => (\n                            <NavLink\n                                key={item.path}\n                                to={item.path}\n                                className={({ isActive }) => `\n                  flex items-center gap-3 px-4 py-3 rounded-xl transition-all duration-200 group relative\n                  ${isActive\n                                        ? 'bg-blue-600/10 text-blue-400 ring-1 ring-blue-500/20 shadow-[0_0_15px_rgba(59,130,246,0.1)]'\n                                        : 'text-slate-400 hover:text-white hover:bg-slate-800/50'}\n                `}\n                            >\n                                {({ isActive }) => (\n                                    <>\n                                        <item.icon size={20} className={`transition-colors ${isActive ? 'text-blue-400' : 'group-hover:text-white'}`} />\n                                        <span className=\"font-medium text-sm\">{item.label}</span>\n                                        {isActive && (\n                                            <motion.div\n                                                layoutId=\"activeIndicator\"\n                                                className=\"absolute right-2 w-1.5 h-1.5 rounded-full bg-blue-400 shadow-[0_0_8px_rgba(56,189,248,0.8)]\"\n                                            />\n                                        )}\n                                    </>\n                                )}\n                            </NavLink>\n                        ))}\n                    </nav>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_4",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1734,
      "ingested_at": "2026-01-16T23:06:30.234139"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_5_1eb3eb9c",
    "text": "                    {/* Live Ops Console */}\n                    <div className=\"p-4 border-t border-slate-800/50\">\n                        <NavLink\n                            to=\"/live-console\"\n                            className={({ isActive }) => `\n                                w-full flex items-center justify-between p-4 rounded-xl border transition-all duration-300 group\n                                ${isActive\n                                    ? 'bg-slate-800/80 border-green-500/30 shadow-[0_0_20px_rgba(15,23,42,0.5)]'\n                                    : 'bg-slate-900/50 border-slate-800 hover:border-slate-700'}\n                            `}\n                        >\n                            <div className=\"flex items-center gap-3\">\n                                <Activity size={18} className=\"text-green-500 group-hover:animate-pulse\" />\n                                <span className=\"text-sm font-semibold text-white\">\n                                    Live Ops Console\n                                </span>\n                            </div>\n                            <ChevronRight\n                                size={16}\n                                className=\"text-slate-600 group-hover:text-green-500 transition-colors\"\n                            />\n                        </NavLink>\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_5",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1364,
      "ingested_at": "2026-01-16T23:06:30.234142"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_6_1aeadd29",
    "text": "                    {/* User Profile */}\n                    <div className=\"p-4 bg-slate-900/30\">\n                        <div className=\"flex items-center gap-3 p-2 rounded-lg hover:bg-slate-800/50 cursor-pointer transition-colors\">\n                            <div className=\"w-9 h-9 rounded-lg bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center text-white font-bold text-sm shadow-md\">\n                                JD\n                            </div>\n                            <div className=\"flex-1 min-w-0\">\n                                <div className=\"text-sm font-medium text-white truncate\">John Doe</div>\n                                <div className=\"flex items-center gap-1.5 text-xs text-blue-400\">\n                                    <Shield size={10} fill=\"currentColor\" />\n                                    <span>Level 3 Eng</span>\n                                </div>\n                            </div>\n                            <Settings size={16} className=\"text-slate-500 hover:text-white transition-colors\" />\n                        </div>\n                    </div>\n                </div>\n            </aside>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_6",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1179,
      "ingested_at": "2026-01-16T23:06:30.234145"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/Sidebar.jsx_frontend/src/components/Sidebar.jsx:chunk_7_d3e2ed04",
    "text": "            {/* Overlay for mobile */}\n            {isMobileOpen && (\n                <div\n                    className=\"fixed inset-0 bg-black/50 z-30 lg:hidden backdrop-blur-sm\"\n                    onClick={() => setIsMobileOpen(false)}\n                />\n            )}\n        </>\n    );\n};\n\nexport default Sidebar;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/Sidebar.jsx:chunk_7",
      "file_path": "frontend/src/components/Sidebar.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 321,
      "ingested_at": "2026-01-16T23:06:30.234149"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_1_82fb965e",
    "text": "import React, { useState, useEffect, useCallback } from 'react';\nimport { Upload, FileText, Trash2, CheckCircle, XCircle, Loader2, FolderOpen } from 'lucide-react';\nimport { documentAPI } from '../services/api';\n\nexport const DocumentsPanel = ({ activePersona }) => {\n    const [documents, setDocuments] = useState([]);\n    const [uploading, setUploading] = useState(false);\n    const [isDragging, setIsDragging] = useState(false);\n    const [error, setError] = useState(null);\n\n    const loadDocuments = useCallback(async () => {\n        try {\n            const docs = await documentAPI.list(activePersona.role);\n            setDocuments(docs);\n        } catch (e) {\n            console.error('Failed to load documents:', e);\n        }\n    }, [activePersona.role]);\n\n    useEffect(() => {\n        loadDocuments();\n    }, [loadDocuments]);\n\n    const handleUpload = async (files) => {\n        setUploading(true);\n        setError(null);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_1",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 936,
      "ingested_at": "2026-01-16T23:06:30.235416"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_2_f05c3f2b",
    "text": "        for (const file of files) {\n            if (!file.name.toLowerCase().endsWith('.pdf')) {\n                setError('Only PDF files are supported');\n                continue;\n            }\n\n            try {\n                await documentAPI.upload(file, activePersona.role);\n            } catch (e) {\n                setError(`Failed to upload ${file.name}`);\n                console.error('Upload error:', e);\n            }\n        }\n\n        setUploading(false);\n        loadDocuments();\n    };\n\n    const handleDelete = async (docId) => {\n        if (!confirm('Are you sure you want to delete this document?')) return;\n\n        try {\n            await documentAPI.delete(docId, activePersona.role);\n            loadDocuments();\n        } catch (e) {\n            setError('Failed to delete document');\n        }\n    };\n\n    const handleDragOver = (e) => {\n        e.preventDefault();\n        setIsDragging(true);\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_2",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 928,
      "ingested_at": "2026-01-16T23:06:30.235420"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_3_47b4952b",
    "text": "    const handleDragLeave = (e) => {\n        e.preventDefault();\n        setIsDragging(false);\n    };\n\n    const handleDrop = (e) => {\n        e.preventDefault();\n        setIsDragging(false);\n\n        const files = Array.from(e.dataTransfer.files).filter(f => f.name.toLowerCase().endsWith('.pdf'));\n        if (files.length > 0) {\n            handleUpload(files);\n        }\n    };\n\n    const handleFileSelect = (e) => {\n        const files = Array.from(e.target.files);\n        if (files.length > 0) {\n            handleUpload(files);\n        }\n    };\n\n    const formatFileSize = (bytes) => {\n        if (bytes < 1024) return bytes + ' B';\n        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';\n        return (bytes / (1024 * 1024)).toFixed(1) + ' MB';\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_3",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 782,
      "ingested_at": "2026-01-16T23:06:30.235424"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_4_921034c0",
    "text": "    const formatDate = (dateStr) => {\n        return new Date(dateStr).toLocaleDateString('en-US', {\n            month: 'short',\n            day: 'numeric',\n            hour: '2-digit',\n            minute: '2-digit'\n        });\n    };\n\n    return (\n        <div className=\"flex-1 overflow-y-auto p-6 bg-stone-50\">\n            <h1 className=\"text-2xl font-bold text-stone-800 mb-6\">Documents</h1>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_4",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 395,
      "ingested_at": "2026-01-16T23:06:30.235427"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_5_4c2f1d8d",
    "text": "            {/* Upload Zone */}\n            <div\n                className={`border-2 border-dashed rounded-2xl p-8 text-center transition-all mb-6 ${isDragging\n                        ? 'border-violet-500 bg-violet-50'\n                        : 'border-stone-300 bg-white hover:border-violet-300'\n                    }`}\n                onDragOver={handleDragOver}\n                onDragLeave={handleDragLeave}\n                onDrop={handleDrop}\n            >\n                <input\n                    type=\"file\"\n                    accept=\".pdf\"\n                    multiple\n                    onChange={handleFileSelect}\n                    className=\"hidden\"\n                    id=\"file-upload\"\n                />",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_5",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 722,
      "ingested_at": "2026-01-16T23:06:30.235430"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_6_fe0bdad2",
    "text": "                {uploading ? (\n                    <div className=\"flex flex-col items-center gap-3\">\n                        <Loader2 size={32} className=\"animate-spin text-violet-500\" />\n                        <p className=\"text-stone-600\">Uploading...</p>\n                    </div>\n                ) : (\n                    <label htmlFor=\"file-upload\" className=\"cursor-pointer flex flex-col items-center gap-3\">\n                        <div className=\"w-16 h-16 rounded-2xl bg-violet-100 flex items-center justify-center\">\n                            <Upload size={28} className=\"text-violet-600\" />\n                        </div>\n                        <div>\n                            <p className=\"text-stone-700 font-medium\">Drop PDFs here or click to browse</p>\n                            <p className=\"text-sm text-stone-400 mt-1\">Only PDF files are supported</p>\n                        </div>\n                    </label>\n                )}\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_6",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 977,
      "ingested_at": "2026-01-16T23:06:30.235434"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_7_90ddce45",
    "text": "            {error && (\n                <div className=\"mb-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm flex items-center gap-2\">\n                    <XCircle size={16} />\n                    {error}\n                </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_7",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 262,
      "ingested_at": "2026-01-16T23:06:30.235437"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_8_d0559f26",
    "text": "            {/* Document List */}\n            <div className=\"space-y-3\">\n                {documents.length === 0 ? (\n                    <div className=\"text-center py-12 text-stone-400\">\n                        <FolderOpen size={48} className=\"mx-auto mb-3 opacity-50\" />\n                        <p>No documents uploaded yet</p>\n                        <p className=\"text-sm mt-1\">Upload PDFs to chat with your documents</p>\n                    </div>\n                ) : (\n                    documents.map(doc => (\n                        <div\n                            key={doc.id}\n                            className=\"bg-white rounded-xl p-4 shadow-soft flex items-center gap-4\"\n                        >\n                            <div className={`w-12 h-12 rounded-xl flex items-center justify-center ${doc.status === 'ready' ? 'bg-emerald-100' :\n                                    doc.status === 'error' ? 'bg-red-100' : 'bg-amber-100'\n                                }`}>\n                                <FileText size={20} className={\n                                    doc.status === 'ready' ? 'text-emerald-600' :\n                                        doc.status === 'error' ? 'text-red-600' : 'text-amber-600'\n                                } />\n                            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_8",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1304,
      "ingested_at": "2026-01-16T23:06:30.235441"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_9_1812895d",
    "text": "                            <div className=\"flex-1 min-w-0\">\n                                <p className=\"font-medium text-stone-700 truncate\">{doc.original_filename}</p>\n                                <div className=\"flex items-center gap-3 text-xs text-stone-400 mt-1\">\n                                    <span>{formatFileSize(doc.file_size)}</span>\n                                    <span>\u2022</span>\n                                    <span>{doc.chunk_count} chunks</span>\n                                    <span>\u2022</span>\n                                    <span>{formatDate(doc.uploaded_at)}</span>\n                                </div>\n                            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_9",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 683,
      "ingested_at": "2026-01-16T23:06:30.235444"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_10_c9567d56",
    "text": "                            <div className=\"flex items-center gap-2\">\n                                {doc.status === 'ready' && (\n                                    <span className=\"flex items-center gap-1 px-2 py-1 bg-emerald-100 text-emerald-600 rounded-lg text-xs font-medium\">\n                                        <CheckCircle size={12} />\n                                        Ready\n                                    </span>\n                                )}\n                                {doc.status === 'processing' && (\n                                    <span className=\"flex items-center gap-1 px-2 py-1 bg-amber-100 text-amber-600 rounded-lg text-xs font-medium\">\n                                        <Loader2 size={12} className=\"animate-spin\" />\n                                        Processing\n                                    </span>\n                                )}\n                                {doc.status === 'error' && (\n                                    <span className=\"flex items-center gap-1 px-2 py-1 bg-red-100 text-red-600 rounded-lg text-xs font-medium\" title={doc.error_message}>\n                                        <XCircle size={12} />\n                                        Error\n                                    </span>\n                                )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_10",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1322,
      "ingested_at": "2026-01-16T23:06:30.235447"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/DocumentsPanel.jsx_frontend/src/components/DocumentsPanel.jsx:chunk_11_54f74d0d",
    "text": "                                <button\n                                    onClick={() => handleDelete(doc.id)}\n                                    className=\"p-2 rounded-lg hover:bg-red-50 text-stone-400 hover:text-red-500 transition-colors\"\n                                >\n                                    <Trash2 size={16} />\n                                </button>\n                            </div>\n                        </div>\n                    ))\n                )}\n            </div>\n        </div>\n    );\n};\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/DocumentsPanel.jsx:chunk_11",
      "file_path": "frontend/src/components/DocumentsPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 529,
      "ingested_at": "2026-01-16T23:06:30.235451"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/AuditLogPanel.jsx_frontend/src/components/AuditLogPanel.jsx:chunk_1_7ebcae41",
    "text": "import React from 'react';\nimport { Shield, X, Activity } from 'lucide-react';\n\nexport const AuditLogPanel = ({ logs, onClose }) => (\n  <div className=\"absolute bottom-0 left-0 right-0 h-80 bg-white border-t border-stone-200 shadow-soft-lg z-20 animate-slide-up\">\n    <div className=\"flex items-center justify-between px-6 py-4 border-b border-stone-100\">\n      <div className=\"flex items-center gap-3\">\n        <div className=\"w-10 h-10 rounded-xl bg-amber-100 flex items-center justify-center\">\n          <Activity size={18} className=\"text-amber-600\" />\n        </div>\n        <div>\n          <h3 className=\"text-base font-bold text-stone-700\">Activity Log</h3>\n          <p className=\"text-xs text-stone-400\">Real-time audit events</p>\n        </div>\n      </div>\n      <button onClick={onClose} className=\"p-2 rounded-xl hover:bg-stone-100 text-stone-400 hover:text-stone-600 transition-all\">\n        <X size={18} />\n      </button>\n    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/AuditLogPanel.jsx:chunk_1",
      "file_path": "frontend/src/components/AuditLogPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 948,
      "ingested_at": "2026-01-16T23:06:30.236206"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/AuditLogPanel.jsx_frontend/src/components/AuditLogPanel.jsx:chunk_2_36a14802",
    "text": "    <div className=\"overflow-y-auto h-full p-4 space-y-2 pb-20\">\n      {logs.length === 0 && (\n        <div className=\"text-stone-400 text-center py-8\">\n          <Shield size={24} className=\"mx-auto mb-2 opacity-50\" />\n          <p className=\"text-sm\">No activity yet</p>\n          <p className=\"text-xs mt-1\">Events will appear here as you use the app</p>\n        </div>\n      )}\n\n      {logs.map((log) => (\n        <div key={log.id} className=\"flex items-center gap-4 p-3 rounded-xl bg-stone-50 hover:bg-stone-100 transition-colors\">\n          <div className=\"text-xs text-stone-400 min-w-[70px]\">\n            {new Date(log.timestamp).toLocaleTimeString()}\n          </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/AuditLogPanel.jsx:chunk_2",
      "file_path": "frontend/src/components/AuditLogPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 676,
      "ingested_at": "2026-01-16T23:06:30.236210"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/components/AuditLogPanel.jsx_frontend/src/components/AuditLogPanel.jsx:chunk_3_2cb48648",
    "text": "          <div className={`px-2 py-1 rounded-lg text-xs font-semibold min-w-[70px] text-center ${log.status === 'DENIED' ? 'bg-red-100 text-red-600' :\n              log.status === 'ERROR' ? 'bg-orange-100 text-orange-600' :\n                'bg-emerald-100 text-emerald-600'\n            }`}>\n            {log.status}\n          </div>\n\n          <div className=\"text-sm font-medium text-stone-600 min-w-[140px]\">{log.action}</div>\n\n          <div className=\"flex-1 text-sm text-stone-500 truncate\">\n            {log.details}\n          </div>\n        </div>\n      ))}\n    </div>\n  </div>\n);\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/components/AuditLogPanel.jsx:chunk_3",
      "file_path": "frontend/src/components/AuditLogPanel.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 588,
      "ingested_at": "2026-01-16T23:06:30.236213"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_1_bc5c01f3",
    "text": "import React, { useState, useRef, useEffect } from 'react';\nimport { Menu, Shield, Send, Terminal, Activity, ChevronDown, ChevronRight, Loader2, Sparkles, History, Plus, Zap } from 'lucide-react';\nimport ActionCard from '../components/ActionCard';\nimport ThinkingStep from '../components/ThinkingStep';\nimport ConversationSidebar from '../components/ConversationSidebar';\nimport api from '../services/api';\nimport { motion, AnimatePresence } from 'framer-motion';\n\nconst ThinkingPanel = ({ thoughts }) => {\n    const [isOpen, setIsOpen] = useState(false);\n\n    useEffect(() => {\n        if (thoughts.some(t => t.state === 'processing')) {\n            setIsOpen(true);\n        }\n    }, [thoughts]);\n\n    if (!thoughts || thoughts.length === 0) return null;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_1",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 755,
      "ingested_at": "2026-01-16T23:06:30.238116"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_2_8522eb34",
    "text": "    return (\n        <div className=\"mb-3 rounded-lg overflow-hidden border border-blue-900/30 bg-[#131c2e]\">\n            <button\n                onClick={() => setIsOpen(!isOpen)}\n                className=\"w-full flex items-center gap-2 px-4 py-2 bg-[#1a2438] hover:bg-[#1e293b] transition-colors text-left\"\n            >\n                <div className={`p-1 rounded bg-blue-500/10 text-blue-400`}>\n                    <Activity size={14} />\n                </div>\n                <span className=\"text-xs font-bold text-slate-300 uppercase tracking-wider flex-1\">\n                    Reasoning Trace\n                </span>\n                {isOpen ? <ChevronDown size={14} className=\"text-slate-500\" /> : <ChevronRight size={14} className=\"text-slate-500\" />}\n            </button>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_2",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 784,
      "ingested_at": "2026-01-16T23:06:30.238127"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_3_47e13a00",
    "text": "            <AnimatePresence>\n                {isOpen && (\n                    <motion.div\n                        initial={{ height: 0, opacity: 0 }}\n                        animate={{ height: \"auto\", opacity: 1 }}\n                        exit={{ height: 0, opacity: 0 }}\n                        className=\"border-t border-blue-900/20\"\n                    >\n                        <div className=\"p-3 space-y-1 bg-[#0f1522]\">\n                            {thoughts.map((t, i) => <ThinkingStep key={i} text={t.text} state={t.state} />)}\n                        </div>\n                    </motion.div>\n                )}\n            </AnimatePresence>\n        </div>\n    );\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_3",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 676,
      "ingested_at": "2026-01-16T23:06:30.238131"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_4_801e8510",
    "text": "const ChatView = ({ isSidebarOpen, setSidebarOpen }) => {\n    const [input, setInput] = useState('');\n    const [isLoading, setIsLoading] = useState(false);\n    const [isStreaming, setIsStreaming] = useState(false);\n    const [messages, setMessages] = useState([]);\n    const [conversationId, setConversationId] = useState(null);\n    const [showHistory, setShowHistory] = useState(false);\n    const scrollRef = useRef(null);\n    const iamRole = 'senior_engineer';\n\n    const scrollToBottom = () => {\n        if (scrollRef.current) {\n            scrollRef.current.scrollTop = scrollRef.current.scrollHeight;\n        }\n    };\n\n    useEffect(() => {\n        scrollToBottom();\n    }, [messages]);\n\n    useEffect(() => {\n        if (conversationId) {\n            loadConversationMessages(conversationId);\n        }\n    }, [conversationId]);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_4",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 835,
      "ingested_at": "2026-01-16T23:06:30.238135"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_5_503f3af1",
    "text": "    const loadConversationMessages = async (convoId) => {\n        try {\n            const msgs = await api.conversationAPI.getMessages(convoId, iamRole);\n            const formattedMsgs = msgs.map((m, idx) => ({\n                id: idx,\n                role: m.role,\n                content: m.content,\n                thoughts: m.metadata?.thoughts || [],\n                action: m.metadata?.action || null,\n                timestamp: new Date(m.created_at).toLocaleTimeString()\n            }));\n            setMessages(formattedMsgs);\n        } catch (e) {\n            console.error(\"Failed to load messages:\", e);\n        }\n    };\n\n    const handleNewChat = (newConvoId) => {\n        setConversationId(newConvoId);\n        setMessages([]);\n        setShowHistory(false);\n    };\n\n    const handleSelectConversation = (convoId) => {\n        setConversationId(convoId);\n        setShowHistory(false);\n    };\n\n    const handleSend = async () => {\n        if (!input.trim() || isLoading) return;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_5",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 993,
      "ingested_at": "2026-01-16T23:06:30.238138"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_6_89fcbf8d",
    "text": "        const userText = input;\n        setInput('');\n        setIsLoading(true);\n        setIsStreaming(true);\n\n        const userMsg = {\n            id: Date.now(),\n            role: 'user',\n            content: userText,\n            timestamp: new Date().toLocaleTimeString()\n        };\n        setMessages(prev => [...prev, userMsg]);\n\n        const botMsgId = Date.now() + 1;\n        const initialBotMsg = {\n            id: botMsgId,\n            role: 'assistant',\n            thoughts: [],\n            content: \"\",\n            timestamp: new Date().toLocaleTimeString()\n        };\n        setMessages(prev => [...prev, initialBotMsg]);\n\n        try {\n            // Use streaming endpoint\n            for await (const event of api.chatAPI.streamQuery(userText, iamRole, conversationId)) {\n                if (event.type === 'step') {\n                    // Update thinking steps\n                    setMessages(prev => prev.map(m => {\n                        if (m.id !== botMsgId) return m;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_6",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 997,
      "ingested_at": "2026-01-16T23:06:30.238142"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_7_6c5ec943",
    "text": "                        const existingStepIdx = m.thoughts.findIndex(t => t.text === event.text);\n                        if (existingStepIdx >= 0) {\n                            // Update existing step\n                            const newThoughts = [...m.thoughts];\n                            newThoughts[existingStepIdx] = { ...newThoughts[existingStepIdx], state: event.state };\n                            return { ...m, thoughts: newThoughts };\n                        } else {\n                            // Add new step\n                            return { ...m, thoughts: [...m.thoughts, { text: event.text, state: event.state }] };\n                        }\n                    }));\n                } else if (event.type === 'token') {\n                    // Append token to content\n                    setMessages(prev => prev.map(m =>\n                        m.id === botMsgId\n                            ? { ...m, content: m.content + event.content }\n                            : m\n                    ));\n                    scrollToBottom();\n                } else if (event.type === 'done') {\n                    setIsStreaming(false);\n                }\n            }\n        } catch (e) {\n            console.error(e);\n            setMessages(prev => prev.map(m => m.id === botMsgId ? {\n                ...m,\n                thoughts: [\n                    ...m.thoughts,\n                    { text: \"Connection failed\", state: \"error\" }\n                ],\n                content: \"I encountered an error connecting to the Nexus backend. Please ensure the services are running.\"\n            } : m));\n        } finally {\n            setIsLoading(false);\n            setIsStreaming(false);\n        }\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_7",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1723,
      "ingested_at": "2026-01-16T23:06:30.238145"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_8_dbdc1a83",
    "text": "    const sessionIdDisplay = conversationId\n        ? conversationId.substring(0, 8)\n        : 'new-session';\n\n    return (\n        <div className=\"flex h-full\">\n            {/* Conversation History Sidebar */}\n            <AnimatePresence>\n                {showHistory && (\n                    <motion.div\n                        initial={{ width: 0, opacity: 0 }}\n                        animate={{ width: 280, opacity: 1 }}\n                        exit={{ width: 0, opacity: 0 }}\n                        className=\"h-full flex-shrink-0 overflow-hidden\"\n                    >\n                        <ConversationSidebar\n                            currentConversationId={conversationId}\n                            onSelectConversation={handleSelectConversation}\n                            onNewChat={handleNewChat}\n                            iamRole={iamRole}\n                        />\n                    </motion.div>\n                )}\n            </AnimatePresence>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_8",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 976,
      "ingested_at": "2026-01-16T23:06:30.238156"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_9_5c6c4517",
    "text": "            {/* Main Chat Area */}\n            <div className=\"flex-1 flex flex-col min-w-0\">\n                <header className=\"h-16 border-b border-white/5 bg-[#0f172a]/80 backdrop-blur-md flex items-center justify-between px-6 sticky top-0 z-10\">\n                    <div className=\"flex items-center space-x-4\">\n                        <button\n                            onClick={() => setShowHistory(!showHistory)}\n                            className={`p-2 rounded-lg transition-colors ${showHistory ? 'bg-blue-600 text-white' : 'text-slate-400 hover:bg-slate-800 hover:text-white'}`}\n                            title=\"Chat History\"\n                        >\n                            <History className=\"w-5 h-5\" />\n                        </button>\n                        <button\n                            onClick={() => handleNewChat(null)}\n                            className=\"p-2 text-slate-400 hover:bg-slate-800 hover:text-white rounded-lg transition-colors\"\n                            title=\"New Chat\"\n                        >\n                            <Plus className=\"w-5 h-5\" />\n                        </button>\n                        <div className=\"h-6 w-px bg-white/10\"></div>\n                        <div className=\"flex items-center text-slate-400 text-sm\">\n                            <span className=\"font-medium text-slate-200\">Session:</span>\n                            <span className=\"ml-2 font-mono text-xs bg-white/5 px-2 py-1 rounded text-slate-400\">\n                                {sessionIdDisplay}\n                            </span>\n                        </div>\n                    </div>\n                    <div className=\"flex items-center space-x-3\">\n                        {isStreaming && (\n                            <div className=\"flex items-center px-3 py-1.5 bg-emerald-500/10 border border-emerald-500/20 rounded-full\">\n                                <Zap className=\"w-3 h-3 text-emerald-400 mr-2 animate-pulse\" />\n                                <span className=\"text-[10px] font-bold text-emerald-300 uppercase tracking-wide\">Streaming</span>\n                            </div>\n                        )}\n                        <div className=\"flex items-center px-3 py-1.5 bg-blue-500/10 border border-blue-500/20 rounded-full\">\n                            <div className=\"w-1.5 h-1.5 bg-blue-500 rounded-full mr-2 animate-pulse\"></div>\n                            <span className=\"text-[10px] font-bold text-blue-300 uppercase tracking-wide\">Secure Environment</span>\n                        </div>\n                    </div>\n                </header>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_9",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2625,
      "ingested_at": "2026-01-16T23:06:30.238161"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_10_ca6619f0",
    "text": "                <div className=\"flex-1 overflow-y-auto p-4 md:p-8 space-y-8 scroll-smooth custom-scrollbar\" ref={scrollRef}>\n                    {messages.length === 0 && (\n                        <div className=\"h-full flex flex-col items-center justify-center opacity-50 space-y-6 select-none pointer-events-none\">\n                            <div className=\"w-24 h-24 rounded-3xl bg-blue-500/10 flex items-center justify-center border border-blue-500/20 shadow-2xl shadow-blue-500/10\">\n                                <Sparkles className=\"text-blue-400\" size={48} />\n                            </div>\n                            <div className=\"text-center\">\n                                <h2 className=\"text-2xl font-bold text-slate-200\">Nexus Enterprise</h2>\n                                <p className=\"text-slate-500 mt-2 max-w-sm\">\n                                    Ready to assist with infrastructure, deployments, and security operations.\n                                </p>\n                            </div>\n                        </div>\n                    )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_10",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1080,
      "ingested_at": "2026-01-16T23:06:30.238166"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_11_f58363aa",
    "text": "                    {messages.map((msg) => (\n                        <div key={msg.id} className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'} group max-w-4xl mx-auto w-full`}>\n                            {msg.role === 'assistant' && (\n                                <div className=\"w-8 h-8 rounded bg-gradient-to-b from-blue-600 to-blue-700 flex-shrink-0 mr-4 flex items-center justify-center shadow-lg shadow-blue-900/20 mt-1\">\n                                    <Shield className=\"w-4 h-4 text-white\" />\n                                </div>\n                            )}\n                            <div className={`max-w-2xl w-full ${msg.role === 'user' ? 'order-1' : 'order-2'}`}>\n                                {msg.role === 'user' && (\n                                    <div className=\"bg-slate-800 text-slate-200 px-5 py-3.5 rounded-2xl rounded-tr-sm border border-white/5 shadow-md ml-auto w-fit\">\n                                        <p className=\"text-sm leading-relaxed whitespace-pre-wrap\">{msg.content}</p>\n                                    </div>\n                                )}\n                                {msg.role === 'assistant' && (\n                                    <div className=\"space-y-3\">\n                                        <ThinkingPanel thoughts={msg.thoughts} />",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_11",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1336,
      "ingested_at": "2026-01-16T23:06:30.238170"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_12_a14bf7f4",
    "text": "                                        {msg.content && (\n                                            <div className=\"text-slate-300 text-sm leading-relaxed whitespace-pre-wrap\">\n                                                {msg.content}\n                                                {isStreaming && msg.id === messages[messages.length - 1]?.id && (\n                                                    <span className=\"inline-block w-2 h-4 bg-blue-400 ml-0.5 animate-pulse\" />\n                                                )}\n                                            </div>\n                                        )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_12",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 626,
      "ingested_at": "2026-01-16T23:06:30.238174"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_13_984319fa",
    "text": "                                        {msg.action && <ActionCard {...msg.action} />}\n                                    </div>\n                                )}\n                                <div className={`mt-2 text-[10px] text-slate-600 ${msg.role === 'user' ? 'text-right pr-1' : 'pl-1'} opacity-0 group-hover:opacity-100 transition-opacity`}>\n                                    {msg.timestamp}\n                                </div>\n                            </div>\n                        </div>\n                    ))}\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_13",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 557,
      "ingested_at": "2026-01-16T23:06:30.238178"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_14_e0a2b949",
    "text": "                <div className=\"p-6 bg-[#0f172a] relative border-t border-slate-800/50\">\n                    <div className=\"max-w-4xl mx-auto\">\n                        <div className={`relative flex items-center bg-[#1e293b] rounded-xl border transition-all ${isLoading ? 'border-blue-500/30' : 'border-white/10 shadow-xl focus-within:ring-1 focus-within:ring-blue-500/50'}`}>\n                            <div className=\"pl-4 text-slate-500\">\n                                {isLoading ? <Loader2 className=\"w-5 h-5 animate-spin text-blue-400\" /> : <Terminal className=\"w-5 h-5\" />}\n                            </div>\n                            <input\n                                type=\"text\"\n                                value={input}\n                                onChange={(e) => setInput(e.target.value)}\n                                onKeyDown={(e) => e.key === 'Enter' && handleSend()}\n                                placeholder={isLoading ? \"Streaming response...\" : \"Type a command or ask a question...\"}\n                                className=\"w-full bg-transparent text-slate-200 text-sm py-4 px-4 focus:outline-none placeholder:text-slate-600 disabled:opacity-50\"\n                                disabled={isLoading}\n                            />\n                            <div className=\"pr-2\">\n                                <button\n                                    onClick={handleSend}\n                                    disabled={!input.trim() || isLoading}\n                                    className=\"p-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition-colors disabled:opacity-50 disabled:bg-slate-700\"\n                                >\n                                    <Send className=\"w-4 h-4\" />\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_14",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1961,
      "ingested_at": "2026-01-16T23:06:30.238181"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/ChatView.jsx_frontend/src/views/ChatView.jsx:chunk_15_368176d0",
    "text": "export default ChatView;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/ChatView.jsx:chunk_15",
      "file_path": "frontend/src/views/ChatView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 25,
      "ingested_at": "2026-01-16T23:06:30.238184"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_1_1311b931",
    "text": "import React, { useState, useEffect } from 'react';\nimport {\n    Terminal,\n    AlertCircle,\n    Microscope,\n    RefreshCw,\n    Stethoscope,\n    CheckCircle,\n    Siren,\n    ArrowRight,\n    BarChart3\n} from 'lucide-react';\n\nconst LiveOpsView = () => {\n    const [logs, setLogs] = useState([]);\n    const [activeAlert, setActiveAlert] = useState(null);\n    const [diagnosis, setDiagnosis] = useState({ state: 'idle', steps: [] });\n    const [simulatedAction, setSimulatedAction] = useState(null);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_1",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 493,
      "ingested_at": "2026-01-16T23:06:30.240352"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_2_1c3ae000",
    "text": "    useEffect(() => {\n        // Simulate incoming logs\n        const interval = setInterval(() => {\n            const newLogs = [\n                { ts: new Date().toLocaleTimeString(), level: \"INFO\", sys: \"K8S_POD\", msg: \"Container status: Running\" },\n                { ts: new Date().toLocaleTimeString(), level: \"DEBUG\", sys: \"INGRESS\", msg: \"Route match: /api/v1/health -> health-check-svc\" },\n                { ts: new Date().toLocaleTimeString(), level: \"WARN\", sys: \"DB_POOL\", msg: \"Connection pool utilization > 80%\" },\n                { ts: new Date().toLocaleTimeString(), level: \"INFO\", sys: \"AUTH\", msg: \"Token verified for user_jdoe\" }\n            ];\n            const randomLog = newLogs[Math.floor(Math.random() * newLogs.length)];\n            setLogs(prev => [...prev.slice(-20), randomLog]);\n        }, 1500);\n        return () => clearInterval(interval);\n    }, []);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_2",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 884,
      "ingested_at": "2026-01-16T23:06:30.240358"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_3_08ecbd20",
    "text": "    const alerts = [\n        { id: 1, sev: 'critical', title: 'Pod CrashLoopBackOff', svc: 'payments-v2', time: '2m ago' },\n        { id: 2, sev: 'warning', title: 'High Memory Usage', svc: 'redis-cache-01', time: '15m ago' },\n        { id: 3, sev: 'info', title: 'Deployment Rolled Out', svc: 'frontend-web', time: '1h ago' },\n    ];\n\n    const startDiagnosis = (alert) => {\n        setActiveAlert(alert);\n        setDiagnosis({ state: 'analyzing', steps: [] });\n        setSimulatedAction(null);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_3",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 497,
      "ingested_at": "2026-01-16T23:06:30.240363"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_4_f692b448",
    "text": "        // Simulate AI thinking process for RCA\n        setTimeout(() => setDiagnosis(p => ({ ...p, steps: [...p.steps, { text: `Aggregating logs for service: ${alert.svc}`, status: 'done' }] })), 500);\n        setTimeout(() => setDiagnosis(p => ({ ...p, steps: [...p.steps, { text: \"Correlating event spikes with deployment window\", status: 'done' }] })), 1500);\n        setTimeout(() => setDiagnosis(p => ({ ...p, steps: [...p.steps, { text: \"Detecting pattern: Connection Leak in DB Pool\", status: 'warning' }] })), 2500);\n        setTimeout(() => setDiagnosis(p => ({ ...p, state: 'complete' })), 3000);\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_4",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 614,
      "ingested_at": "2026-01-16T23:06:30.240367"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_5_70b981a9",
    "text": "    const triggerRemediation = (alert) => {\n        setSimulatedAction({\n            status: 'pending',\n            action: alert.id === 1 ? 'restart_pod' : 'scale_replicas',\n            target: alert.svc,\n            payload: {\n                apiVersion: \"v1\",\n                kind: \"Pod\",\n                metadata: { name: alert.svc, namespace: \"prod\" },\n                command: [\"kubectl\", \"delete\", \"pod\", alert.svc]\n            }\n        });\n\n        // Simulate backend response delay\n        setTimeout(() => {\n            setSimulatedAction(prev => ({ ...prev, status: 'executing' }));\n            setTimeout(() => {\n                setSimulatedAction(prev => ({ ...prev, status: 'complete' }));\n                setLogs(prev => [...prev, { ts: new Date().toLocaleTimeString(), level: \"POST\", sys: \"OPS_AGENT\", msg: `Action executed: ${alert.id === 1 ? 'restart_pod' : 'scale_replicas'} on ${alert.svc}` }]);\n            }, 2000);\n        }, 1000);\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_5",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 964,
      "ingested_at": "2026-01-16T23:06:30.240371"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_6_58b59996",
    "text": "    return (\n        <div className=\"h-[calc(100vh-2rem)] flex flex-col bg-[#050505] font-mono text-sm overflow-hidden rounded-xl border border-slate-800\">\n\n            {/* 1. Status Header */}\n            <div className=\"h-14 bg-slate-900/50 border-b border-slate-800 flex items-center px-4 justify-between\">\n                <div className=\"flex items-center space-x-2\">\n                    <Terminal className=\"w-5 h-5 text-green-500\" />\n                    <span className=\"text-slate-200 font-bold tracking-tight\">Live Ops Console</span>\n                    <span className=\"text-[10px] bg-slate-800 text-slate-500 px-1.5 py-0.5 rounded border border-slate-700\">PROD-US-EAST-1</span>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_6",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 710,
      "ingested_at": "2026-01-16T23:06:30.240375"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_7_0e0a60f9",
    "text": "                {/* Metric Sparklines (Mock) */}\n                <div className=\"flex items-center space-x-6\">\n                    <div className=\"flex flex-col items-end\">\n                        <span className=\"text-[10px] text-slate-500 uppercase font-bold\">System Load</span>\n                        <div className=\"flex items-center space-x-2\">\n                            <div className=\"flex space-x-0.5 items-end h-4\">\n                                <div className=\"w-1 bg-green-500 h-2\"></div>\n                                <div className=\"w-1 bg-green-500 h-3\"></div>\n                                <div className=\"w-1 bg-yellow-500 h-4\"></div>\n                                <div className=\"w-1 bg-green-500 h-2\"></div>\n                            </div>\n                            <span className=\"text-xs text-slate-300 font-mono\">42%</span>\n                        </div>\n                    </div>\n                    <div className=\"flex flex-col items-end\">\n                        <span className=\"text-[10px] text-slate-500 uppercase font-bold\">Error Rate</span>\n                        <div className=\"flex items-center space-x-2\">\n                            <div className=\"flex space-x-0.5 items-end h-4\">\n                                <div className=\"w-1 bg-slate-700 h-1\"></div>\n                                <div className=\"w-1 bg-slate-700 h-1\"></div>\n                                <div className=\"w-1 bg-red-500 h-2\"></div>\n                                <div className=\"w-1 bg-slate-700 h-1\"></div>\n                            </div>\n                            <span className=\"text-xs text-red-400 font-mono\">0.05%</span>\n                        </div>\n                    </div>\n                    <div className=\"h-6 w-px bg-slate-800\"></div>\n                    <button className=\"text-xs bg-red-900/20 text-red-400 px-3 py-1.5 rounded border border-red-900/30 hover:bg-red-900/30 flex items-center animate-pulse\">\n                        <AlertCircle className=\"w-3 h-3 mr-2\" /> 3 Active Alerts\n                    </button>\n                </div>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_7",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2116,
      "ingested_at": "2026-01-16T23:06:30.240378"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_8_fd34c8d9",
    "text": "            <div className=\"flex-1 flex overflow-hidden\">",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_8",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 57,
      "ingested_at": "2026-01-16T23:06:30.240381"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_9_1940b12b",
    "text": "                {/* 2. Left Panel: Active Incidents */}\n                <div className=\"w-72 border-r border-slate-800 bg-[#0a0a0a] flex flex-col\">\n                    <div className=\"p-3 border-b border-slate-800 bg-slate-900/20\">\n                        <h3 className=\"text-xs font-bold text-slate-400 uppercase tracking-wider\">Incident Feed</h3>\n                    </div>\n                    <div className=\"flex-1 overflow-y-auto\">\n                        {alerts.map((alert) => (\n                            <div\n                                key={alert.id}\n                                onClick={() => startDiagnosis(alert)}\n                                className={`p-4 border-b border-slate-800 cursor-pointer transition-colors ${activeAlert?.id === alert.id ? 'bg-slate-800/50' : 'hover:bg-slate-900/30'}`}\n                            >\n                                <div className=\"flex items-center justify-between mb-1\">\n                                    <div className={`text-[10px] font-bold uppercase px-1.5 py-0.5 rounded border ${alert.sev === 'critical' ? 'bg-red-900/20 text-red-500 border-red-900/50' :\n                                            alert.sev === 'warning' ? 'bg-yellow-900/20 text-yellow-500 border-yellow-900/50' :\n                                                'bg-blue-900/20 text-blue-500 border-blue-900/50'\n                                        }`}>\n                                        {alert.sev}\n                                    </div>\n                                    <span className=\"text-[10px] text-slate-600\">{alert.time}</span>\n                                </div>\n                                <h4 className=\"text-sm font-medium text-slate-200 mb-0.5\">{alert.title}</h4>\n                                <p className=\"text-xs text-slate-500 font-mono\">{alert.svc}</p>\n                            </div>\n                        ))}\n                    </div>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_9",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1957,
      "ingested_at": "2026-01-16T23:06:30.240385"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_10_7b587c01",
    "text": "                {/* 3. Center Panel: Telemetry Stream */}\n                <div className=\"flex-1 flex flex-col bg-black relative\">\n                    <div className=\"absolute top-0 left-0 right-0 h-8 bg-gradient-to-b from-black to-transparent pointer-events-none\"></div>\n                    <div className=\"flex-1 p-4 overflow-y-auto space-y-1 font-mono text-xs custom-scrollbar\">\n                        {logs.map((log, i) => (\n                            <div key={i} className=\"flex space-x-3 hover:bg-white/5 p-0.5 rounded group\">\n                                <span className=\"text-slate-600 shrink-0\">[{log.ts}]</span>\n                                <span className={`shrink-0 w-12 font-bold ${log.level === 'INFO' ? 'text-blue-500' :\n                                        log.level === 'DEBUG' ? 'text-slate-600' :\n                                            log.level === 'WARN' ? 'text-yellow-500' :\n                                                log.level === 'POST' ? 'text-purple-500' : 'text-green-500'\n                                    }`}>{log.level}</span>\n                                <span className=\"text-orange-500 shrink-0 w-24\">[{log.sys}]</span>\n                                <span className=\"text-slate-400 group-hover:text-slate-200\">{log.msg}</span>\n                            </div>\n                        ))}\n                        <div className=\"flex items-center text-slate-600 animate-pulse mt-2\">\n                            <span className=\"mr-2\">_</span> waiting for stream\n                        </div>\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_10",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1583,
      "ingested_at": "2026-01-16T23:06:30.240388"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_11_4ac96c41",
    "text": "                    {/* Command Input */}\n                    <div className=\"p-3 border-t border-slate-800 bg-[#0a0a0a]\">\n                        <div className=\"flex items-center bg-black border border-slate-800 rounded px-3 py-2\">\n                            <span className=\"text-green-500 mr-2\">$</span>\n                            <input\n                                type=\"text\"\n                                placeholder=\"Execute ad-hoc command or filter logs...\"\n                                className=\"bg-transparent text-slate-200 w-full focus:outline-none placeholder:text-slate-700\"\n                            />\n                        </div>\n                    </div>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_11",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 713,
      "ingested_at": "2026-01-16T23:06:30.240392"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_12_6d2a0b7b",
    "text": "                {/* 4. Right Panel: AI Investigator (RCA) */}\n                <div className=\"w-96 border-l border-slate-800 bg-[#0a0a0a] flex flex-col\">\n                    <div className=\"p-3 border-b border-slate-800 bg-slate-900/20 flex items-center justify-between\">\n                        <h3 className=\"text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center\">\n                            <Microscope className=\"w-4 h-4 mr-2 text-purple-400\" />\n                            Auto-Investigator\n                        </h3>\n                        {diagnosis.state === 'analyzing' && <RefreshCw className=\"w-3 h-3 text-purple-500 animate-spin\" />}\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_12",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 699,
      "ingested_at": "2026-01-16T23:06:30.240395"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_13_207280d1",
    "text": "                    <div className=\"flex-1 p-4 overflow-y-auto\">\n                        {!activeAlert ? (\n                            <div className=\"h-full flex flex-col items-center justify-center text-slate-600\">\n                                <Microscope className=\"w-12 h-12 mb-4 opacity-10\" />\n                                <p className=\"text-xs text-center text-slate-500\">Select an incident to trigger<br />AI Root Cause Analysis</p>\n                            </div>\n                        ) : (\n                            <div className=\"space-y-6\">",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_13",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 566,
      "ingested_at": "2026-01-16T23:06:30.240399"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_14_8eebeb98",
    "text": "                                {/* AI Diagnosis Trace */}\n                                <div className=\"bg-slate-900/30 rounded-lg p-3 border border-slate-800\">\n                                    <h4 className=\"text-xs font-bold text-slate-300 mb-3 flex items-center\">\n                                        <Stethoscope className=\"w-3.5 h-3.5 mr-2 text-blue-400\" /> Diagnosis Trace\n                                    </h4>\n                                    <div className=\"space-y-2\">\n                                        {diagnosis.steps.map((step, idx) => (\n                                            <div key={idx} className=\"flex items-center text-[10px] animate-fade-in\">\n                                                {step.status === 'done' && <CheckCircle className=\"w-3 h-3 text-green-500 mr-2\" />}\n                                                {step.status === 'warning' && <AlertCircle className=\"w-3 h-3 text-yellow-500 mr-2\" />}\n                                                <span className={step.status === 'warning' ? 'text-yellow-200' : 'text-slate-400'}>{step.text}</span>\n                                            </div>\n                                        ))}\n                                        {diagnosis.state === 'analyzing' && (\n                                            <div className=\"flex items-center text-[10px] text-purple-400\">\n                                                <div className=\"w-2 h-2 rounded-full bg-purple-500 animate-ping mr-3\"></div>\n                                                Analyzing dependencies...\n                                            </div>\n                                        )}\n                                    </div>\n                                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_14",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1763,
      "ingested_at": "2026-01-16T23:06:30.240403"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_15_dc344777",
    "text": "                                {diagnosis.state === 'complete' && (\n                                    <div className=\"animate-slide-up space-y-6\">\n                                        {/* Findings */}\n                                        <div>\n                                            <h4 className=\"text-sm font-bold text-slate-200 mb-1\">RCA Summary</h4>\n                                            <div className=\"p-3 bg-red-900/10 border border-red-900/30 rounded text-xs text-red-200 leading-relaxed\">\n                                                <span className=\"font-bold\">Root Cause Probability (87%):</span> {activeAlert.title} is likely caused by <span className=\"text-white font-mono bg-red-900/30 px-1 rounded\">db_pool_exhaustion</span>.\n                                                <br /><br />\n                                                Logs indicate 50+ connection timeouts correlating with the recent deployment `v2.4.1`.\n                                            </div>\n                                        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_15",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1057,
      "ingested_at": "2026-01-16T23:06:30.240407"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_16_c95640b4",
    "text": "                                        {/* Remediation Plan */}\n                                        <div>\n                                            <h4 className=\"text-sm font-bold text-slate-200 mb-2 flex items-center\">\n                                                <Siren className=\"w-4 h-4 mr-2 text-orange-400\" /> Remediation Plan\n                                            </h4>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_16",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 393,
      "ingested_at": "2026-01-16T23:06:30.240411"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_17_a10a09c5",
    "text": "                                            <div className=\"space-y-2\">\n                                                <button\n                                                    onClick={() => triggerRemediation(activeAlert)}\n                                                    className=\"w-full flex items-center justify-between p-3 bg-slate-800 border border-slate-700 rounded hover:bg-slate-700 hover:border-slate-500 transition-all group\"\n                                                >\n                                                    <div className=\"flex items-center\">\n                                                        <div className=\"p-1.5 bg-blue-900/30 rounded text-blue-400 mr-3 group-hover:text-blue-300\">\n                                                            <RefreshCw className=\"w-4 h-4\" />\n                                                        </div>\n                                                        <div className=\"text-left\">\n                                                            <div className=\"text-xs font-bold text-slate-200\">Restart Pods</div>\n                                                            <div className=\"text-[10px] text-slate-500\">Safe \u2022 Quick Recovery</div>\n                                                        </div>\n                                                    </div>\n                                                    <ArrowRight className=\"w-4 h-4 text-slate-600 group-hover:text-white\" />\n                                                </button>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_17",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1537,
      "ingested_at": "2026-01-16T23:06:30.240417"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_18_74cfb23d",
    "text": "                                                <button className=\"w-full flex items-center justify-between p-3 bg-slate-800 border border-slate-700 rounded hover:bg-slate-700 hover:border-slate-500 transition-all group\">\n                                                    <div className=\"flex items-center\">\n                                                        <div className=\"p-1.5 bg-purple-900/30 rounded text-purple-400 mr-3 group-hover:text-purple-300\">\n                                                            <BarChart3 className=\"w-4 h-4\" />\n                                                        </div>\n                                                        <div className=\"text-left\">\n                                                            <div className=\"text-xs font-bold text-slate-200\">Scale Up Replicas</div>\n                                                            <div className=\"text-[10px] text-slate-500\">Moderate Risk \u2022 Cost Impact</div>\n                                                        </div>\n                                                    </div>\n                                                    <ArrowRight className=\"w-4 h-4 text-slate-600 group-hover:text-white\" />\n                                                </button>\n                                            </div>\n                                        </div>\n                                    </div>\n                                )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_18",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1457,
      "ingested_at": "2026-01-16T23:06:30.240421"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_19_8addfb32",
    "text": "                                {/* Execution Simulator (Log Output) */}\n                                {simulatedAction && (\n                                    <div className=\"border border-slate-700 rounded-lg overflow-hidden bg-black animate-in fade-in zoom-in-95 duration-300\">\n                                        <div className=\"px-3 py-2 bg-slate-900 border-b border-slate-700 flex justify-between items-center\">\n                                            <span className=\"text-[10px] font-bold uppercase text-slate-400\">Action Output</span>\n                                            {simulatedAction.status === 'complete' ? (\n                                                <span className=\"text-[10px] text-green-500 flex items-center\"><CheckCircle className=\"w-3 h-3 mr-1\" /> Success</span>\n                                            ) : (\n                                                <span className=\"text-[10px] text-blue-500 flex items-center\"><RefreshCw className=\"w-3 h-3 mr-1 animate-spin\" /> Running</span>\n                                            )}\n                                        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_19",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1129,
      "ingested_at": "2026-01-16T23:06:30.240425"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_20_469731c8",
    "text": "                                        {/* Stream Output */}\n                                        <div className=\"p-3 bg-slate-900/30 h-32 overflow-y-auto font-mono text-[10px] space-y-1\">\n                                            {simulatedAction.status !== 'pending' && (\n                                                <>\n                                                    <div className=\"text-slate-400\">&gt; Connecting to k8s cluster... OK</div>\n                                                    <div className=\"text-slate-400\">&gt; Authenticating as user_jdoe... OK</div>\n                                                    <div className=\"text-slate-400\">&gt; Executing: {simulatedAction.payload.command.join(' ')}</div>\n                                                </>\n                                            )}\n                                            {simulatedAction.status === 'complete' && (\n                                                <>\n                                                    <div className=\"text-slate-300\">pod \"{activeAlert.svc}\" deleted</div>\n                                                    <div className=\"text-green-500\">Command exited with status 0</div>\n                                                </>\n                                            )}\n                                        </div>\n                                    </div>\n                                )}\n                            </div>\n                        )}\n                    </div>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_20",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1551,
      "ingested_at": "2026-01-16T23:06:30.240429"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/LiveOpsView.jsx_frontend/src/views/LiveOpsView.jsx:chunk_21_ae93527a",
    "text": "            </div>\n        </div>\n    );\n};\n\nexport default LiveOpsView;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/LiveOpsView.jsx:chunk_21",
      "file_path": "frontend/src/views/LiveOpsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 73,
      "ingested_at": "2026-01-16T23:06:30.240433"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IntegrationsView.jsx_frontend/src/views/IntegrationsView.jsx:chunk_1_f01d48e6",
    "text": "import React from 'react';\nimport { Settings } from 'lucide-react';\n\nconst IntegrationsView = () => (\n    <div className=\"flex-1 p-8 overflow-y-auto h-full\">\n        <div className=\"max-w-5xl mx-auto space-y-8\">\n            <div>\n                <h2 className=\"text-2xl font-bold text-white mb-1\">Integrations & Telemetry</h2>\n                <p className=\"text-slate-400 text-sm\">Connect external tools and subscribe to live event streams.</p>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IntegrationsView.jsx:chunk_1",
      "file_path": "frontend/src/views/IntegrationsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 463,
      "ingested_at": "2026-01-16T23:06:30.241420"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IntegrationsView.jsx_frontend/src/views/IntegrationsView.jsx:chunk_2_0b294a13",
    "text": "            <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n                {[\n                    { name: \"JIRA Cloud\", icon: \"J\", color: \"bg-blue-600\", connected: true, streams: [\"IssueCreated\", \"StatusChanged\"] },\n                    { name: \"GitHub Enterprise\", icon: \"G\", color: \"bg-slate-900\", connected: true, streams: [\"PushEvent\", \"PullRequest\"] },\n                    { name: \"Datadog\", icon: \"D\", color: \"bg-purple-600\", connected: false, streams: [] },\n                    { name: \"Slack\", icon: \"S\", color: \"bg-orange-500\", connected: true, streams: [\"Message\", \"Mention\"] },\n                    { name: \"ServiceNow\", icon: \"SN\", color: \"bg-emerald-600\", connected: false, streams: [] },\n                    { name: \"PagerDuty\", icon: \"P\", color: \"bg-green-600\", connected: false, streams: [] },\n                ].map((tool, i) => (\n                    <div key={i} className=\"bg-slate-900 border border-slate-700 rounded-xl p-5 flex flex-col justify-between h-48 hover:border-slate-500 transition-colors shadow-sm cursor-default hover:shadow-md group\">\n                        <div className=\"flex justify-between items-start\">\n                            <div className=\"flex items-center space-x-3\">\n                                <div className={`w-10 h-10 rounded-lg ${tool.color} flex items-center justify-center text-white font-bold text-lg shadow-lg`}>\n                                    {tool.icon}\n                                </div>\n                                <div>\n                                    <h3 className=\"font-bold text-slate-200 group-hover:text-white transition-colors\">{tool.name}</h3>\n                                    <div className=\"flex items-center mt-1\">\n                                        <div className={`w-2 h-2 rounded-full mr-2 ${tool.connected ? 'bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]' : 'bg-slate-600'}`}></div>\n                                        <span className=\"text-xs text-slate-500 font-medium\">{tool.connected ? 'Connected' : 'Disconnected'}</span>\n                                    </div>\n                                </div>\n                            </div>\n                            <button className=\"text-slate-500 hover:text-white transition-colors\">\n                                <Settings className=\"w-4 h-4\" />\n                            </button>\n                        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IntegrationsView.jsx:chunk_2",
      "file_path": "frontend/src/views/IntegrationsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2416,
      "ingested_at": "2026-01-16T23:06:30.241425"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IntegrationsView.jsx_frontend/src/views/IntegrationsView.jsx:chunk_3_40c53109",
    "text": "                        {tool.connected && (\n                            <div className=\"space-y-2\">\n                                <p className=\"text-[10px] uppercase tracking-wider text-slate-500 font-bold\">Active Subscriptions</p>\n                                <div className=\"flex flex-wrap gap-2\">\n                                    {tool.streams.map((stream, idx) => (\n                                        <span key={idx} className=\"text-[10px] bg-slate-800 text-blue-300/90 px-2 py-1 rounded border border-slate-700 font-mono\">\n                                            {stream}\n                                        </span>\n                                    ))}\n                                    <button className=\"text-[10px] bg-slate-800 text-slate-400 px-2 py-1 rounded border border-slate-700 hover:text-white hover:border-slate-500 transition-colors\">\n                                        + Add\n                                    </button>\n                                </div>\n                            </div>\n                        )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IntegrationsView.jsx:chunk_3",
      "file_path": "frontend/src/views/IntegrationsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1072,
      "ingested_at": "2026-01-16T23:06:30.241429"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IntegrationsView.jsx_frontend/src/views/IntegrationsView.jsx:chunk_4_d5cb18a7",
    "text": "                        {!tool.connected && (\n                            <button className=\"w-full py-2 bg-slate-800 hover:bg-slate-700 text-slate-300 hover:text-white rounded-lg text-xs font-medium transition-all border border-transparent hover:border-slate-600\">\n                                Connect Integration\n                            </button>\n                        )}\n                    </div>\n                ))}\n            </div>\n        </div>\n    </div>\n);\n\nexport default IntegrationsView;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IntegrationsView.jsx:chunk_4",
      "file_path": "frontend/src/views/IntegrationsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 512,
      "ingested_at": "2026-01-16T23:06:30.241432"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_1_b4cce2a5",
    "text": "import React, { useState, useEffect } from 'react';\nimport { GitBranch, Plus, Trash2, Eye, RefreshCw, Loader2 } from 'lucide-react';\nimport api from '../services/api';\nimport RepoInspectorModal from '../components/RepoInspectorModal';\n\nconst RepositoriesView = () => {\n    const [repos, setRepos] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [inspectorOpen, setInspectorOpen] = useState(false);\n    const [selectedRepo, setSelectedRepo] = useState(null);\n\n    const demoRepos = [\n        { id: 'demo_1', name: 'payments-v2-backend', lang: 'TYPESCRIPT', nodes: '14.2k', updated: '2 mins ago', density: 'high' },\n        { id: 'demo_2', name: 'legacy-auth-service', lang: 'JAVA', nodes: '45.1k', updated: '1 hour ago', density: 'high' },\n        { id: 'demo_3', name: 'frontend-dashboard', lang: 'REACT', nodes: '22.8k', updated: 'Yesterday', density: 'medium' }\n    ];\n\n    useEffect(() => {\n        loadRepos();\n    }, []);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_1",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 954,
      "ingested_at": "2026-01-16T23:06:30.242559"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_2_66b30668",
    "text": "    const loadRepos = async () => {\n        setLoading(true);\n        try {\n            const res = await api.get('/api/github/repos', { headers: { 'x-iam-role': 'sde_ii' } });\n            if (res.data.repos.length === 0) {\n                setRepos(demoRepos);\n            } else {\n                setRepos(res.data.repos.map((r, idx) => ({\n                    id: r.name || `repo_${idx}`,\n                    name: r.name,\n                    lang: 'UNKNOWN',\n                    nodes: '1.2k',\n                    updated: 'Just now',\n                    density: 'medium'\n                })));\n            }\n        } catch (e) {\n            setRepos(demoRepos);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleOpenInspector = (repo) => {\n        setSelectedRepo(repo);\n        setInspectorOpen(true);\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_2",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 848,
      "ingested_at": "2026-01-16T23:06:30.242563"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_3_b5134119",
    "text": "    return (\n        <>\n            <div className=\"space-y-6\">\n                <div className=\"flex items-center justify-between\">\n                    <div>\n                        <h1 className=\"heading-1\">Source Code Repositories</h1>\n                        <p className=\"heading-2 text-slate-400\">Manage AST parsing and Tree-sitter indexing for connected codebases.</p>\n                    </div>\n                    <button className=\"px-4 py-2 bg-purple-600 hover:bg-purple-500 text-white rounded-lg font-medium flex items-center gap-2 shadow-lg shadow-purple-500/20 transition-all\">\n                        <Plus size={18} />\n                        <span>Add Repository</span>\n                    </button>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_3",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 738,
      "ingested_at": "2026-01-16T23:06:30.242567"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_4_98e0acf8",
    "text": "                {loading ? (\n                    <div className=\"flex items-center justify-center py-12\">\n                        <Loader2 className=\"w-8 h-8 text-purple-500 animate-spin\" />\n                    </div>\n                ) : (\n                    <div className=\"space-y-4\">\n                        {repos.map((repo, idx) => (\n                            <div key={idx} className=\"glass-card p-5 flex items-center justify-between group\">\n                                <div className=\"flex items-center gap-5\">\n                                    <div className=\"w-12 h-12 rounded-xl bg-purple-900/30 border border-purple-500/30 flex items-center justify-center\">\n                                        <GitBranch size={24} className=\"text-purple-400\" />\n                                    </div>\n                                    <div>\n                                        <div className=\"flex items-center gap-3\">\n                                            <h3 className=\"text-lg font-bold text-slate-100 group-hover:text-purple-400 transition-colors\">\n                                                {repo.name}\n                                            </h3>\n                                            <span className=\"px-2 py-0.5 rounded text-[10px] font-bold bg-slate-800 border border-slate-700 text-slate-400 tracking-wider\">\n                                                {repo.lang}\n                                            </span>\n                                        </div>\n                                        <div className=\"flex items-center gap-4 text-xs text-slate-500 mt-1.5 font-mono\">\n                                            <div className=\"flex items-center gap-1.5\">\n                                                <GitBranch size={12} />\n                                                <span>{repo.nodes} AST Nodes</span>\n                                            </div>\n                                            <div className=\"flex items-center gap-1.5\">\n                                                <RefreshCw size={12} />\n                                                <span>Updated {repo.updated}</span>\n                                            </div>\n                                        </div>\n                                    </div>\n                                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_4",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2358,
      "ingested_at": "2026-01-16T23:06:30.242570"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_5_47da4435",
    "text": "                                {/* Visualization Area */}\n                                <div className=\"flex items-center gap-8\">\n                                    <div className=\"hidden lg:block text-right\">\n                                        <div className=\"flex items-end gap-[2px] h-8 mb-1\">\n                                            {[...Array(8)].map((_, i) => (\n                                                <div\n                                                    key={i}\n                                                    className=\"w-1.5 rounded-t-sm bg-emerald-500/80\"\n                                                    style={{ height: `${Math.random() * 100}%`, opacity: 0.5 + (i * 0.05) }}\n                                                />\n                                            ))}\n                                        </div>\n                                        <span className=\"text-[10px] text-slate-600 font-bold uppercase tracking-wider\">Tree Density</span>\n                                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_5",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1048,
      "ingested_at": "2026-01-16T23:06:30.242573"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_6_fb38603d",
    "text": "                                    <div className=\"flex items-center gap-2\">\n                                        <button className=\"p-2 text-slate-500 hover:text-white hover:bg-slate-800 rounded-lg transition-colors\">\n                                            <RefreshCw size={18} />\n                                        </button>\n                                        <button\n                                            onClick={() => handleOpenInspector(repo)}\n                                            className=\"p-2 text-slate-500 hover:text-purple-400 hover:bg-purple-900/20 rounded-lg transition-colors\"\n                                            title=\"Inspect Repository\"\n                                        >\n                                            <Eye size={18} />\n                                        </button>\n                                        <button className=\"p-2 text-slate-500 hover:text-red-400 hover:bg-red-900/20 rounded-lg transition-colors\">\n                                            <Trash2 size={18} />\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                )}\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_6",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1321,
      "ingested_at": "2026-01-16T23:06:30.242576"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/RepositoriesView.jsx_frontend/src/views/RepositoriesView.jsx:chunk_7_bb4f8b3a",
    "text": "            {/* Inspector Modal */}\n            <RepoInspectorModal\n                isOpen={inspectorOpen}\n                onClose={() => setInspectorOpen(false)}\n                repoId={selectedRepo?.id}\n                repoName={selectedRepo?.name}\n            />\n        </>\n    );\n};\n\nexport default RepositoriesView;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/RepositoriesView.jsx:chunk_7",
      "file_path": "frontend/src/views/RepositoriesView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 322,
      "ingested_at": "2026-01-16T23:06:30.242579"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_1_dadb22a9",
    "text": "import React, { useState, useEffect, useRef } from 'react';\nimport { Upload, FileText, RefreshCw, CheckCircle, Trash2, Loader2 } from 'lucide-react';\nimport api from '../services/api';\n\nconst DocumentsView = () => {\n    const [documents, setDocuments] = useState([]);\n    const [loading, setLoading] = useState(true);\n    const [uploading, setUploading] = useState(false);\n    const [isDragging, setIsDragging] = useState(false);\n    const fileInputRef = useRef(null);\n\n    useEffect(() => {\n        loadDocuments();\n    }, []);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_1",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 528,
      "ingested_at": "2026-01-16T23:06:30.243914"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_2_115b725e",
    "text": "    const loadDocuments = async () => {\n        try {\n            const docs = await api.documentAPI.list('sde_ii');\n            // enhance docs with status if missing (mocking status for now as backend might not return it fully)\n            const enhancedDocs = docs.map(d => ({\n                ...d,\n                status: d.status || 'Indexed',\n                size: d.file_size ? (d.file_size / 1024 / 1024).toFixed(2) + ' MB' : 'Unknown',\n                date: new Date(d.uploaded_at).toLocaleDateString()\n            }));\n            setDocuments(enhancedDocs);\n        } catch (e) {\n            console.error(e);\n        } finally {\n            setLoading(false);\n        }\n    };\n\n    const handleDrop = async (e) => {\n        e.preventDefault();\n        setIsDragging(false);\n        const files = Array.from(e.dataTransfer.files);\n        if (files.length > 0) handleUpload(files[0]);\n    };\n\n    const [ingestionResult, setIngestionResult] = useState(null);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_2",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 969,
      "ingested_at": "2026-01-16T23:06:30.243918"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_3_fa3c3434",
    "text": "    const handleUpload = async (file) => {\n        setUploading(true);\n        setIngestionResult(null);\n        try {\n            const response = await api.documentAPI.upload(file, 'sde_ii');\n            if (response.ingestion) {\n                setIngestionResult(response.ingestion);\n                setTimeout(() => setIngestionResult(null), 8000); // Hide after 8s\n            }\n            await loadDocuments();\n        } catch (e) {\n            console.error(\"Upload failed\", e);\n        } finally {\n            setUploading(false);\n        }\n    };",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_3",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 558,
      "ingested_at": "2026-01-16T23:06:30.243921"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_4_7d509678",
    "text": "    return (\n        <div className=\"flex-1 p-8 overflow-y-auto h-full\">\n            {ingestionResult && (\n                <div className=\"fixed bottom-8 right-8 bg-slate-900 border border-emerald-500/50 p-4 rounded-xl shadow-2xl z-50 animate-in slide-in-from-bottom-4 fade-in duration-300\">\n                    <div className=\"flex items-start space-x-3\">\n                        <div className=\"p-2 bg-emerald-900/20 rounded-full text-emerald-400\">\n                            <CheckCircle className=\"w-5 h-5\" />\n                        </div>\n                        <div>\n                            <h4 className=\"font-semibold text-emerald-400 text-sm\">Ingestion Complete</h4>\n                            <p className=\"text-slate-400 text-xs mt-1\">Knowledge graph built successfully.</p>\n                            <div className=\"mt-2 grid grid-cols-2 gap-2 text-xs\">\n                                <div className=\"bg-slate-800 p-2 rounded border border-slate-700\">\n                                    <span className=\"text-slate-500 block\">Chunks</span>\n                                    <span className=\"text-emerald-400 font-mono font-bold\">{ingestionResult.chunk_count}</span>\n                                </div>\n                                <div className=\"bg-slate-800 p-2 rounded border border-slate-700\">\n                                    <span className=\"text-slate-500 block\">Concepts</span>\n                                    <span className=\"text-blue-400 font-mono font-bold\">{ingestionResult.concept_count}</span>\n                                </div>\n                                <div className=\"bg-slate-800 p-2 rounded border border-slate-700 col-span-2\">\n                                    <span className=\"text-slate-500 block\">Graph Nodes/Edges</span>\n                                    <span className=\"text-purple-400 font-mono font-bold\">{ingestionResult.graph_nodes} / {ingestionResult.graph_edges}</span>\n                                </div>\n                            </div>\n                        </div>\n                        <button onClick={() => setIngestionResult(null)} className=\"text-slate-500 hover:text-white\">\n                            <Trash2 className=\"w-4 h-4\" />\n                        </button>\n                    </div>\n                </div>\n            )}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_4",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2336,
      "ingested_at": "2026-01-16T23:06:30.243925"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_5_c7ae0f70",
    "text": "            <div className=\"max-w-5xl mx-auto space-y-8\">\n                <div className=\"flex justify-between items-center\">\n                    <div>\n                        <h2 className=\"text-2xl font-bold text-white mb-1\">Knowledge Base</h2>\n                        <p className=\"text-slate-400 text-sm\">Upload and manage vectorized documents for RAG context.</p>\n                    </div>\n                    <input\n                        type=\"file\"\n                        ref={fileInputRef}\n                        className=\"hidden\"\n                        onChange={(e) => e.target.files.length > 0 && handleUpload(e.target.files[0])}\n                    />\n                    <button\n                        onClick={() => fileInputRef.current?.click()}\n                        className=\"px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg flex items-center text-sm font-medium shadow-lg shadow-blue-900/20 transition-all hover:translate-y-px\"\n                    >\n                        <Upload className=\"w-4 h-4 mr-2\" /> Upload Files\n                    </button>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_5",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1117,
      "ingested_at": "2026-01-16T23:06:30.243928"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_6_22ece509",
    "text": "                {/* Drag Drop Zone */}\n                <div\n                    onDragOver={(e) => { e.preventDefault(); setIsDragging(true); }}\n                    onDragLeave={() => setIsDragging(false)}\n                    onDrop={handleDrop}\n                    className={`border-2 border-dashed rounded-xl p-12 text-center transition-all cursor-pointer group\n                        ${isDragging ? 'border-blue-500 bg-blue-500/10' : 'border-slate-700 bg-slate-800/20 hover:bg-slate-800/40 hover:border-blue-500/50'}\n                    `}\n                >\n                    {uploading ? (\n                        <div className=\"flex flex-col items-center\">\n                            <Loader2 className=\"w-10 h-10 text-blue-500 animate-spin mb-4\" />\n                            <h3 className=\"text-lg font-medium text-slate-300\">Processing Document...</h3>\n                            <p className=\"text-slate-500 text-sm mt-1\">Building Knowledge Graph & Extracting Concepts</p>\n                        </div>\n                    ) : (\n                        <>\n                            <div className=\"w-16 h-16 bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 group-hover:bg-slate-700 transition-colors shadow-lg\">\n                                <Upload className=\"w-8 h-8 text-slate-400 group-hover:text-blue-400\" />\n                            </div>\n                            <h3 className=\"text-lg font-medium text-slate-300\">Drag & Drop files here</h3>\n                            <p className=\"text-slate-500 text-sm mt-1\">Support for PDF, DOCX, TXT (Max 50MB)</p>\n                        </>\n                    )}\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_6",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1687,
      "ingested_at": "2026-01-16T23:06:30.243931"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_7_8a1ce028",
    "text": "                {/* File List */}\n                <div className=\"bg-slate-900/50 border border-slate-700 rounded-xl overflow-hidden shadow-sm\">\n                    <div className=\"px-6 py-4 border-b border-slate-700 flex justify-between items-center bg-slate-800/30\">\n                        <h3 className=\"text-sm font-bold text-slate-300 uppercase tracking-wider\">Indexed Documents</h3>\n                        <span className=\"text-xs bg-slate-800 px-2 py-1 rounded text-slate-400 border border-slate-700\">Total: {documents.length}</span>\n                    </div>\n                    <div className=\"divide-y divide-slate-800\">\n                        {loading && <div className=\"p-8 text-center text-slate-500\">Loading documents...</div>}\n                        {!loading && documents.length === 0 && <div className=\"p-8 text-center text-slate-500\">No documents found.</div>}",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_7",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 883,
      "ingested_at": "2026-01-16T23:06:30.243935"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_8_5d0b1eaf",
    "text": "                        {documents.map((doc, i) => (\n                            <div key={i} className=\"px-6 py-4 flex items-center justify-between hover:bg-slate-800/30 transition-colors group\">\n                                <div className=\"flex items-center space-x-4\">\n                                    <div className=\"p-2.5 bg-blue-900/20 rounded-lg text-blue-400 border border-blue-900/30\">\n                                        <FileText className=\"w-5 h-5\" />\n                                    </div>\n                                    <div>\n                                        <p className=\"text-sm font-semibold text-slate-200 group-hover:text-blue-400 transition-colors\">{doc.key || doc.original_filename || doc.name}</p>\n                                        <p className=\"text-xs text-slate-500 mt-0.5\">{doc.size || 'N/A'} \u2022 Uploaded {doc.date || 'Unknown'}</p>\n                                    </div>\n                                </div>\n                                <div className=\"flex items-center space-x-6\">\n                                    <div className=\"flex items-center\">\n                                        {doc.status === 'Processing' ? (\n                                            <div className=\"flex items-center text-blue-400 text-xs bg-blue-900/20 px-2.5 py-1 rounded-full border border-blue-900/30 font-medium\">\n                                                <RefreshCw className=\"w-3 h-3 mr-2 animate-spin\" /> {doc.status}\n                                            </div>\n                                        ) : (\n                                            <div className=\"flex items-center text-emerald-500 text-xs bg-emerald-900/20 px-2.5 py-1 rounded-full border border-emerald-900/30 font-medium\">\n                                                <CheckCircle className=\"w-3 h-3 mr-2\" /> {doc.status || 'Indexed'}\n                                                {doc.chunk_count > 0 && <span className=\"ml-2 text-slate-500\">({doc.chunk_count} chunks)</span>}\n                                            </div>\n                                        )}\n                                    </div>\n                                    <button className=\"p-2 text-slate-600 hover:text-red-400 hover:bg-red-900/20 rounded transition-colors opacity-0 group-hover:opacity-100\">\n                                        <Trash2 className=\"w-4 h-4\" />\n                                    </button>\n                                </div>\n                            </div>\n                        ))}\n                    </div>\n                </div>\n            </div>\n        </div>\n    );\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_8",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2658,
      "ingested_at": "2026-01-16T23:06:30.243939"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/DocumentsView.jsx_frontend/src/views/DocumentsView.jsx:chunk_9_b8938e69",
    "text": "export default DocumentsView;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/DocumentsView.jsx:chunk_9",
      "file_path": "frontend/src/views/DocumentsView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 30,
      "ingested_at": "2026-01-16T23:06:30.243942"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_1_d5f0620f",
    "text": "import React from 'react';\nimport { ChevronRight, CheckCircle, ToggleRight, ToggleLeft } from 'lucide-react';\n\nconst IAMConfigView = () => (\n    <div className=\"flex-1 p-8 overflow-y-auto h-full\">\n        <div className=\"max-w-5xl mx-auto space-y-8\">\n            <div>\n                <h2 className=\"text-2xl font-bold text-white mb-1\">IAM Configuration</h2>\n                <p className=\"text-slate-400 text-sm\">Define role-based capability envelopes and scope boundaries.</p>\n            </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_1",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 496,
      "ingested_at": "2026-01-16T23:06:30.244841"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_2_18dcbe3e",
    "text": "            <div className=\"bg-[#111827] border border-slate-700 rounded-xl overflow-hidden shadow-xl flex flex-col md:flex-row min-h-[500px]\">\n                {/* Sidebar */}\n                <div className=\"w-full md:w-64 border-r border-slate-700 bg-slate-900/50 p-4\">\n                    <div className=\"flex border-b border-slate-700 mb-4 pb-1 space-x-1\">\n                        <button className=\"flex-1 pb-2 text-sm font-medium text-blue-400 border-b-2 border-blue-500\">Roles</button>\n                        <button className=\"flex-1 pb-2 text-sm font-medium text-slate-500 hover:text-slate-300\">Policies</button>\n                        <button className=\"flex-1 pb-2 text-sm font-medium text-slate-500 hover:text-slate-300\">Audit</button>\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_2",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 775,
      "ingested_at": "2026-01-16T23:06:30.244844"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_3_b3d93cd6",
    "text": "                    <div className=\"space-y-1\">\n                        {['Admin', 'Senior Engineer', 'Junior Engineer', 'HR Manager', 'Auditor'].map((role, i) => (\n                            <button key={i} className={`w-full text-left px-4 py-3 rounded-lg text-sm font-medium flex justify-between items-center transition-all ${i === 1 ? 'bg-blue-600 text-white shadow-lg shadow-blue-900/20' : 'text-slate-400 hover:bg-slate-800 hover:text-slate-200'}`}>\n                                {role}\n                                {i === 1 && <ChevronRight className=\"w-4 h-4\" />}\n                            </button>\n                        ))}\n                    </div>\n                </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_3",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 693,
      "ingested_at": "2026-01-16T23:06:30.244848"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_4_14b2a302",
    "text": "                {/* Editor Area */}\n                <div className=\"flex-1 p-8 bg-[#0B1120]\">\n                    <div className=\"flex justify-between items-center mb-8\">\n                        <div className=\"flex items-center gap-4\">\n                            <h3 className=\"text-xl font-bold text-white\">Role: Senior Engineer</h3>\n                            <div className=\"flex items-center px-2.5 py-0.5 rounded-full bg-emerald-500/10 text-emerald-400 text-xs font-bold border border-emerald-500/20\">\n                                <CheckCircle className=\"w-3 h-3 mr-1.5\" /> Active\n                            </div>\n                        </div>\n                        <button className=\"text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-2 rounded-lg border border-slate-700 transition-colors font-medium\">\n                            Duplicate Role\n                        </button>\n                    </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_4",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 936,
      "ingested_at": "2026-01-16T23:06:30.244851"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_5_3a21e681",
    "text": "                    <div className=\"space-y-8 max-w-2xl\">\n                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Scope: Repositories</label>\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-lg border border-slate-700 shadow-sm\">\n                                    <span className=\"text-sm font-medium text-slate-200\">Read Access</span>\n                                    <ToggleRight className=\"w-6 h-6 text-emerald-500 cursor-pointer\" />\n                                </div>\n                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-lg border border-slate-700 shadow-sm\">\n                                    <span className=\"text-sm font-medium text-slate-200\">Write (Feature Branch)</span>\n                                    <ToggleRight className=\"w-6 h-6 text-emerald-500 cursor-pointer\" />\n                                </div>\n                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-lg border border-slate-700 shadow-sm opacity-75\">\n                                    <span className=\"text-sm font-medium text-slate-400\">Write (Main Branch)</span>\n                                    <ToggleLeft className=\"w-6 h-6 text-slate-600 cursor-pointer\" />\n                                </div>\n                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-lg border border-slate-700 shadow-sm opacity-75\">\n                                    <span className=\"text-sm font-medium text-slate-400\">Delete Repo</span>\n                                    <ToggleLeft className=\"w-6 h-6 text-slate-600 cursor-pointer\" />\n                                </div>\n                            </div>\n                        </div>",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_5",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 2016,
      "ingested_at": "2026-01-16T23:06:30.244854"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_6_d25db5e2",
    "text": "                        <div>\n                            <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-3\">Scope: Integrations</label>\n                            <div className=\"space-y-3\">\n                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-lg border border-slate-700 shadow-sm\">\n                                    <span className=\"text-sm font-medium text-slate-200\">JIRA (Create/Edit Tickets)</span>\n                                    <span className=\"text-xs font-bold text-emerald-400 uppercase tracking-wider bg-emerald-500/10 px-2 py-1 rounded border border-emerald-500/20\">Allowed</span>\n                                </div>\n                                <div className=\"flex items-center justify-between p-4 bg-slate-900/50 rounded-lg border border-slate-700 shadow-sm opacity-75\">\n                                    <span className=\"text-sm font-medium text-slate-400\">Production DB (Write)</span>\n                                    <span className=\"text-xs font-bold text-red-400 uppercase tracking-wider bg-red-500/10 px-2 py-1 rounded border border-red-500/20\">Denied</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_6",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 1396,
      "ingested_at": "2026-01-16T23:06:30.244858"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/views/IAMConfigView.jsx_frontend/src/views/IAMConfigView.jsx:chunk_7_d24a296f",
    "text": "export default IAMConfigView;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/views/IAMConfigView.jsx:chunk_7",
      "file_path": "frontend/src/views/IAMConfigView.jsx",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 30,
      "ingested_at": "2026-01-16T23:06:30.244861"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_1_ab41c5db",
    "text": "/**\n * API Service for Enterprise Copilot\n * Handles all communication with the FastAPI backend\n */\n\nimport axios from 'axios';\n\nconst API_BASE_URL = import.meta.env.VITE_API_URL || 'http://localhost:8000';\n\n// Create axios instance with defaults\nconst apiClient = axios.create({\n  baseURL: API_BASE_URL,\n  timeout: 120000, // 2 minutes for LLM responses\n  headers: {\n    'Content-Type': 'application/json'\n  }\n});\n\n// Request interceptor to add IAM role header\napiClient.interceptors.request.use(\n  (config) => {\n    // Get current role from somewhere (could be context, local storage, etc.)\n    const currentRole = window.currentIAMRole || 'CHIEF_STRATEGY_OFFICER';\n    config.headers['x-iam-role'] = currentRole;\n    return config;\n  },\n  (error) => {\n    return Promise.reject(error);\n  }\n);",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_1",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 795,
      "ingested_at": "2026-01-16T23:06:30.246272"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_2_06d42a71",
    "text": "// Response interceptor for error handling\napiClient.interceptors.response.use(\n  (response) => response,\n  (error) => {\n    if (error.response) {\n      // Server responded with error status\n      console.error('API Error:', error.response.data);\n\n      if (error.response.status === 403) {\n        // IAM denial - show appropriate message\n        return Promise.reject({\n          type: 'IAM_DENIAL',\n          message: error.response.data.detail || 'Access denied',\n          ...error.response.data\n        });\n      }\n    }\n    return Promise.reject(error);\n  }\n);\n\n/**\n * Chat API\n */\nexport const chatAPI = {\n  /**\n   * Send a query to the copilot (legacy linear pipeline)\n   */\n  sendQuery: async (query, iamRole, sessionId = null) => {\n    window.currentIAMRole = iamRole; // Set for interceptor\n\n    const response = await apiClient.post('/api/chat', {\n      query,\n      conversation_id: sessionId,\n      context: {}\n    });\n\n    return response.data;\n  },",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_2",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 965,
      "ingested_at": "2026-01-16T23:06:30.246276"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_3_2a03a203",
    "text": "  /**\n   * Send a query using the agentic ReAct loop\n   */\n  sendAgentQuery: async (query, iamRole, sessionId = null) => {\n    window.currentIAMRole = iamRole;\n\n    const response = await apiClient.post('/api/chat/agent', {\n      query,\n      conversation_id: sessionId\n    });\n\n    return response.data;\n  },\n\n  /**\n   * Stream a query response using SSE\n   * Returns an async iterator of events\n   */\n  streamQuery: async function* (query, iamRole, sessionId = null) {\n    const baseUrl = import.meta.env.VITE_API_URL || 'http://localhost:8000';\n\n    const response = await fetch(`${baseUrl}/api/chat/stream`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        'x-iam-role': iamRole\n      },\n      body: JSON.stringify({\n        query,\n        conversation_id: sessionId\n      })\n    });\n\n    const reader = response.body.getReader();\n    const decoder = new TextDecoder();\n    let buffer = '';",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_3",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 938,
      "ingested_at": "2026-01-16T23:06:30.246279"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_4_4f688561",
    "text": "    while (true) {\n      const { done, value } = await reader.read();\n      if (done) break;\n\n      buffer += decoder.decode(value, { stream: true });\n      const lines = buffer.split('\\n\\n');\n      buffer = lines.pop() || '';\n\n      for (const line of lines) {\n        if (line.startsWith('data: ')) {\n          try {\n            const data = JSON.parse(line.slice(6));\n            yield data;\n          } catch (e) {\n            console.warn('Failed to parse SSE data:', line);\n          }\n        }\n      }\n    }\n  }\n};\n\n/**\n * Personas API\n */\nexport const personasAPI = {\n  /**\n   * Get all available personas\n   */\n  getAll: async () => {\n    const response = await apiClient.get('/api/personas');\n    return response.data;\n  }\n};\n\n/**\n * Audit Logs API\n */\nexport const auditAPI = {\n  /**\n   * Get recent audit logs\n   */\n  getLogs: async (limit = 50, iamRole) => {\n    window.currentIAMRole = iamRole;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_4",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 909,
      "ingested_at": "2026-01-16T23:06:30.246283"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_5_2ef2de26",
    "text": "    const response = await apiClient.get('/api/audit/logs', {\n      params: { limit }\n    });\n\n    return response.data;\n  },\n\n  /**\n   * Connect to audit log WebSocket stream\n   */\n  connectStream: (onMessage, onError = null) => {\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws/audit`;\n\n    const ws = new WebSocket(wsUrl);\n\n    ws.onmessage = (event) => {\n      try {\n        const log = JSON.parse(event.data);\n        onMessage(log);\n      } catch (e) {\n        console.error('Failed to parse audit log:', e);\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n      if (onError) onError(error);\n    };\n\n    ws.onclose = () => {\n      console.log('Audit stream disconnected');\n    };\n\n    return ws;\n  }\n};",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_5",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 842,
      "ingested_at": "2026-01-16T23:06:30.246286"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_6_d18a2b12",
    "text": "/**\n * Ingestion API\n */\nexport const ingestionAPI = {\n  /**\n   * Trigger document ingestion\n   */\n  ingestDocuments: async (iamRole) => {\n    window.currentIAMRole = iamRole;\n\n    const response = await apiClient.post('/api/ingest/documents');\n    return response.data;\n  },\n\n  /**\n   * Index codebase\n   */\n  indexCodebase: async (path, iamRole) => {\n    window.currentIAMRole = iamRole;\n\n    const response = await apiClient.post('/api/ingest/codebase', null, {\n      params: { path }\n    });\n\n    return response.data;\n  }\n};\n\n/**\n * Health Check\n */\nexport const healthAPI = {\n  check: async () => {\n    const response = await apiClient.get('/api/health');\n    return response.data;\n  }\n};\n\n/**\n * Conversation API\n */\nexport const conversationAPI = {\n  /**\n   * List all conversations\n   */\n  list: async (iamRole) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.get('/api/conversations');\n    return response.data.conversations;\n  },",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_6",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 971,
      "ingested_at": "2026-01-16T23:06:30.246289"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_7_9460d2a9",
    "text": "  /**\n   * Create a new conversation\n   */\n  create: async (iamRole, title = null) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.post('/api/conversations', { title });\n    return response.data;\n  },\n\n  /**\n   * Get conversation with messages\n   */\n  get: async (conversationId, iamRole) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.get(`/api/conversations/${conversationId}`);\n    return response.data;\n  },\n\n  /**\n   * Get messages for a conversation\n   */\n  getMessages: async (conversationId, iamRole, limit = 100) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.get(`/api/conversations/${conversationId}/messages`, {\n      params: { limit }\n    });\n    return response.data.messages;\n  },",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_7",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 790,
      "ingested_at": "2026-01-16T23:06:30.246293"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_8_a9510677",
    "text": "  /**\n   * Add message to conversation\n   */\n  addMessage: async (conversationId, iamRole, role, content, metadata = null) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.post(`/api/conversations/${conversationId}/messages`, {\n      role,\n      content,\n      metadata\n    });\n    return response.data;\n  },\n\n  /**\n   * Delete a conversation\n   */\n  delete: async (conversationId, iamRole) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.delete(`/api/conversations/${conversationId}`);\n    return response.data;\n  }\n};\n\n/**\n * Document API\n */\nexport const documentAPI = {\n  /**\n   * List user's documents\n   */\n  list: async (iamRole) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.get('/api/documents');\n    return response.data.documents;\n  },\n\n  /**\n   * Upload a document\n   */\n  upload: async (file, iamRole) => {\n    window.currentIAMRole = iamRole;",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_8",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 950,
      "ingested_at": "2026-01-16T23:06:30.246296"
    }
  },
  {
    "id": "enterprise-copilot_frontend/src/services/api.js_frontend/src/services/api.js:chunk_9_6608f54d",
    "text": "    const formData = new FormData();\n    formData.append('file', file);\n\n    const response = await apiClient.post('/api/documents/upload', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    });\n    return response.data;\n  },\n\n  /**\n   * Delete a document\n   */\n  delete: async (docId, iamRole) => {\n    window.currentIAMRole = iamRole;\n    const response = await apiClient.delete(`/api/documents/${docId}`);\n    return response.data;\n  }\n};\n\n// Unified API Export\nconst api = {\n  // Direct Axios Methods\n  get: (url, config) => apiClient.get(url, config),\n  post: (url, data, config) => apiClient.post(url, data, config),\n  put: (url, data, config) => apiClient.put(url, data, config),\n  delete: (url, config) => apiClient.delete(url, config),\n\n  // Modules\n  chatAPI,\n  personasAPI,\n  auditAPI,\n  ingestionAPI,\n  healthAPI,\n  conversationAPI,\n  documentAPI\n};\n\nexport default api;\n",
    "metadata": {
      "type": "code",
      "chunk_type": "code_block",
      "name": "frontend/src/services/api.js:chunk_9",
      "file_path": "frontend/src/services/api.js",
      "language": "javascript",
      "repo_name": "enterprise-copilot",
      "user_id": "CHIEF_STRATEGY_OFFICER",
      "start_line": 0,
      "end_line": 0,
      "char_count": 919,
      "ingested_at": "2026-01-16T23:06:30.246299"
    }
  }
]